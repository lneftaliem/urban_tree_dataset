---
title: "National_urban_trees"
author: "Leona Neftaliem"
date: '`r Sys.Date()`'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Libraries
```{r}
library(dplyr)
library(lubridate)
library(tidyverse)
library(plyr)
library(zoo)
library(data.table)
library(ggplot2)
library(sf)

```

#Species codes
```{r}

spp_code<- read.csv("~/Dropbox/Urban_data/spp_codes_final_2.csv")

spp_code <- spp_code %>% 
  mutate(hort_code = tolower(hort_code)) %>% 
  mutate(species_common_name = tolower(species_common_name)) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  select(c(species_botanical_name,species_common_name,hort_code))

spp_code <- unique(spp_code)

```

#Atlanta, GA, USA

Data downloaded from: 
  https://geospatialdev.design.gatech.edu/DSSG/DSSGTreesDeliverable/Visualizations/CityStreetTrees/

```{r}

#Clean
atlanta_trees<- read.csv("~/Dropbox/Urban_data/Raw/atlanta_ga_usa.csv")

atlanta_trees$country <- "usa"
atlanta_trees$state <- "georgia"
atlanta_trees$city <- "atlanta"
atlanta_trees$year <- "2015" #as of 2015

atlanta_trees_clean <- atlanta_trees %>% 
  dplyr::rename(lat = Latitude,
                long = Longitude,
                species_botanical_name = SPP,
                dbh = DBH) %>%#in inches!
                #height = HEIGHT) %>%
   select(c(lat, long, dbh, species_botanical_name,country, state, city, year)) %>% 
  filter(!grepl("^vacant site|^stump|^unknown tree", species_botanical_name))%>% 
  mutate(species_botanical_name = tolower(species_botanical_name))

atlanta_trees_clean$dbh[atlanta_trees_clean$dbh == ""] <- NA
atlanta_trees_clean$species_botanical_name[atlanta_trees_clean$species_botanical_name == ""] <- NA

atlanta_trees_clean$dbh <- as.numeric(atlanta_trees_clean$dbh)

atlanta_trees_clean$dbh <- atlanta_trees_clean$dbh * 2.54 #converting from inches to cm

atlanta_trees_clean <- atlanta_trees_clean %>%
  mutate(species_botanical_name = case_when(
    
    str_detect(species_botanical_name, "^x cupressocyparis leylandii") ~ "cupressocyparis leylandii",
    str_detect(species_botanical_name, "^acer tataricum ginnala") ~ "acer ginnala",
    str_detect(species_botanical_name, "^acer x freemanii") ~ "acer freemanii",
    str_detect(species_botanical_name, "^ilex x attenuata-fosteri") ~ "ilex attenuata-fosteri",
    str_detect(species_botanical_name, "^magnolia x soulangiana") ~ "magnolia soulangeana",
    str_detect(species_botanical_name, "^platanus x acerifolia") ~ "platanus acerifolia",
    str_detect(species_botanical_name, "^prunus x yedoensis") ~ "prunus yedoensis",
    str_detect(species_botanical_name, "^ulmus x") ~ "ulmus spp.",
    
    TRUE ~ species_botanical_name
  ))


atlanta_trees_clean<-left_join(atlanta_trees_clean,spp_code, by="species_botanical_name")


atlanta_trees_clean <- atlanta_trees_clean %>% 
  filter(!is.na(species_botanical_name)) %>% 
   filter(!is.na(dbh)) 

atlanta_trees_clean<-atlanta_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(atlanta_trees_clean, "~/Dropbox/Urban_data/Cleaned/atlanta_trees_clean.csv", row.names = FALSE)


```



#Austin, TX, USA

Data downloaded from: https://data.austintexas.gov/Locations-and-Maps/Tree-Inventory/wrik-xasw
Metadata: https://services.arcgis.com/0L95CJ0VTaxqcmED/arcgis/rest/services/Tree_Inventory/FeatureServer


```{r}

#Clean
austin_trees<- read.csv("~/Dropbox/Urban_data/Raw/austin_tx_usa.csv")

austin_trees$country <- "usa"
austin_trees$state <- "texas"
austin_trees$city <- "austin"
austin_trees$year <- "2020" #updated in 2020

austin_trees_clean <- austin_trees %>% 
  dplyr::rename(lat = LATITUDE,
                long = LONGTITUDE,
                species_common_name = SPECIES,
                dbh = DIAMETER) %>%  # in inches! %>% 
  select(-c(GEOMETRY, New.Georeferenced.Column))  %>% 
  filter(dbh>0) %>% 
  mutate(species_common_name = tolower(species_common_name))%>% 
  mutate(species_common_name = sub("spp$|species$", "spp.", species_common_name))%>%
  mutate(species_common_name = gsub("\\bx\\b", "", species_common_name)) %>% 
  mutate(species_common_name = gsub("\\s+", " ", species_common_name))%>% 
  filter(!grepl("^vacant|^tbd|^Stump|dead$|^character|^brush pile|^cull|^various|^unknown|^unidentifiable|^other|^snag", species_common_name, ignore.case = TRUE))

austin_trees_clean$dbh <- austin_trees_clean$dbh * 2.54 ##converting from inches to cm

austin_trees_clean$species_common_name <- as.character(austin_trees_clean$species_common_name)
austin_trees_clean$species_common_name <- strsplit(austin_trees_clean$species_common_name, ",\\s*")
austin_trees_clean$species_common_name <- sapply(austin_trees_clean$species_common_name, function(x) {
  if (length(x) > 1) {
    paste(rev(x), collapse = " ")
  } else {
    x
  }
})
austin_trees_clean$species_common_name <- as.character(austin_trees_clean$species_common_name)

austin_trees_clean <- austin_trees_clean %>%
  mutate(species_common_name = case_when(
 
    str_detect(species_common_name, "^american live oak") ~ "live oak",
    str_detect(species_common_name, "^american persimmon") ~ "common persimmon",
    str_detect(species_common_name, "^american sweet gum") ~ "american sweetgum",
    str_detect(species_common_name, "^american sycamore") ~ "sycamore",
    str_detect(species_common_name, "^anacacho orchid") ~ "anacacho orchid tree",
    str_detect(species_common_name, "^anaqua$") ~ "anacua",
    str_detect(species_common_name, "^arborvitae") ~ "arborvitae spp.",
    str_detect(species_common_name, "^arizona ash") ~ "velvet ash",
    str_detect(species_common_name, "^ash$") ~ "ash spp.",
    str_detect(species_common_name, "^ashei juniperus") ~ "ashe juniper",
    str_detect(species_common_name, "^bald cypress") ~ "baldcypress",
    str_detect(species_common_name, "^bald.r cypress") ~ "baldcypress",
    str_detect(species_common_name, "^big bend yucca") ~ "beaked yucca",
    str_detect(species_common_name, "^bois d’arc") ~ "osage orange",
    str_detect(species_common_name, "^box elder") ~ "boxelder",
    str_detect(species_common_name, "^bradford pear") ~ "callery pear",
    str_detect(species_common_name, "^buckley oak") ~ "texas red oak",
    str_detect(species_common_name, "^bumelia$") ~ "gum bumelia",
    str_detect(species_common_name, "^burr oak") ~ "bur oak",
    str_detect(species_common_name, "^cape pittosporum") ~ "cape cheesewood",
    str_detect(species_common_name, "^carolina laurelcherry") ~ "carolina laurel cherry",
    str_detect(species_common_name, "^catalpa$") ~ "catalpa spp.",
    str_detect(species_common_name, "^cedar$") ~ "cedar spp.",
    str_detect(species_common_name, "^chinaberrytree") ~ "chinaberry",
    str_detect(species_common_name, "^chinese \\(lacebark elm") ~ "chinese elm",
    str_detect(species_common_name, "^chinese flame tree") ~ "bougainvillea golden raintree",
    str_detect(species_common_name, "^chinese fringe tree") ~ "chinese fringetree",
    str_detect(species_common_name, "^chinese fringe tree") ~ "chinese fringetree",
    str_detect(species_common_name, "^chinese parasol") ~ "chinese parasol tree",
    str_detect(species_common_name, "^chinese pistache") ~ "chinese pistachio",
    str_detect(species_common_name, "^chinese tallow") ~ "chinese tallow",
    str_detect(species_common_name, "^chinquapin oak") ~ "chinkapin oak",
    str_detect(species_common_name, "^chiso") ~ "chisos red oak",
    #str_detect(species_common_name, "^chisos oak") ~ "chisos red oak",
    str_detect(species_common_name, "^common loquat") ~ "japanese medlar",
    str_detect(species_common_name, "^common winterberry") ~ "winterberry",
    str_detect(species_common_name, "^condalia$") ~ "bluewood condalia",
    str_detect(species_common_name, "^cottonwood$") ~ "eastern cottonwood",
    str_detect(species_common_name, "^crapemyrtle$") ~ "crape myrtle spp.",
    str_detect(species_common_name, "^crape myrtle \\(") ~ "crape myrtle spp.",
    
    str_detect(species_common_name, "^cypress$") ~ "cypress spp.",
    str_detect(species_common_name, "^eastern black cherry$") ~ "black cherry",
    str_detect(species_common_name, "^eastern catalpa$") ~ "northern catalpa",
    str_detect(species_common_name, "^eastern red cedar") ~ "eastern redcedar",
    str_detect(species_common_name, "^edible loquat") ~ "japanese medlar",
    str_detect(species_common_name, "^elm$") ~ "elm spp.",
    str_detect(species_common_name, "^eves necklacepod") ~ "eve's necklace",
    str_detect(species_common_name, "^firethorn$") ~ "firethorn spp.",
    str_detect(species_common_name, "^flame-leaf sumac") ~ "prairie sumac",
    str_detect(species_common_name, "^flamegold$") ~ "flamegold rain tree",
    str_detect(species_common_name, "^formosa flamegold$") ~ "flamegold rain tree",
    str_detect(species_common_name, "^fraser photinia") ~ "red tip photinia",
    str_detect(species_common_name, "^frasier photinia") ~ "red tip photinia",
    str_detect(species_common_name, "^ginkgo$") ~ "maidenhair tree",
    str_detect(species_common_name, "^golden leadball$") ~ "goldenball leadtree",
    str_detect(species_common_name, "^goldenrain tree$") ~ "golden rain tree",
    
    str_detect(species_common_name, "^gum bully$") ~ "gum bumelia",
    str_detect(species_common_name, "^hackberry$") ~ "hackberry spp.",
    str_detect(species_common_name, "^holly yaupon$") ~ "yaupon holly",
    str_detect(species_common_name, "^honeylocust$") ~ "honey locust spp.",
    str_detect(species_common_name, "^huisache$") ~ "sweet acacia",
    str_detect(species_common_name, "^indian hawthorne") ~ "indian hawthorn",
    str_detect(species_common_name, "^japanese bitter") ~ "hardy orange",
    str_detect(species_common_name, "^jeffery pine") ~ "jeffrey pine",
    str_detect(species_common_name, "^kidneywood$") ~ "texas kidneywood",
    str_detect(species_common_name, "^knockaway$") ~ "anacua",
    str_detect(species_common_name, "^lacebark elm$") ~ "chinese elm",
    str_detect(species_common_name, "^leadball tree$") ~ "goldenball leadtree",
    str_detect(species_common_name, "^ligustrum$") ~ "privet spp.",
    str_detect(species_common_name, "^lilac chasetree") ~ "chaste tree",
    str_detect(species_common_name, "^linden spp.") ~ "basswood spp.",
    str_detect(species_common_name, "^little walnut") ~ "texas walnut",
    str_detect(species_common_name, "^littleleaf leadtree") ~ "goldenball leadtree",
    str_detect(species_common_name, "^live \\(southern") ~ "live oak",
    
    str_detect(species_common_name, "^loquat$") ~ "japanese medlar",
    str_detect(species_common_name, "^love oak") ~ "live oak",
    str_detect(species_common_name, "^maple$") ~ "maple spp.",
    str_detect(species_common_name, "^mescal \\(texas mountain laurel") ~ "texas mountain laurel",
    str_detect(species_common_name, "^mesquite$") ~ "mesquite spp.",
    str_detect(species_common_name, "^mexican sabal palm") ~ "mexican palmetto",
    str_detect(species_common_name, "^mexican whie oak") ~ "mexican white oak",
    str_detect(species_common_name, "^mexican white \\(netleaf") ~ "mexican white oak",
    str_detect(species_common_name, "^mimosa$") ~ "persian silk tree", #synonym
    str_detect(species_common_name, "^mock orange tobira") ~ "japanese pittosporum", #synonym
    
    str_detect(species_common_name, "^monterey oak") ~ "mexican white oak", #synonym
    str_detect(species_common_name, "^monterey white oak") ~ "mexican white oak", #synonym
    str_detect(species_common_name, "^monterrey oak") ~ "mexican white oak", #synonym
    
    str_detect(species_common_name, "^montezuma bald cypress") ~ "montezuma cypress",
    str_detect(species_common_name, "^mountain laural") ~ "texas mountain laurel",
    str_detect(species_common_name, "^mountain laurel") ~ "texas mountain laurel",
    str_detect(species_common_name, "^mt. laurel") ~ "texas mountain laurel",
    
    str_detect(species_common_name, "^mulberry$") ~ "texas mulberry",
    str_detect(species_common_name, "^mulberry. texas$") ~ "texas mulberry",
    
    
    str_detect(species_common_name, "^oak$") ~ "oak spp.",
    str_detect(species_common_name, "^ohio buckeye") ~ "texas buckeye",
    str_detect(species_common_name, "^orange$") ~ "citrus spp.",
    str_detect(species_common_name, "^orange osage$") ~ "osage orange",

    str_detect(species_common_name, "^ornamental pear$") ~ "callery pear",
    str_detect(species_common_name, "^palm$") ~ "palm spp.",
    str_detect(species_common_name, "^palmetto$") ~ "palm spp.",
    str_detect(species_common_name, "^palo verde$") ~ "texas paloverde",
    str_detect(species_common_name, "^photinia$") ~ "photinia spp.",
    str_detect(species_common_name, "^pine$") ~ "pine spp.",
    str_detect(species_common_name, "^plum$") ~ "plum spp.",
    str_detect(species_common_name, "^possum haw$") ~ "possumhaw",
    str_detect(species_common_name, "^prickly lime$") ~ "lime pricklyash",
    str_detect(species_common_name, "^privet$") ~ "privet spp.",
    str_detect(species_common_name, "^quercus buckley$") ~ "texas red oak",
    str_detect(species_common_name, "^quercus marilandica") ~ "blackjack oak",
    str_detect(species_common_name, "^quercus stellata") ~ "post oak",
      
    str_detect(species_common_name, "^red oak$") ~ "texas red oak",
    str_detect(species_common_name, "^red oak chisos") ~ "chisos red oak",
    str_detect(species_common_name, "^red tip photenia") ~ "red tip photinia",
    str_detect(species_common_name, "^red tip proteins") ~ "red tip photinia",
    str_detect(species_common_name, "^redbud$") ~ "redbud spp.",
    str_detect(species_common_name, "^retama$") ~ "jerusalem thorn", #synonym
    str_detect(species_common_name, "^rio grande palmetto") ~ "mexican palmetto", #synonym
    str_detect(species_common_name, "^rose-of-sharon") ~ "rose of sharon", 
    
    str_detect(species_common_name, "^scarlet oak") ~ "scarlet oak", 
    str_detect(species_common_name, "^shin oak$") ~ "gray oak", #synonym
    
    str_detect(species_common_name, "^silk tree$") ~ "silk spp.", 
    str_detect(species_common_name, "^silktree$") ~ "silk spp.", 
    str_detect(species_common_name, "^silk tree mimosa") ~ "persian silk tree", #synonym
    str_detect(species_common_name, "^small's acacia") ~ "sweet acacia", #synonym
    str_detect(species_common_name, "^southern live oak") ~ "live oak", 
    str_detect(species_common_name, "^southern pecan") ~ "hardy pecan", #synonym
    str_detect(species_common_name, "^stone fruit spp.") ~ "plum spp.", #synonym
    str_detect(species_common_name, "^sumac$") ~ "sumac spp.",

    str_detect(species_common_name, "^sweet gum$") ~ "american sweetgum", 
    str_detect(species_common_name, "^sweetgum$") ~ "american sweetgum", 
    str_detect(species_common_name, "^sycamore. mexican") ~ "mexican sycamore", 
    str_detect(species_common_name, "^texas elm") ~ "cedar elm", 
    str_detect(species_common_name, "^texas live \\(escarpment") ~ "escarpment live oak", 
    str_detect(species_common_name, "^texas olive") ~ "anacahuita", #synonym
    str_detect(species_common_name, "^texas pistache") ~ "texas pistachio", 
    str_detect(species_common_name, "^texas sumac") ~ "prairie sumac", 
    str_detect(species_common_name, "^texasplume") ~ "anacacho orchid tree", 
    str_detect(species_common_name, "^thornless chilean mesquite") ~ "chilean mesquite", 

    str_detect(species_common_name, "^tree of heaven") ~ "ailanthus", 
    str_detect(species_common_name, "^ulmus crassifolia") ~ "cedar elm", 
    str_detect(species_common_name, "^velvet \\(arizona ash") ~ "velvet ash", 
    str_detect(species_common_name, "^vitex$") ~ "vitex spp.", 
    
    str_detect(species_common_name, "^walnut$") ~ "walnut spp.", 
    str_detect(species_common_name, "^wax myrtle$") ~ "southern wax myrtle", 
    str_detect(species_common_name, "^waxleaf ligustrum") ~ "japanese privet", 
    str_detect(species_common_name, "^western catalpa") ~ "northern catalpa", 
    str_detect(species_common_name, "^white shin oak") ~ "bigelow oak", #synonym
    str_detect(species_common_name, "^wingleaf soapberry") ~ "western soapberry", #synonym
    str_detect(species_common_name, "^yaupon$") ~ "yaupon holly", #synonym
    
                            
        TRUE ~ species_common_name
  ))

austin_trees_clean <- left_join(austin_trees_clean, spp_code, by = "species_common_name") %>% 
  filter(!is.na(species_botanical_name)) %>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))


austin_trees_clean<-austin_trees_clean[, c(5:8,4,3,9,1:2)]

austin_trees_clean <- austin_trees_clean %>% 
 filter(long >= -100.00 & long <= -90.00,
    lat >= 25.00 & lat <= 35.00)

#write.csv(austin_trees_clean, "~/Dropbox/Urban_data/Cleaned/austin_trees_clean.csv", row.names = FALSE)

```


#Baltimore
  Only public street trees
  Downloaded from: https://baltimore.maps.arcgis.com/apps/webappviewer/index.html?id=d2cfbbe9a24b4d988de127852e6c26c8
  DBH in inches
```{r}
baltimore_trees<- read.csv("~/Dropbox/Urban_data/Raw/baltimore_md_usa.csv")

baltimore_trees$country <- "usa"
baltimore_trees$state <- "maryland"
baltimore_trees$city <- "baltimore"
baltimore_trees$year <- "2018" #from 2018

baltimore_trees_clean <- baltimore_trees %>% 
  dplyr::rename(lat = Y_COORD,
                long = X_COORD,
                species_botanical_name = SPP,
                dbh = DBH) %>%  
  select(c(lat, long, species_botanical_name, dbh, country, state, city, year))%>% 
  filter(!grepl("^vacant site|^unknown|^stump", species_botanical_name, ignore.case = TRUE)) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name))%>%
  mutate(species_botanical_name = sub("spp$", "spp.", species_botanical_name))%>%
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name))

baltimore_trees_clean$dbh <- baltimore_trees_clean$dbh * 2.54 ##converting from inches to cm

baltimore_trees_clean$species_botanical_name[baltimore_trees_clean$species_botanical_name == ""] <- NA

baltimore_trees_clean <- baltimore_trees_clean %>%
  mutate(species_botanical_name = case_when(
 
    str_detect(species_botanical_name, "^ cupressocyparis leylandii") ~ "cupressocyparis leylandii",
    str_detect(species_botanical_name, "^acer tataricum ginnala") ~ "acer ginnala",
    str_detect(species_botanical_name, "^chamaecyparis lawsonia") ~ "chamaecyparis lawsoniana",
    str_detect(species_botanical_name, "^cornus $") ~ "cornus spp.",
    str_detect(species_botanical_name, "^crataegus crusgalli") ~ "crataegus crus-galli",
    str_detect(species_botanical_name, "^fraxinus tomentosa") ~ "fraxinus profunda",
    str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
    str_detect(species_botanical_name, "^ilex $") ~ "ilex spp.",
    str_detect(species_botanical_name, "^kalopanax pictus") ~ "kalopanax septemlobus",
    str_detect(species_botanical_name, "^magnolia $") ~ "magnolia spp.",
    str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
    str_detect(species_botanical_name, "^persimmon, japanese") ~ "diospyros kaki",
    str_detect(species_botanical_name, "^populus nigra") ~ "populus nigra",
    str_detect(species_botanical_name, "^prunus incamp") ~ "prunus incam",
    str_detect(species_botanical_name, "^quercus $") ~ "quercus spp.",
    str_detect(species_botanical_name, "^tsuga candensis") ~ "tsuga canadensis",
    str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.",
    str_detect(species_botanical_name, "^ulmus thomasi") ~ "ulmus thomasii",
    
    TRUE ~ species_botanical_name
  ))


baltimore_trees_clean <- left_join(baltimore_trees_clean, spp_code, by = "species_botanical_name")

baltimore_trees_clean <- baltimore_trees_clean %>% 
  filter(!is.na(species_botanical_name))

baltimore_trees_clean<-baltimore_trees_clean[, c(5:8,2,1,3,9,4)]

#write.csv(baltimore_trees_clean, "~/Dropbox/Urban_data/Cleaned/baltimore_trees_clean.csv", row.names = FALSE)


```

#Bloomington 
  DBH is in inches
  Data downloaded from: https://bloomingtonin.treekeepersoftware.com
  
```{r}
bloomington_trees<- read.csv("~/Dropbox/Urban_data/Raw/bloomington_in_usa.csv")

bloomington_trees$country <- "usa"
bloomington_trees$state <- "indiana"
bloomington_trees$city <- "bloomington"
bloomington_trees$year <- "2022" #updated in 2022

bloomington_trees_clean <- bloomington_trees %>% 
  dplyr::rename(lat = Latitude,
                long = Longitude,
                dbh = DBH, #in inches
                species_botanical_name = Species) %>% 
  select(c(lat, long, species_botanical_name, dbh, country, state, city, year))%>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>%
  filter(!grepl("^empty", species_botanical_name, ignore.case = TRUE))%>%
  filter(dbh > 0) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("species$|sp$|sp.$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

bloomington_trees_clean$dbh <- bloomington_trees_clean$dbh * 2.54 ##converting from inches to cm

bloomington_trees_clean$species_botanical_name[bloomington_trees_clean$species_botanical_name == ""] <- NA

# Replace "species_botanical_name" column with modified values
bloomington_trees_clean$species_botanical_name <- gsub(".*\\((.*)\\).*", "\\1", bloomington_trees_clean$species_botanical_name) ##extracting botanical name


bloomington_trees_clean <- bloomington_trees_clean %>%
  mutate(species_botanical_name = case_when(
    str_detect(species_botanical_name, "^acer campestre") ~ "acer campestre",
    str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
    str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
    str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
    str_detect(species_botanical_name, "^acer freemannii") ~ "acer freemanii",
    str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
    str_detect(species_botanical_name, "^acer tataricum ginnala") ~ "acer ginnala",
    str_detect(species_botanical_name, "^aesculus arnoldiana") ~ "aesculus arnoldiana",
    str_detect(species_botanical_name, "^acer truncatum") ~ "acer truncatum x platanoides",
    str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
    str_detect(species_botanical_name, "^celtics occidentalis") ~ "celtis occidentalis",
    str_detect(species_botanical_name, "^celtis occidentalis") ~ "celtis occidentalis",
    str_detect(species_botanical_name, "^crataegus virdis") ~ "crataegus viridis",
    
    str_detect(species_botanical_name, "^aesculus x carnea") ~ "aesculus carnea",
    str_detect(species_botanical_name, "^amelanchier laevis") ~ "amelanchier laevis",
    
    str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
    
    
    str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
    str_detect(species_botanical_name, "^celtis species") ~ "celtis spp.",
    str_detect(species_botanical_name, "^crataegus species") ~ "crataegus spp.",
    str_detect(species_botanical_name, "^celtics occidentalis") ~ "celtics occidentalis",
    str_detect(species_botanical_name, "^crataegus crusgalli") ~ "crataegus crus-galli",
    str_detect(species_botanical_name, "^crataegus virdis") ~ "crataegus virdis",
    
    str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
    str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
    str_detect(species_botanical_name, "^ilex opaca") ~ "ilex opaca",
    
    str_detect(species_botanical_name, "^juniperus j.n. ‘select blue’") ~ "juniperus j.n. select blue",
    str_detect(species_botanical_name, "^juniperus virginiana") ~ "juniperus virginiana",
    
    str_detect(species_botanical_name, "^liquidamber styraciflua") ~ "liquidambar styraciflua",
    str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",

    str_detect(species_botanical_name, "^liriodendron tulipifera") ~ "liriodendron tulipifera",
    
    str_detect(species_botanical_name, "^maclura pomifera") ~ "maclura pomifera",
    str_detect(species_botanical_name, "^malus halliana") ~ "malus adirondack", #name swap
    str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
    str_detect(species_botanical_name, "^nyssa sylvatica") ~ "nyssa sylvatica", 
    str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia", 
        
    str_detect(species_botanical_name, "^quercus $") ~ "quercus spp.", 
    str_detect(species_botanical_name, "^quercus × warei") ~ "quercus warei", 
    str_detect(species_botanical_name, "^quercus macrocarpa robur") ~ "quercus macdanielii", 
    str_detect(species_botanical_name, "^quercus warei") ~ "quercus warei", 
    str_detect(species_botanical_name, "^ulmus davidiana var. japonica") ~ "ulmus davidiana var. japonica", 
    str_detect(species_botanical_name, "^ulmus parvifolia") ~ "ulmus parvifolia", 
    
    str_detect(species_botanical_name, "^salix alba") ~ "salix alba", 
    str_detect(species_botanical_name, "^taxodium distichum") ~ "taxodium distichum", 
    str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana", 
    str_detect(species_botanical_name, "^tsuga candensis") ~ "tsuga canadensis", 
              
    str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.", 
    str_detect(species_botanical_name, "^ulmus ‘patriot’") ~ "ulmus patriot", 
    str_detect(species_botanical_name, "^ulmus carpinifolia ‘triumph’") ~ "ulmus triumph", 
    str_detect(species_botanical_name, "^ulmus carp parvifolia ‘frontier’") ~ "ulmus carpinifolia x parvifolia", 
    
    
    str_detect(species_botanical_name, "^fraxinus  species") ~ "fraxinus spp.",
    str_detect(species_botanical_name, "^koelreuteria paniculata") ~ "koelreuteria paniculata",
    str_detect(species_botanical_name, "^magnolia  species") ~ "magnolia spp.",
    str_detect(species_botanical_name, "^malus 'golden raindrops'") ~ "malus transitoria",
    str_detect(species_botanical_name, "^malus 'jfs-kw5'") ~ "malus jfs-kw5",
    str_detect(species_botanical_name, "^malus 'sutyzam'") ~ "malus sutyzam",
    str_detect(species_botanical_name, "^malus 'snowdrift'") ~ "malus snowdrift",
    str_detect(species_botanical_name, "^morus species") ~ "morus spp.",
    str_detect(species_botanical_name, "^picea glauca") ~ "picea glauca",
    str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
    str_detect(species_botanical_name, "^platanus x acerifolia") ~ "platanus acerifolia",
    str_detect(species_botanical_name, "^prunus subhirtella") ~ "prunus subhirtella",
    str_detect(species_botanical_name, "^prunus x cistena") ~ "prunus cistena",
    str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
    str_detect(species_botanical_name, "^pyrus species") ~ "pyrus spp.",
    str_detect(species_botanical_name, "^quercus bicolor") ~ "quercus bicolor",
    str_detect(species_botanical_name, "^quercus palustris") ~ "quercus palustris",
    str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
    str_detect(species_botanical_name, "^quercus x schuettei") ~ "quercus schuettei",
    str_detect(species_botanical_name, "^quercus x warei") ~ "quercus warei",
    str_detect(species_botanical_name, "^sophora japonica") ~ "sophora japonica",
    str_detect(species_botanical_name, "^syringa pekinensis") ~ "syringa pekinensis",
    str_detect(species_botanical_name, "^syringa species") ~ "syringa spp.",
    str_detect(species_botanical_name, "^thuja species") ~ "thuja spp.",
    str_detect(species_botanical_name, "^tilia species") ~ "tilia spp.",
    str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
    str_detect(species_botanical_name, "^quercus bicolor") ~ "quercus bicolor",
    str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
    str_detect(species_botanical_name, "^ulmus carpinifolia 'hollandica'") ~ "ulmus hollandica",
    str_detect(species_botanical_name, "^ulmus species'") ~ "ulmus spp.",
    str_detect(species_botanical_name, "^ulmus carp parvifolia 'frontier'") ~ "ulmus carpinifolia x parvifolia",
    str_detect(species_botanical_name, "^ulmus carpinifolia ‘triumph’'") ~ "ulmus triumph",
    
    str_detect(species_botanical_name, "^ulmus davidiana var. japonica'") ~ "ulmus davidiana var. japonica",
    str_detect(species_botanical_name, "^zelkova species'") ~ "zelkova spp.",
    str_detect(species_botanical_name, "^ulmus parvifolia'") ~ "ulmus parvifolia",
    TRUE ~ species_botanical_name
  ))


bloomington_trees_clean <- left_join(bloomington_trees_clean,spp_code, by= "species_botanical_name") %>%
  filter(!is.na(species_botanical_name))


bloomington_trees_clean<-bloomington_trees_clean[, c(5:8,2,1,3,9,4)]

#write.csv(bloomington_trees_clean, "~/Dropbox/Urban_data/Cleaned/bloomington_trees_clean.csv", row.names = FALSE)


```

#Boston

```{r}
#Clean
boston_trees<- read.csv("~/Dropbox/Urban_data/Raw/boston_ma_usa.csv")


boston_trees$country <- "usa"
boston_trees$state <- "massachusetts"
boston_trees$city <- "boston"
boston_trees$year <- "2021" #as of May 2021

boston_trees_clean <- boston_trees %>% 
  dplyr::rename(lat = Latitude,
                long = Longitude,
                dbh = DBH, #in inches
                species_botanical_name = Scientific) %>% 
  select(c(lat, long, species_botanical_name, dbh, country, state, city, year))%>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>%
  filter(!grepl("^empty|other$", species_botanical_name, ignore.case = TRUE))
  # filter(species_botanical_name != " " & species_botanical_name != "^empty") 

boston_trees_clean$dbh <- boston_trees_clean$dbh * 2.54 ##converting from inches to cm

#boston_trees_clean <- boston_trees_clean %>% 
  #mutate(species_botanical_name = case_when(
    #species_botanical_name == "acer campestre 'queen Elizabeth'" ~ "acer campestre",
    #species_botanical_name == "^acer platanoides" ~ "acer platanoides",
   # species_botanical_name == "acer miyabei 'morton'" ~ "acer miyabei",
    #species_botanical_name == "acer platanoides 'columnare'" ~ "acer platanoides",
    #species_botanical_name == "acer platanoides 'crimson king'" ~ "acer platanoides",
    
  #  species_botanical_name == "quercus bicolor 'bonnie and mike'" ~ "quercus bicolor",
 #   TRUE ~ species_botanical_name
#  )) 
boston_trees_clean <- boston_trees_clean %>%
  mutate(species_botanical_name = case_when(
    str_detect(species_botanical_name, "^acer campestre") ~ "acer campestre",
    str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
    str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
    str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
    str_detect(species_botanical_name, "^acer x freemanii") ~ "acer freemanii",
    str_detect(species_botanical_name, "^acer truncatum") ~ "acer truncatum x platanoides",
    str_detect(species_botanical_name, "^aesculus x carnea") ~ "aesculus carnea",
    str_detect(species_botanical_name, "^amelanchier laevis") ~ "amelanchier laevis",
    str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
    str_detect(species_botanical_name, "^celtis species") ~ "celtis spp.",
    str_detect(species_botanical_name, "^corylus  spp.") ~ "corylus spp.",
    
    str_detect(species_botanical_name, "^crataegus  species") ~ "crataegus spp.",
    str_detect(species_botanical_name, "^fraxinus  species") ~ "fraxinus spp.",
    str_detect(species_botanical_name, "^koelreuteria paniculata") ~ "koelreuteria paniculata",
    
    str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
    str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
    
    str_detect(species_botanical_name, "^magnolia  species") ~ "magnolia spp.",
    str_detect(species_botanical_name, "^magnolia x soulangiana") ~ "magnolia soulangeana",
    
    str_detect(species_botanical_name, "^malus 'golden raindrops'") ~ "malus transitoria",
    str_detect(species_botanical_name, "^malus 'jfs-kw5'") ~ "malus jfs-kw5",
    str_detect(species_botanical_name, "^malus 'sutyzam'") ~ "malus sutyzam",
    str_detect(species_botanical_name, "^malus 'snowdrift'") ~ "malus snowdrift",
    str_detect(species_botanical_name, "^malus x 'snowdrift'") ~ "malus snowdrift",
    
    str_detect(species_botanical_name, "^morus species") ~ "morus spp.",
    str_detect(species_botanical_name, "^picea glauca") ~ "picea glauca",
    str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
    str_detect(species_botanical_name, "^platanus x acerifolia") ~ "platanus acerifolia",
    str_detect(species_botanical_name, "^prunus subhirtella") ~ "prunus subhirtella",
    str_detect(species_botanical_name, "^prunus x cistena") ~ "prunus cistena",
    str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
    str_detect(species_botanical_name, "^prunus x incamp") ~ "prunus incam",
    str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
    
    str_detect(species_botanical_name, "^prunus species") ~ "prunus spp.",
    
    str_detect(species_botanical_name, "^pyrus species") ~ "pyrus spp.",
    str_detect(species_botanical_name, "^quercus bicolor") ~ "quercus bicolor",
    str_detect(species_botanical_name, "^quercus palustris") ~ "quercus palustris",
    str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
    str_detect(species_botanical_name, "^quercus x schuettei") ~ "quercus schuettei",
    str_detect(species_botanical_name, "^quercus x warei") ~ "quercus warei",
    str_detect(species_botanical_name, "^sophora japonica") ~ "styphnolobium japonicum",
    str_detect(species_botanical_name, "^syringa pekinensis") ~ "syringa pekinensis",
    str_detect(species_botanical_name, "^syringa species") ~ "syringa spp.",
    str_detect(species_botanical_name, "^thuja species") ~ "thuja spp.",
    str_detect(species_botanical_name, "^tilia  species") ~ "tilia spp.",
    str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
    str_detect(species_botanical_name, "^quercus bicolor") ~ "quercus bicolor",
    str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
    str_detect(species_botanical_name, "^ulmus carpinifolia 'hollandica'") ~ "ulmus hollandica",
    str_detect(species_botanical_name, "^ulmus 'morton'") ~ "ulmus japonica x wilsoniana",
    
    str_detect(species_botanical_name, "^ulmus species") ~ "ulmus spp.",
    str_detect(species_botanical_name, "^ulmus x 'frontier'") ~ "ulmus carpinifolia x parvifolia",
    str_detect(species_botanical_name, "^viburnum species") ~ "viburnum spp.",
    str_detect(species_botanical_name, "^zelkova  species") ~ "zelkova spp.",
    str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
    TRUE ~ species_botanical_name
  ))


boston_trees_clean<-left_join(boston_trees_clean,spp_code, by= "species_botanical_name") %>% 
  filter(!is.na(species_common_name)) 

boston_trees_clean<-boston_trees_clean[, c(5:8,2,1,3,9,4)]

#write.csv(boston_trees_clean, "~/Dropbox/Urban_data/Cleaned/boston_trees_clean.csv", row.names = FALSE)


```



#Boulder, CO, USA

Data downloaded from: https://open-data.bouldercolorado.gov/datasets/dbbae8bdb0a44d17934243b88e85ef2b
  https://webappsprod.bouldercolorado.gov/opendata/Trees_Public_Read_Me.pdf
  Metadata: https://www.arcgis.com/sharing/rest/content/items/dbbae8bdb0a44d17934243b88e85ef2b/info/metadata/metadata.xml?format=default&output=html 


```{r}

#Clean
boulder_trees<- read.csv("~/Dropbox/Urban_data/Raw/boulder_co_usa.csv")

boulder_trees$country <- "usa"
boulder_trees$state <- "colorado"
boulder_trees$city <- "boulder"
boulder_trees$year <- "2022" #as of Sept. 27, 2022

boulder_trees_clean <- boulder_trees %>% 
  dplyr::rename(lat = Y,
                long = X,
                dbh = DBHINT,
                species_botanical_name = LATINNAME) %>% #in inches!
  select(c(lat, long, species_botanical_name, dbh, country, state, city, year))%>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
   filter(!grepl("^vacant|^unknown|^not applicable", species_botanical_name, ignore.case = TRUE)) %>%
  mutate(species_botanical_name = sub("spp$", "spp.", species_botanical_name))%>%
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name))

boulder_trees_clean$dbh <- boulder_trees_clean$dbh * 2.54 ##converting from inches to cm

boulder_trees_clean <- boulder_trees_clean[complete.cases(boulder_trees_clean$long, boulder_trees_clean$lat), ]

boulder_trees_clean <- boulder_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^magnolia ann") ~ "magnolia liliiflora x stellata",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
   str_detect(species_botanical_name, "^ostrya viginiana") ~ "ostrya virginiana",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^ulmus accolade") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus hybrida") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^ulmus morton") ~ "ulmus japonica x wilsoniana",
   TRUE ~ species_botanical_name
  ))

boulder_trees_clean <- left_join(boulder_trees_clean, spp_code, by = "species_botanical_name") #%>% 
  #mutate(species_common_name = ifelse(!is.na(new_botanical_name), new_common_name, species_common_name)) %>% 
 # filter(is.na())

boulder_trees_clean <- boulder_trees_clean %>% 
  filter(!is.na(species_common_name)) %>% 
  filter(!is.na(dbh)) 

boulder_trees_clean<-boulder_trees_clean[, c(5:8,2,1,3,9,4)]

#write.csv(boulder_trees_clean, "~/Dropbox/Urban_data/Cleaned/boulder_trees_clean.csv", row.names = FALSE)


```


#Buffalo, NY, USA


Data downloaded from: https://data.buffalony.gov/Quality-of-Life/Tree-Inventory/n4ni-uuec/data

```{r}

#Clean
buffalo_trees<- read.csv("~/Dropbox/Urban_data/Raw/buffalo_ny_usa.csv")


buffalo_trees$country <- "usa"
buffalo_trees$state <- "new york"
buffalo_trees$city <- "buffalo"
buffalo_trees$year <- "2018" #as of 2018

buffalo_trees_clean <- buffalo_trees %>% 
  dplyr::rename(lat = Latitude,
                long = Longitude,
                dbh = DBH, ##in inches!
                species_botanical_name = Botanical.Name) %>% 
                #species_common_name = Common.Name) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>% 
  filter(dbh > 0) %>% 
  filter(!grepl("^VACANT|^STUMP|^0|^unknown|^*calls|^44|^standing", species_botanical_name, ignore.case = TRUE)) %>% 
  #mutate(species_common_name = tolower(species_common_name)) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name))%>%
  mutate(species_botanical_name = sub("spp$|species$|sp.$", "spp.", species_botanical_name))%>%
 # mutate(species_botanical_name = sub("species$", "spp.", species_botanical_name))%>%
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("^taxus$", "taxus spp.", species_botanical_name))#%>% 
  #mutate(species_botanical_name = gsub("ulmus", "ulmus spp.", species_botanical_name))
  
  
buffalo_trees_clean$dbh <- buffalo_trees_clean$dbh * 2.54 ##converting from inches to cm
#buffalo_trees_clean<-left_join(buffalo_trees_clean,spp_code, by.x= "species_botanical_name", by.y="species_botanical_name")

buffalo_trees_clean <- buffalo_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer pseudoplatanus") ~ "acer pseudoplatanus",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer truncatum platanoides") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^aesculus carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^aesculus hippocastanum") ~ "aesculus hippocastanum",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^amelanchier laevis") ~ "amelanchier laevis",
   str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
   str_detect(species_botanical_name, "^chamaecyparis") ~ "chamaecyparis spp.",
   str_detect(species_botanical_name, "^cornus constellation") ~ "cornus florida x kousa",
   str_detect(species_botanical_name, "^cornus rutgersensis") ~ "cornus rutgersensis",
   str_detect(species_botanical_name, "^crataegus crusgalli") ~ "crataegus crus-galli",
   str_detect(species_botanical_name, "^crategus virdis") ~ "crataegus viridis",
   str_detect(species_botanical_name, "^crataegus virdis") ~ "crataegus viridis",
   str_detect(species_botanical_name, "^fagus sylvatica") ~ "fagus sylvatica",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^catalpa spp.ciosa") ~ "catalpa speciosa",
   str_detect(species_botanical_name, "^diospp.ros virginiana") ~ "diospyros virginiana",
   str_detect(species_botanical_name, "^halesia tetraptera") ~ "halesia tetraptera",
   str_detect(species_botanical_name, "^hamamelis intermedia") ~ "hamamelis intermedia",
   str_detect(species_botanical_name, "^ligustrum sinese") ~ "ligustrum sinense",
   str_detect(species_botanical_name, "^liquidambar stryaciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^malcura pomnifera") ~ "maclura pomifera",
   str_detect(species_botanical_name, "^malus adirondack") ~ "malus adirondack",
  # str_detect(species_botanical_name, "^malus harvest gold") ~ "malus harvest gold",
  # str_detect(species_botanical_name, "^malus donald wyman") ~ "malus donald wyman",
   str_detect(species_botanical_name, "^malus red baron") ~ "malus red barron",
   str_detect(species_botanical_name, "^malus pink spire") ~ "malus pink spires",
   str_detect(species_botanical_name, "^malus baccata") ~ "malus baccata",
   str_detect(species_botanical_name, "^malus prariefire") ~ "malus prairifire",
   str_detect(species_botanical_name, "^malus domestica") ~ "malus domestica",
   str_detect(species_botanical_name, "^picea omarika") ~ "picea omorika",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus okame") ~ "prunus incam",
   str_detect(species_botanical_name, "^prunus sargentii") ~ "prunus sargentii",
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus subhirtella") ~ "prunus subhirtella",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus callerana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus macdanielii") ~ "quercus macdanielii",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^malus sugar tyme") ~ "malus sutyzam",
   str_detect(species_botanical_name, "^prunus communis") ~ "pyrus communis",
   str_detect(species_botanical_name, "^pyrus communis") ~ "pyrus communis",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   str_detect(species_botanical_name, "^salix matsudana") ~ "salix matsudana",
   str_detect(species_botanical_name, "^styphnolobium japonicum") ~ "styphnolobium japonicum",
   str_detect(species_botanical_name, "^syringa reticulata") ~ "syringa reticulata",
   str_detect(species_botanical_name, "^taxus") ~ "taxus spp.",
   str_detect(species_botanical_name, "^thuja occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^ulmus carpinifolia christine") ~ "ulmus carpinifolia",
   str_detect(species_botanical_name, "^ulmus carpinifolia parvifolia") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus dananda charm") ~ "ulmus morton red tip",
   str_detect(species_botanical_name, "^ulmus davidiana var. japonica") ~ "ulmus davidiana var. japonica",
   str_detect(species_botanical_name, "^ulmus glabra carpinifolia") ~ "ulmus davidiana var. japonica",
   str_detect(species_botanical_name, "^ulmus japonica pumila") ~ "ulmus pumila",
   str_detect(species_botanical_name, "^ulmus japonica wilsoniana morton") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus spp. new horizon") ~ "ulmus new horizon",
   str_detect(species_botanical_name, "^ulmus propinqua") ~ "ulmus propinqua",
   str_detect(species_botanical_name, "^ulmus spp. triumph") ~ "ulmus triumph",
  str_detect(species_botanical_name, "^ulmus commendation") ~ "ulmus commendation",
   str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
  
  str_detect(species_botanical_name, "^aesculus octandra") ~ "aesculus flava",
  str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
  str_detect(species_botanical_name, "^sophora japonica") ~ "styphnolobium japonicum",
  str_detect(species_botanical_name, "^betula jacqemontii") ~ "betula jacquemontii",
  str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   TRUE ~ species_botanical_name
  ))

buffalo_trees_clean <- left_join(buffalo_trees_clean, spp_code, by = "species_botanical_name") %>%
  select(-c(hort_code))

buffalo_trees_clean <- buffalo_trees_clean %>% 
  filter(!is.na(species_botanical_name)) 


buffalo_trees_clean<-buffalo_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(buffalo_trees_clean, "~/Dropbox/Urban_data/Cleaned/buffalo_trees_clean.csv", row.names = FALSE)

#Map 

buffalo <- c(-78.8784, 42.8864)


  #Create a leaflet map of buffalo
buffalo_map <- leaflet() %>%
  setView(lng = buffalo[1], lat = buffalo[2], zoom = 10) %>%
  addTiles()

  #Add tree data to the leaflet map
buffalo_map <- buffalo_map %>%
  addCircleMarkers(data = buffalo_trees_clean, lng = ~long, lat = ~lat,
                   color = "green", radius = 3, stroke = FALSE, fillOpacity = 0.5)

  #Display leaflet map
buffalo_map


```


#Calgary, Alberta, CA
Downloaded from: https://maps.calgary.ca/TreeSchedule/
  DBH in cm
```{r}

#Clean
calgary_trees<- read.csv("~/Dropbox/Urban_data/Raw/calgary_alberta_ca.csv")

calgary_trees$country <- "ca"
calgary_trees$state <- "alberta"
calgary_trees$city <- "calgary"
calgary_trees$year <- "2023" #as of March 8, 2023


calgary_trees_clean <- calgary_trees %>% 
   mutate(
    long = as.numeric(str_extract(POINT, "-?\\d+\\.\\d+")),
    lat = as.numeric(str_extract(POINT, " \\d+\\.\\d+"))) %>% 
  dplyr::rename(dbh = DBH_CM,
                genus = GENUS,
                species = SPECIES) %>% 
  filter(ASSET_TYPE == "TREE") %>% 
  select(c(lat, long, dbh, genus, species, country, state, city, year))%>% 
  #mutate(species_common_name = tolower(species_common_name)) %>% 
  mutate(genus = tolower(genus)) %>% 
  mutate(species = tolower(species)) 

calgary_trees_clean$genus[calgary_trees_clean$genus == ""] <- NA
calgary_trees_clean$species[calgary_trees_clean$species == ""] <- NA
calgary_trees_clean$species[calgary_trees_clean$species == "x"] <- NA
calgary_trees_clean <- calgary_trees_clean%>% 
 filter(!is.na(genus)) %>% 
 mutate(species = ifelse(!is.na(species), species, "spp."))

calgary_trees_clean$species_botanical_name <- paste(calgary_trees_clean$genus, calgary_trees_clean$species, sep = " ")


calgary_trees_clean <- calgary_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^betula fontinalis") ~ "betula occidentalis",
   str_detect(species_botanical_name, "^betula platyphylla") ~ "betula platyphylla",
   str_detect(species_botanical_name, "^fraxinus pennsylvancia") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^hydrangea paniculata") ~ "hydrangea paniculata",
   str_detect(species_botanical_name, "^philadelphus lewissii") ~ "philadelphus lewisii",
   str_detect(species_botanical_name, "^picea englemannii") ~ "picea engelmannii",
   str_detect(species_botanical_name, "^populus deltoides / ") ~ "populus spp.",
   str_detect(species_botanical_name, "^populus salicaceae") ~ "populus spp.",
   str_detect(species_botanical_name, "^populus hybrida") ~ "populus tremuloides",
   str_detect(species_botanical_name, "^prunus besseyi") ~ "prunus pumila var. besseyi",
   str_detect(species_botanical_name, "^prunus pennsylvanica") ~ "prunus pensylvanica",
   str_detect(species_botanical_name, "^pyrus usseriensis") ~ "pyrus ussuriensis",
   str_detect(species_botanical_name, "^quercus gambeii") ~ "quercus gambelii",
   str_detect(species_botanical_name, "^ribes uva-crispa") ~ "ribes uva-crispa var. reclinatum",
   str_detect(species_botanical_name, "^symphoricarpus alba") ~ "symphoricarpos albus",
   str_detect(species_botanical_name, "^symphoricarpus mexicanus") ~ "symphoricarpos mexicanus",
   str_detect(species_botanical_name, "^tilia mongolica") ~ "tilia mongolica",
   
   TRUE ~ species_botanical_name
  ))

calgary_trees_clean <- left_join(calgary_trees_clean, spp_code, by = "species_botanical_name") %>%
  #mutate(species_common_name = ifelse(!is.na(new_botanical_name), new_common_name, species_common_name)) %>% 
  select(-c(genus,species)) %>% 
  filter(!is.na(species_common_name))%>% 
  filter(!is.na(dbh))

calgary_trees_clean<-calgary_trees_clean[, c(4:7,2,1,8:9,3)]

#write.csv(calgary_trees_clean, "~/Dropbox/Urban_data/Cleaned/calgary_trees_clean.csv", row.names = FALSE)


```

#Cambridge, Ontario, CA
Downloaded from: https://data.waterloo.ca/datasets/cityofcambridge::street-trees
  #DBH in cm
  
```{r}

#Clean
cambridge_trees<- read.csv("~/Dropbox/Urban_data/Raw/cambridge_ontario_ca.csv")

cambridge_trees$country <- "ca"
cambridge_trees$state <- "ontario"
cambridge_trees$city <- "cambridge"
cambridge_trees$year <- "2021" #as of Nov 8, 2021

cambridge_trees_clean <- cambridge_trees %>% 
  filter(STATUS != "REMOVED" & COMMON_NAME != "") %>% 
  dplyr::rename(long = X,
                lat = Y,
                dbh = DBH_CURRENT_CM,
                #species_common_name = COMMON_NAME,
                species_botanical_name = BOTANICAL_NAME) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>% 
  filter(!grepl("^proposed", species_botanical_name, ignore.case = TRUE)) %>% 
  filter(!is.na(dbh)) %>% 
 # mutate(species_common_name = tolower(species_common_name))%>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("sp$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) #%>% 
  #mutate(species_botanical_name = gsub("'", "", species_botanical_name))
  
#cambridge_trees_clean$species_botanical_name <- as.character(cambridge_trees_clean$species_botanical_name)
#cambridge_trees_clean$species_ <- as.character(cambridge_trees_clean$species_botanical_name)

#cambridge_trees_clean$species_botanical_name[cambridge_trees_clean$species_botanical_name == ""] <- NA

#test <- cambridge_trees_clean%>% 
 #filter(!is.na(species_botanical_name)) #%>% 
 #mutate(species = ifelse(!is.na(species), species, "spp."))


cambridge_trees_clean <- cambridge_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   
   TRUE ~ species_botanical_name
  ))

#cambridge_trees_clean$species_common_name[cambridge_trees_clean$species_common_name == ""] <- NA
#cambridge_trees_clean$species_botanical_name[cambridge_trees_clean$species_botanical_name == ""] <- NA

cambridge_trees_clean <- left_join(cambridge_trees_clean, spp_code, by = "species_botanical_name") %>% 
  #select(-c(code, new_common_name,new_botanical_name)) %>% 
  filter(!is.na(species_common_name))



cambridge_trees_clean<-cambridge_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(cambridge_trees_clean, "~/Dropbox/Urban_data/Cleaned/cambridge_trees_clean.csv", row.names = FALSE)

#Map 

cambridge <- c(-80.3148,43.3614)


  #Create a leaflet map of cambridge
cambridge_map <- leaflet() %>%
  setView(lng = cambridge[1], lat = cambridge[2], zoom = 10) %>%
  addTiles()

  #Add tree data to the leaflet map
cambridge_map <- cambridge_map %>%
  addCircleMarkers(data = cambridge_trees_clean, lng = ~long, lat = ~lat,
                   color = "green", radius = 3, stroke = FALSE, fillOpacity = 0.5)

  #Display leaflet map
cambridge_map

```

Charlottesville
Data downloaded from: https://hub.arcgis.com/datasets/charlottesville::tree-inventory-point/explore

```{r}

#Clean
char_trees<- read.csv("~/Dropbox/Urban_data/charlottesville_va_usa.csv")

char_trees$country <- "usa"
char_trees$state <- "va"
char_trees$city <- "charlottesville"
char_trees$year <- "2019" #as of Oct 10, 2019

char_trees_clean <- char_trees %>% 
  filter(Common_Name != "") %>% 
  dplyr::rename(long = X,
                lat = Y,
                dbh = DBH_CURRENT_CM,
                species_common_name = COMMON_NAME,
                genus = Genus,
                species = Species) %>% 
  select(c(lat, long, dbh, species_common_name, genus, species, country, state, city, year)) 
  
char_trees_clean<-char_trees_clean[, c(6:9,2,1,5,4,3)]

#Map 

cambridge <- c(-80.3148,43.3614)


  #Create a leaflet map of cambridge
cambridge_map <- leaflet() %>%
  setView(lng = cambridge[1], lat = cambridge[2], zoom = 10) %>%
  addTiles()

  #Add tree data to the leaflet map
cambridge_map <- cambridge_map %>%
  addCircleMarkers(data = cambridge_trees_clean, lng = ~long, lat = ~lat,
                   color = "green", radius = 3, stroke = FALSE, fillOpacity = 0.5)

  #Display leaflet map
cambridge_map

```


#Columbus
Data downloaded from: https://opendata.columbus.gov/datasets/columbus::public-owned-trees/explore
  Projected on NAD_1983_2011_StatePlane_Ohio_South _FIPS_3402_Ft_US
  Codes here: https://www.columbus.gov/uploadedFiles/Columbus/Departments/Technology/GIS/PDFFiles/Tree_Species.pdf
  DBH in inches
```{r}

#Clean
columbus_trees<- read.csv("~/Dropbox/Urban_data/Raw/columbus_oh_usa.csv")


columbus_trees$country <- "usa"
columbus_trees$state <- "ohio"
columbus_trees$city <- "columbus"
columbus_trees$year <- "2020" #as of Sept 1, 2020

columbus_trees <- columbus_trees[complete.cases(columbus_trees$X, columbus_trees$Y), ]

crs <- CRS("+proj=lcc +lat_1=38.73333333333333 +lat_2=40.03333333333333 +lat_0=38 +lon_0=-82.5 +x_0=600000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs")


# Create the SpatialPointsDataFrame
points <- SpatialPointsDataFrame(coords = columbus_trees[, c("X", "Y")],
                                 data = columbus_trees,
                                 proj4string = crs)

# Define the target CRS
target_crs <- CRS("+init=EPSG:4326")

# Transform the points to latitude and longitude
points_wgs84 <- spTransform(points, target_crs)

# Replace X and Y values with latitude and longitude points in the dataset
columbus_trees$X <- coordinates(points_wgs84)[, 1]
columbus_trees$Y <- coordinates(points_wgs84)[, 2]

columbus_trees_clean <- columbus_trees %>% 
  filter(RETIRED == "") %>% 
  dplyr::rename(long = X,
                lat = Y,
                dbh = DIAM_BREAST_HEIGHT,
                hort_code = SP_CODE) %>% 
  select(c(lat, long, dbh, hort_code, country, state, city, year)) %>% 
  filter(dbh > 0) %>% 
  mutate(hort_code = tolower(hort_code))

columbus_trees_clean$dbh <- columbus_trees_clean$dbh * 2.54 ##converting from inches to cm

columbus_trees_clean$hort_code[columbus_trees_clean$hort_code == ""] <- NA
columbus_trees_clean <- columbus_trees_clean %>% 
  filter(!is.na(hort_code))


columbus_trees_clean <- columbus_trees_clean %>%
  mutate(hort_code = case_when(
   str_detect(hort_code, "^acca") ~ "acca",
   str_detect(hort_code, "^acgi") ~ "acgi",
   str_detect(hort_code, "^acni") ~ "acni",
   str_detect(hort_code, "^acpa") ~ "acpa",
   str_detect(hort_code, "^acpl") ~ "acpl",
   str_detect(hort_code, "^acru") ~ "acru",
   str_detect(hort_code, "^acsa2") ~ "acsa2",
   str_detect(hort_code, "^actrcs") ~ "actrp",
   str_detect(hort_code, "^actrns") ~ "actrp",
   str_detect(hort_code, "^actrps") ~ "actrp",
   str_detect(hort_code, "^acfr") ~ "acfr",
   str_detect(hort_code, "^aeca") ~ "aeca",
   str_detect(hort_code, "^amartr") ~ "amca",
   str_detect(hort_code, "^amla") ~ "amla",
   str_detect(hort_code, "^amgr") ~ "amgr",
   str_detect(hort_code, "^beni") ~ "beni",
   str_detect(hort_code, "^bepe") ~ "bepe",
   str_detect(hort_code, "^cabe") ~ "cabe",
   str_detect(hort_code, "^cabi") ~ "cabi",
   str_detect(hort_code, "^ceoc") ~ "ceoc",
   str_detect(hort_code, "^ceja") ~ "ceja",
   str_detect(hort_code, "^chla") ~ "chla",
   str_detect(hort_code, "^chno") ~ "chno",
   str_detect(hort_code, "^chob") ~ "chob",
   str_detect(hort_code, "^co1flx") ~ "co1flx",
   str_detect(hort_code, "^co1ma") ~ "co1ma",
   str_detect(hort_code, "^co2av") ~ "co2av",
   str_detect(hort_code, "^crcr") ~ "crcr",
   str_detect(hort_code, "^crvi") ~ "crvi",
   str_detect(hort_code, "^cyob") ~ "cyob",
   str_detect(hort_code, "^euul") ~ "euul",
   str_detect(hort_code, "^fasy") ~ "fasy",
   str_detect(hort_code, "^fram") ~ "fram",
   str_detect(hort_code, "^frex") ~ "frex",
   str_detect(hort_code, "^frni") ~ "frni",
   str_detect(hort_code, "^frpe") ~ "frpe",
   str_detect(hort_code, "^gibi") ~ "gibi",
   str_detect(hort_code, "^gltr") ~ "gltr",
   str_detect(hort_code, "^gydi") ~ "gydi",
   str_detect(hort_code, "^haca") ~ "hateap",
   str_detect(hort_code, "^hamo") ~ "hamo",
   str_detect(hort_code, "^hisy") ~ "hisy",
   str_detect(hort_code, "^jusc") ~ "jusc",
   str_detect(hort_code, "^list") ~ "list",
   str_detect(hort_code, "^mapo") ~ "mapo",
   str_detect(hort_code, "^ma3hgs") ~ "ma3ac",
   str_detect(hort_code, "^ma3hic") ~ "ma3ac",
   str_detect(hort_code, "^ma3hgc") ~ "ma3ac",
   str_detect(hort_code, "^ma3hyb") ~ "ma3ac",
   str_detect(hort_code, "^ma3gr") ~ "ma3gr",
   str_detect(hort_code, "^ma3lo") ~ "ma3lo",
   str_detect(hort_code, "^ma3st") ~ "ma3st",
   str_detect(hort_code, "^ma3vi") ~ "ma3vi",
   str_detect(hort_code, "^ma3h") ~ "ma3",
   str_detect(hort_code, "^ma3so") ~ "ma3so",
   str_detect(hort_code, "^nysy") ~ "nysy",
   str_detect(hort_code, "^pi1om") ~ "pi1om",
   str_detect(hort_code, "^pi2fl") ~ "pi2fl",
   str_detect(hort_code, "^pi2st") ~ "pi2st",
   str_detect(hort_code, "^plac") ~ "plac",
   str_detect(hort_code, "^poal") ~ "poal",
   str_detect(hort_code, "^poni") ~ "poni",
   str_detect(hort_code, "^prni") ~ "prni",
   str_detect(hort_code, "^prpa") ~ "prpa",
   str_detect(hort_code, "^prsa") ~ "prsa",
   str_detect(hort_code, "^prse") ~ "prse",
   str_detect(hort_code, "^prxok") ~ "prse",
   str_detect(hort_code, "^prxfl") ~ "prxok",
   str_detect(hort_code, "^prxak") ~ "prxye",
   str_detect(hort_code, "^prxdc") ~ "prxok",
   str_detect(hort_code, "^prsu") ~ "prsu",
   str_detect(hort_code, "^pyca") ~ "pyca",
   str_detect(hort_code, "^pyus") ~ "pyus",
   str_detect(hort_code, "^qufr") ~ "qufr",
   str_detect(hort_code, "^quma1") ~ "quma1",
   str_detect(hort_code, "^qupa") ~ "qupa",
   str_detect(hort_code, "^quro") ~ "quro",
   str_detect(hort_code, "^quxbe") ~ "quxbe",
   str_detect(hort_code, "^rops") ~ "rops",
   str_detect(hort_code, "^soja") ~ "soja",
   str_detect(hort_code, "^sype") ~ "sype",
   str_detect(hort_code, "^syre") ~ "syre",
   str_detect(hort_code, "^taas") ~ "taas",
   str_detect(hort_code, "^tadi") ~ "tadi",
   str_detect(hort_code, "^thoc") ~ "thoc",
   str_detect(hort_code, "^thpl") ~ "thpl",
   str_detect(hort_code, "^tiam") ~ "tiam",
   str_detect(hort_code, "^tico") ~ "tico",
   str_detect(hort_code, "^tito") ~ "tito",
   str_detect(hort_code, "^tixeu") ~ "tixeu",
   str_detect(hort_code, "^ulam") ~ "ulam",
   str_detect(hort_code, "^ulx$") ~ "ul",
   str_detect(hort_code, "^ulpa") ~ "ulpa",
   str_detect(hort_code, "^ulwi") ~ "ulwi",
   str_detect(hort_code, "^zese") ~ "zese",
   
   TRUE ~ hort_code
  ))




columbus_trees_clean <- left_join(columbus_trees_clean, spp_code, by = "hort_code") %>% 
  #select(-c(code, new_common_name,new_botanical_name)) %>% 
  filter(!is.na(species_common_name)) %>%  #dropped 118 points, couldn't identify tree codes: "2tree" "vsl"   "vsm"   "vss"
  select(-c(hort_code))

columbus_trees_clean<-columbus_trees_clean[, c(4:7,2,1,8,9,3)]

#write.csv(columbus_trees_clean, "~/Dropbox/Urban_data/Cleaned/columbus_trees_clean.csv", row.names = FALSE)

```

#Cupertino
Data downloaded from: https://gis-cupertino.opendata.arcgis.com/datasets/Cupertino::trees/explore
  DBH is in inches
```{r}

#Clean
cupertino_trees<- read.csv("~/Dropbox/Urban_data/Raw/cupertino_ca_usa.csv")


cupertino_trees$country <- "usa"
cupertino_trees$state <- "california"
cupertino_trees$city <- "cupertino"
cupertino_trees$year <- "2020" #as of Jan 23, 2020

cupertino_trees_clean <- cupertino_trees %>% 
  #filter(Species != "" & Species != "UNKNOWN" & LAT != "") %>% 
  dplyr::rename(long = LAT, #coordinates are swapped in raw file
                lat = LONG, #coordinates are swapped in raw file
                dbh = DiameterBreastHieght,
                species_botanical_name = Species,
                #species_common_name = SpeciesCommonName,
                height = Height) %>% 
  select(c(lat, long, dbh, species_botanical_name, height, country, state, city, year)) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  filter(!grepl("^proposed|^stump|^unknown|^unidentifiable", species_botanical_name, ignore.case = TRUE)) %>% 
  mutate(species_botanical_name = gsub("species$|sp$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

cupertino_trees_clean$dbh <- cupertino_trees_clean$dbh * 2.54 ##converting from inches to cm


cupertino_trees_clean <- cupertino_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^arbutus marina") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^cercis occidentalis") ~ "cercis occidentalis",
   str_detect(species_botanical_name, "^cornus florida") ~ "cornus florida",
   str_detect(species_botanical_name, "^cotinus coggygria") ~ "cotinus coggygria",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^fraxinus angustifolia") ~ "fraxinus oxycarpa",
   str_detect(species_botanical_name, "^fraxinus velutina") ~ "fraxinus velutina",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^juglans$") ~ "juglans spp.",
   str_detect(species_botanical_name, "^lagerstroemia muskogee") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia nanchez") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia tuscarora") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^magnolia solingiana") ~ "magnolia soulangeana",
   str_detect(species_botanical_name, "^nyssa sylvatica") ~ "nyssa sylvatica",
   str_detect(species_botanical_name, "^palm$") ~ "arecaceae spp.",
   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^platanus columbiana") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hispanica") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus") ~ "populus spp.",
   str_detect(species_botanical_name, "^prunus akebono") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus$") ~ "quercus spp.",
   str_detect(species_botanical_name, "^quercus buckeyi") ~ "quercus buckleyi",
   str_detect(species_botanical_name, "^quercus canbyi") ~ "quercus canbyi",
   str_detect(species_botanical_name, "^quercus frainetto") ~ "quercus frainetto",
   str_detect(species_botanical_name, "^quercus wislizenii") ~ "quercus wislizeni",
   str_detect(species_botanical_name, "^salix matsudana") ~ "salix matsudana",
   str_detect(species_botanical_name, "^solanum macranthum") ~ "solanum wrightii",
   str_detect(species_botanical_name, "^syagrus romanzoffianum") ~ "syagrus romanzoffiana",
   str_detect(species_botanical_name, "^tilia tomentosa") ~ "tilia tomentosa",
   str_detect(species_botanical_name, "^tristaniopsis laurina") ~ "tristaniopsis laurina",
   str_detect(species_botanical_name, "^umbellularia californica") ~ "umbellularia californica",
   str_detect(species_botanical_name, "^quercus cambii") ~ "quercus canbyi",
   str_detect(species_botanical_name, "^pinus brutia") ~ "pinus brutia",
   
   TRUE ~ species_botanical_name
  ))

cupertino_trees_clean$species_botanical_name[cupertino_trees_clean$species_botanical_name == ""] <- NA


cupertino_trees_clean <- left_join(cupertino_trees_clean, spp_code, by = "species_botanical_name")


cupertino_trees_clean <- cupertino_trees_clean %>% 
  filter(!is.na(species_botanical_name)) %>% 
  filter(!is.na(dbh)) %>% 
  select(-c(height,hort_code))

cupertino_trees_clean<-cupertino_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(cupertino_trees_clean, "~/Dropbox/Urban_data/Cleaned/cupertino_trees_clean.csv", row.names = FALSE)


```

#Dallas
  
Data downloaded from: https://dallastx.treekeepersoftware.com/index.cfm?deviceWidth=1680
  DBH is in inches
```{r}

#Clean
dallas_trees<- read.csv("~/Dropbox/Urban_data/Raw/dallas_tx_usa.csv")


dallas_trees$country <- "usa"
dallas_trees$state <- "texas"
dallas_trees$city <- "dallas"
dallas_trees$year <- "2022" #confirmed via email

dallas_trees_clean <- dallas_trees %>% 
  select(-c(species_common_name)) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  filter(!grepl("^proposed|^stump|^unknown|^unidentifiable|n/a|^no data", species_botanical_name, ignore.case = TRUE)) %>% 
  mutate(species_botanical_name = gsub("species$|sp$|spp", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 


dallas_trees_clean$dbh <- dallas_trees_clean$dbh * 2.54 ##converting from inches to cm

dallas_trees_clean$species_botanical_name[dallas_trees_clean$species_botanical_name == ""] <- NA

dallas_trees_clean <- dallas_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^carya illinoiensis") ~ "carya illinoinensis",
   str_detect(species_botanical_name, "plantanus acerfolia") ~ "platanus acerifolia",
   
   TRUE ~ species_botanical_name
  ))


dallas_trees_clean <- left_join(dallas_trees_clean, spp_code, by = "species_botanical_name")


dallas_trees_clean <- dallas_trees_clean %>% 
  filter(!is.na(species_botanical_name)) %>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))


dallas_trees_clean<-dallas_trees_clean[, c(5:8,4,3,1,9,2)]

#write.csv(dallas_trees_clean, "~/Dropbox/Urban_data/Cleaned/dallas_trees_clean.csv", row.names = FALSE)


```


#DC
Data downloaded from: https://opendata.dc.gov/datasets/urban-forestry-street-trees/explore
```{r}

#Clean
dc_trees<- read.csv("~/Dropbox/Urban_data/Raw/washington_dc_usa.csv")

dc_trees$country <- "usa"
dc_trees$state <- "dc"
dc_trees$city <- "washington"
dc_trees$year <- "2022" #last updated in 2022

dc_trees_clean <- dc_trees %>% 
  filter(DBH > "0" & DBH != "") %>% 
  dplyr::rename(long = X,
                lat = Y,
                dbh = DBH, #in inches
                #species_common_name = CMMN_NM,
                species_botanical_name = SCI_NM) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name))%>% 
  filter(!grepl("^other|^no tree", species_botanical_name, ignore.case = TRUE)) %>% 
  mutate(species_botanical_name = gsub("species$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

dc_trees_clean$dbh <- dc_trees_clean$dbh * 2.54 ##converting from inches to cm


dc_trees_clean <- dc_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer buergeranum") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer truncatum") ~ "acer truncatum",
   str_detect(species_botanical_name, "^alibizia julibrissin") ~ "albizia julibrissin",
   str_detect(species_botanical_name, "^amelanchier arborea grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
   str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
   str_detect(species_botanical_name, "^cedrus deodora") ~ "cedrus deodara",
   str_detect(species_botanical_name, "^celtis occidentalis") ~ "celtis occidentalis",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^cercis reniformis oklahoma") ~ "cercis canadensis var. texensis",
   str_detect(species_botanical_name, "^cornus florida cherokee") ~ "cornus florida",
   str_detect(species_botanical_name, "^cornus florida kousa") ~ "cornus florida x kousa",
   str_detect(species_botanical_name, "^cornus rutdan celestial") ~ "cornus rutgersensis",
   str_detect(species_botanical_name, "^cornus rutgan celestial") ~ "cornus rutgersensis",
   str_detect(species_botanical_name, "^cornus florida var . rubra") ~ "cornus florida f. rubra",
   str_detect(species_botanical_name, "^crataegus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^crataegus oxyacantha superba") ~ "crataegus laevigata",
   str_detect(species_botanical_name, "^crataegus viridis") ~ "crataegus viridis",
   str_detect(species_botanical_name, "^diospyros virginia") ~ "diospyros virginiana",
   
   str_detect(species_botanical_name, "^fagus grandiflora") ~ "fagus grandifolia",
   str_detect(species_botanical_name, "^fagus sylvatica") ~ "fagus sylvatica",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^juniperus virginiana") ~ "juniperus virginiana",
   str_detect(species_botanical_name, "^lagerstroemia indica") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica natchez$") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^liquidambar rotundiloba") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^liquidambar stryaciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^liriodendron tulipifera") ~ "liriodendron tulipifera",
   str_detect(species_botanical_name, "^longleaf pine pinus") ~ "pinus palustris",
   str_detect(species_botanical_name, "^magnolia acuminata") ~ "magnolia acuminata",
   str_detect(species_botanical_name, "^magnolia butterflies") ~ "magnolia loebneri",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^magnolia liliflora") ~ "magnolia liliiflora x sprengeri",
   str_detect(species_botanical_name, "^magnolia virginiana") ~ "magnolia virginiana",
   str_detect(species_botanical_name, "^malus arnold") ~ "malus arnoldiana",
   str_detect(species_botanical_name, "^nyssa sylvatica") ~ "nyssa sylvatica",
   str_detect(species_botanical_name, "^persimmon diospyros virginia") ~ "diospyros virginiana",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus okame") ~ "prunus incam",
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus snow") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus subhirtella") ~ "prunus subhirtella",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^prunus yodoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus bicolor") ~ "quercus bicolor",
   str_detect(species_botanical_name, "^quercus palustris") ~ "quercus palustris",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^quercus shumardi") ~ "quercus shumardii",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   str_detect(species_botanical_name, "^stewartia pseudocamellia") ~ "stewartia pseudocamellia",
   str_detect(species_botanical_name, "^styphnolobium japonicum") ~ "styphnolobium japonicum",
   str_detect(species_botanical_name, "^styrax japon") ~ "styrax japonicus",
   str_detect(species_botanical_name, "^syringa reticulata") ~ "syringa reticulata",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   
   str_detect(species_botanical_name, "accolade$") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus hollandica") ~ "ulmus hollandica",
   str_detect(species_botanical_name, "^ulmus morton glossy") ~ "ulmus triumph",
   str_detect(species_botanical_name, "^ulmus parvifolia") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus pioneer") ~ "ulmus hollandica",
   str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
   str_detect(species_botanical_name, "^eucommia") ~ "eucommia ulmoides",
   
   TRUE ~ species_botanical_name
  ))

dc_trees_clean$species_botanical_name[dc_trees_clean$species_botanical_name == ""] <- NA


dc_trees_clean <- left_join(dc_trees_clean, spp_code, by = "species_botanical_name")


dc_trees_clean <- dc_trees_clean %>% 
  filter(!is.na(species_botanical_name)) %>% 
  select(-c(hort_code))


dc_trees_clean<-dc_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(dc_trees_clean, "~/Dropbox/Urban_data/Cleaned/dc_trees_clean.csv", row.names = FALSE)

```


#Edmonton
  
Data downloaded from: https://data.edmonton.ca/Environmental-Services/Trees-Map/udbt-eiax
```{r}

#Clean
edmonton_trees<- read.csv("~/Dropbox/Urban_data/Raw/edmonton_alberta_ca.csv")

edmonton_trees$country <- "ca"
edmonton_trees$state <- "alberta"
edmonton_trees$city <- "edmonton"
edmonton_trees$year <- "2023" #as of May 22, 2023

edmonton_trees_clean <- edmonton_trees %>% 
  dplyr::rename(long = LONGITUDE,
                lat = LATITUDE,
                dbh = DIAMETER_BREAST_HEIGHT, #in cm
                #species_common_name = SPECIES_COMMON,
                species_botanical_name = SPECIES_BOTANICAL,
                #genus = GENUS,
                #species = SPECIES
                ) %>% 
  select(c(lat, long, dbh, species_botanical_name,country, state, city, year))%>%
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("sp$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\(b\\)", " ", species_botanical_name))


edmonton_trees_clean <- edmonton_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer negundo") ~ "acer negundo",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer palmatum") ~ "acer palmatum",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^aesculus autumn splendor") ~ "aesculus arnoldiana",
   str_detect(species_botanical_name, "^aesculus prairie torch") ~ "aesculus bergeson",
   str_detect(species_botanical_name, "^alnus crispa") ~ "alnus alnobetula",
   str_detect(species_botanical_name, "^alnus hirsuta") ~ "alnus hirsuta",
   str_detect(species_botanical_name, "^betula$") ~ "betula spp.",
   str_detect(species_botanical_name, "^betula papyrifera") ~ "betula papyrifera",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^betula platyphylla") ~ "betula platyphylla",
   str_detect(species_botanical_name, "^caragana arborescens") ~ "caragana arborescens",
   str_detect(species_botanical_name, "^celtis occidentalis") ~ "celtis occidentalis",
   str_detect(species_botanical_name, "^crataegus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crataegus crusgalli") ~ "crataegus crus-galli",
   str_detect(species_botanical_name, "^crataegus mordenensis") ~ "crataegus mordenensis",
   str_detect(species_botanical_name, "^eleagnus angustifolia") ~ "elaeagnus angustifolia",
   str_detect(species_botanical_name, "^fraxinus$") ~ "fraxinus spp.",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^fraxinus nigra") ~ "fraxinus nigra",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^juniperus scopulorum") ~ "juniperus scopulorum",
   str_detect(species_botanical_name, "^larix$") ~ "larix spp.",
   str_detect(species_botanical_name, "^larix siberica") ~ "larix sibirica",
   str_detect(species_botanical_name, "^maackia amurensis") ~ "maackia amurensis",
   str_detect(species_botanical_name, "^malus$") ~ "malus spp.",
   str_detect(species_botanical_name, "^malus adstringens") ~ "malus adstringens",
   str_detect(species_botanical_name, "^malus baccata") ~ "malus baccata",
   str_detect(species_botanical_name, "^malus fall red") ~ "malus pumila",
   str_detect(species_botanical_name, "^malus honeycrisp") ~ "malus domestica",
   str_detect(species_botanical_name, "^malus green wall") ~ "malus jefwall",
   str_detect(species_botanical_name, "^malus parkland") ~ "malus pumila",
   str_detect(species_botanical_name, "^malus prunifolia") ~ "malus prunifolia",
   str_detect(species_botanical_name, "^phellodendron amurense") ~ "phellodendron amurense",
   str_detect(species_botanical_name, "^picea$") ~ "picea spp.",
   str_detect(species_botanical_name, "^picea glauca") ~ "picea glauca",
   str_detect(species_botanical_name, "^picea omorika") ~ "picea omorika",
   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^pinus$") ~ "pinus spp.",
   str_detect(species_botanical_name, "^pinus cembra") ~ "pinus cembra",
   str_detect(species_botanical_name, "^pinus contorta") ~ "pinus contorta var. latifolia",
   str_detect(species_botanical_name, "^pinus flexilis") ~ "pinus flexilis",
   str_detect(species_botanical_name, "^pinus mugo") ~ "pinus mugo",
   str_detect(species_botanical_name, "^pinus strobus") ~ "pinus strobus",
   str_detect(species_botanical_name, "^pinus sylvestris") ~ "pinus sylvestris",
   str_detect(species_botanical_name, "^populus$") ~ "populus spp.",
   str_detect(species_botanical_name, "^populus $") ~ "populus spp.",
   str_detect(species_botanical_name, "^populus deltoides") ~ "populus deltoides",
   str_detect(species_botanical_name, "^populus northwest") ~ "populus jackii",
   str_detect(species_botanical_name, "^populus prairie sky") ~ "populus canadensis",
   str_detect(species_botanical_name, "^populus sundancer") ~ "populus acws151",
   str_detect(species_botanical_name, "^populus tower") ~ "populus canescens",
   str_detect(species_botanical_name, "^populus tremula") ~ "populus tremula",
   str_detect(species_botanical_name, "^populus tremuloides") ~ "populus tremuloides",
   str_detect(species_botanical_name, "^prunus $") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus \\(cherry") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus \\(plum") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus cerasus") ~ "prunus cerasus",
   str_detect(species_botanical_name, "^prunus fruticosa cerasus") ~ "prunus fruticosa x cerasus",
   str_detect(species_botanical_name, "^prunus kerrasis") ~ "prunus kerrasis",
   str_detect(species_botanical_name, "^prunus maackii") ~ "prunus maackii",
   str_detect(species_botanical_name, "^prunus muckle") ~ "prunus nigrella",
   str_detect(species_botanical_name, "^prunus nigra") ~ "prunus nigra",
   str_detect(species_botanical_name, "^prunus padus") ~ "prunus padus",
   str_detect(species_botanical_name, "^prunus pembina") ~ "prunus nigra x salicina",
   str_detect(species_botanical_name, "^prunus pensylvanica") ~ "prunus pensylvanica",
   str_detect(species_botanical_name, "^prunus salicina") ~ "prunus salicina",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus$") ~ "pyrus spp.",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^pyrus navigator") ~ "pyrus durpsn303",
   str_detect(species_botanical_name, "^pyrus ussuriensis") ~ "pyrus ussuriensis",
   str_detect(species_botanical_name, "^quercus$") ~ "quercus spp.", 
   str_detect(species_botanical_name, "^quercus bimundorum") ~ "quercus bimundorum", 
   str_detect(species_botanical_name, "^quercus ellipsoidalis") ~ "quercus ellipsoidalis",
   str_detect(species_botanical_name, "^quercus jackiana") ~ "quercus jackiana",
   str_detect(species_botanical_name, "^quercus macrocarpa") ~ "quercus macrocarpa",
   str_detect(species_botanical_name, "^quercus palustris") ~ "quercus palustris",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^quercus warei") ~ "quercus warei",
   str_detect(species_botanical_name, "^salix$") ~ "salix spp.",
   str_detect(species_botanical_name, "^salix acutifolia") ~ "salix spp.",
   str_detect(species_botanical_name, "^salix alba") ~ "salix alba",
   str_detect(species_botanical_name, "^salix babylonica") ~ "salix babylonica",
   str_detect(species_botanical_name, "^sorbus$") ~ "sorbus spp.",
   str_detect(species_botanical_name, "^sorbus aucaparia") ~ "sorbus aucuparia",
   str_detect(species_botanical_name, "^syringa pekinesis") ~ "syringa reticulata",
   str_detect(species_botanical_name, "^syringa reticulata") ~ "syringa reticulata",
   str_detect(species_botanical_name, "^tilia$") ~ "tilia spp.",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^tilia flavescens") ~ "tilia flavescens",
   str_detect(species_botanical_name, "^tilia mongolica") ~ "tilia mongolica",
   str_detect(species_botanical_name, "^ulmus$") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus davidiana") ~ "ulmus davidiana",
   str_detect(species_botanical_name, "^ulmus night rider") ~ "ulmus davidiana",
   
   TRUE ~ species_botanical_name
  ))

#cambridge_trees_clean$species_common_name[cambridge_trees_clean$species_common_name == ""] <- NA
edmonton_trees_clean$species_botanical_name[edmonton_trees_clean$species_botanical_name == " "] <- NA

edmonton_trees_clean <- left_join(edmonton_trees_clean, spp_code, by = "species_botanical_name")
edmonton_trees_clean <- edmonton_trees_clean %>% 
  select(-c(hort_code)) %>%
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name))


edmonton_trees_clean<-edmonton_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(edmonton_trees_clean, "~/Dropbox/Urban_data/Cleaned/edmonton_trees_clean.csv", row.names = FALSE)


```

#Kitchener
  
Data downloaded from: https://data.waterloo.ca/datasets/KitchenerGIS::tree-inventory/about
```{r}

#Clean
kitchener_trees<- read.csv("~/Dropbox/Urban_data/Raw/kitchener_ontario_ca.csv")

kitchener_trees$country <- "ca"
kitchener_trees$state <- "ontario"
kitchener_trees$city <- "kitchener"
kitchener_trees$year <- "2023" #as of May 25, 2023

kitchener_trees_clean <- kitchener_trees %>% 
  dplyr::rename(long = X,
                lat = Y,
                dbh = MAP_DBH_CM, #in cm
                #species_common_name = SPECIES_NAME,
                species_botanical_name = SPECIES_LATIN) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>%
  filter(dbh > 0 & !is.na(dbh)) %>% 
  filter(!grepl("^unknown|other$", species_botanical_name, ignore.case = TRUE)) %>%
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("sp$|species", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\(b\\)", " ", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name))

kitchener_trees_clean <- kitchener_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer nigra") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tatarian") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer truncatum acer") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^acer truncatum platanoides") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier arborea") ~ "amelanchier arborea",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
   str_detect(species_botanical_name, "^chamaecyparis nootkatensis") ~ "chamaecyparis nootkatensis",
   str_detect(species_botanical_name, "^elm$") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^gingko biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^ginkgo biloba autumn gold") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditsia tricanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^malus apple") ~ "malus spp.",
   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^platanus acerfolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hybrida") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus nigra") ~ "populus nigra",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^rhamnus frangula") ~ "frangula alnus",
   str_detect(species_botanical_name, "^rhus hirta") ~ "rhus typhina",
   str_detect(species_botanical_name, "^salix spp. weeping") ~ "salix babylonica",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus accolade") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus pioneer") ~ "ulmus hollandica",

   
   TRUE ~ species_botanical_name
  ))

kitchener_trees_clean$species_botanical_name[kitchener_trees_clean$species_botanical_name == ""] <- NA

kitchener_trees_clean <- left_join(kitchener_trees_clean, spp_code, by = "species_botanical_name")

kitchener_trees_clean <- kitchener_trees_clean %>% 
  select(-c(hort_code)) %>%
  filter(!is.na(species_botanical_name)) %>%
  filter(!is.na(species_common_name))


kitchener_trees_clean<-kitchener_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(kitchener_trees_clean, "~/Dropbox/Urban_data/Cleaned/kitchener_trees_clean.csv", row.names = FALSE)


```


#Montreal
  Downloaded from: https://donnees.montreal.ca/ville-de-montreal/arbres
  See license: https://donnees.montreal.ca/licence-d-utilisation
 
```{r}

montreal_trees<- read.csv("~/Dropbox/Urban_data/Raw/montreal_qu_ca.csv")

montreal_trees$country <- "ca"
montreal_trees$state <- "quebec"
montreal_trees$city <- "montreal"
montreal_trees$year <- "2019" #last updated 2019

montreal_trees_clean <- montreal_trees %>% 
  dplyr::rename(long = Longitude,
                lat = Latitude,
                dbh = DHP, 
                species_botanical_name = Essence_latin) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year))%>%
  filter(dbh > 0) %>% 
  filter(!grepl("^divers$", species_botanical_name, ignore.case = TRUE)) %>%
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("species$|sp$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 


montreal_trees_clean <- montreal_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^abelia grandiflora") ~ "linnaea grandiflora",
   str_detect(species_botanical_name, "^acacia$") ~ "acacia spp.",
   str_detect(species_botanical_name, "^albizia$") ~ "albizia spp.",
   
   str_detect(species_botanical_name, "^acacia baileyana") ~ "acacia baileyana",
   str_detect(species_botanical_name, "^acer buergeranium") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer buergeranum") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer campestre") ~ "acer campestre",
   str_detect(species_botanical_name, "^acer fremanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer grandidentatum") ~ "acer grandidentatum",
   str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
   str_detect(species_botanical_name, "^aesculus$") ~ "aesculus spp.",
   str_detect(species_botanical_name, "^aesculus × carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^alnus$") ~ "alnus spp.",
   str_detect(species_botanical_name, "^arbor vitae$") ~ "thuja spp.",
   str_detect(species_botanical_name, "^arbutus ‘marina’") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^arbutus marina") ~ "arbutus unedo",
   
   str_detect(species_botanical_name, "^baccharis$") ~ "baccharis spp.",
   str_detect(species_botanical_name, "^bambusa$") ~ "bambusa spp.",
   str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
   str_detect(species_botanical_name, "^brachea edulis") ~ "brahea edulis",
   str_detect(species_botanical_name, "^buxus$") ~ "buxus spp.",
   str_detect(species_botanical_name, "^bougainvillea$") ~ "bougainvillea spp.",
   
   str_detect(species_botanical_name, "^casurina stricta") ~ "allocasuarina verticillata",
   str_detect(species_botanical_name, "^ceanothus$") ~ "ceanothus spp.",
   str_detect(species_botanical_name, "^cedrus$") ~ "cedrus spp.",
   str_detect(species_botanical_name, "^cedrus atlantica") ~ "cedrus atlantica",
   str_detect(species_botanical_name, "^cedrus deodora") ~ "cedrus deodara",
   str_detect(species_botanical_name, "^celtis$") ~ "celtis spp.",
   str_detect(species_botanical_name, "^celtis chinensis") ~ "celtis sinensis",
   str_detect(species_botanical_name, "^cercis$") ~ "cercis spp.",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^cercis reniformis") ~ "cercis reniformis",
   str_detect(species_botanical_name, "^chamaecyparis$") ~ "chamaecyparis spp.",
   str_detect(species_botanical_name, "^chitalpa tashkentensis") ~ "chitalpa tashkentensis",
   str_detect(species_botanical_name, "^chorisia speciosa") ~ "ceiba speciosa", #formerly known as chorisia
   str_detect(species_botanical_name, "^citrus$") ~ "citrus spp.",
   str_detect(species_botanical_name, "^crataegus laevigata") ~ "crataegus laevigata",
   str_detect(species_botanical_name, "^crateagus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^crataegus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crateagus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crataegus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^cycad$") ~ "cycas spp.",
   
   str_detect(species_botanical_name, "^elaeagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eleagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eriobotrya$") ~ "eriobotrya spp.",
   str_detect(species_botanical_name, "^erythrina$") ~ "erythrina spp.",
   str_detect(species_botanical_name, "^escallonia$") ~ "escallonia spp.",
   str_detect(species_botanical_name, "^escallonia exoniensis") ~ "escallonia exoniensis",
   
   str_detect(species_botanical_name, "^eucalyptus$") ~ "eucalyptus spp.",
   str_detect(species_botanical_name, "^eucalyptus citriodora") ~ "corymbia citriodora", #name switch
   str_detect(species_botanical_name, "^eucalyptus ficifolia") ~ "corymbia ficifolia", #name switch
   str_detect(species_botanical_name, "^eucalyptus parvifolia") ~ "eucalyptus parvula", #name switch
   str_detect(species_botanical_name, "^feijoa sellowiana") ~ "acca sellowiana", #name switch
   str_detect(species_botanical_name, "^ficus$") ~ "ficus spp.", #name switch
   str_detect(species_botanical_name, "^ficus nitida") ~ "ficus microcarpa", #name switch
   str_detect(species_botanical_name, "^fraxinus$") ~ "fraxinus spp.",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^fraxinus angustifolia") ~ "fraxinus angustifolia",
   str_detect(species_botanical_name, "^fraxinus moraine") ~ "fraxinus holotricha",
   str_detect(species_botanical_name, "^fraxinus uhdei") ~ "fraxinus uhdei",
   str_detect(species_botanical_name, "^fraxinus veluntina") ~ "fraxinus velutina",
   str_detect(species_botanical_name, "^fraxinus velutina") ~ "fraxinus velutina",
   
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditisia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^heliconia$") ~ "heliconia spp.",
   str_detect(species_botanical_name, "^hesperocyparis$") ~ "hesperocyparis spp.",
   str_detect(species_botanical_name, "^hibiscus$") ~ "hibiscus spp.",
   str_detect(species_botanical_name, "^ilex$") ~ "ilex spp.",
   str_detect(species_botanical_name, "^ilex aquifolium") ~ "ilex aquifolium",
   str_detect(species_botanical_name, "^juglans$") ~ "juglans spp.",
   str_detect(species_botanical_name, "^juniperus$") ~ "juniperus spp.",
   str_detect(species_botanical_name, "^lagerstroemia$") ~ "lagerstroemia spp.",
   str_detect(species_botanical_name, "^lagerstroemia indica biloxi$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica natchez$") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica faurei") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica muskogee$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica tuscarora$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica fauriei") ~ "lagerstroemia indica x fauriei",
   
   
   str_detect(species_botanical_name, "^laurus nobilis") ~ "laurus nobilis",
   str_detect(species_botanical_name, "^leptospermum$") ~ "leptospermum spp.",
   str_detect(species_botanical_name, "^ligustrum$") ~ "ligustrum spp.",
   str_detect(species_botanical_name, "^ligustrum japonicum") ~ "ligustrum japonicum",
   str_detect(species_botanical_name, "^liquidambar$") ~ "liquidambar spp.",
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^lycianthus rantonnetii") ~ "lycianthes rantonnetii",
   
   str_detect(species_botanical_name, "^magnolia$") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^malus$") ~ "malus spp.",
   str_detect(species_botanical_name, "^maytenus boaria") ~ "maytenus boaria",
   str_detect(species_botanical_name, "^melaleuca$") ~ "melaleuca spp.",
   str_detect(species_botanical_name, "^melia azerdarach") ~ "melia azedarach",
   str_detect(species_botanical_name, "^metrosideros excelsus") ~ "metrosideros excelsa",
   
   str_detect(species_botanical_name, "^michelia champaca") ~ "magnolia champaca", #name change
   str_detect(species_botanical_name, "^michelia doltsopa") ~ "magnolia doltsopa",#name change
   str_detect(species_botanical_name, "^morus$") ~ "morus spp.",#name change
   str_detect(species_botanical_name, "^murraya exotica") ~ "murraya paniculata",#name change
   str_detect(species_botanical_name, "^musashino sawleaf zelkova") ~ "zelkova serrata",#name change
   str_detect(species_botanical_name, "^myoporum laevigatum") ~ "myoporum laetum",#name change
   str_detect(species_botanical_name, "^musa$") ~ "musa spp.",#name change
   
   str_detect(species_botanical_name, "^nandina$") ~ "nandina spp.",#name change
   
   
   str_detect(species_botanical_name, "^phormium$") ~ "phormium spp.",
   str_detect(species_botanical_name, "^picea$") ~ "picea spp.",
   str_detect(species_botanical_name, "^picea glauca") ~ "picea glauca",
   str_detect(species_botanical_name, "^pinus$") ~ "pinus spp.",
   str_detect(species_botanical_name, "^pinus pinea") ~ "pinus pinea",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^pistacia chinensis") ~ "pistacia chinensis",
   
   str_detect(species_botanical_name, "^pittosporum$") ~ "pittosporum spp.",
   str_detect(species_botanical_name, "^pittosporum tawhiwhi") ~ "pittosporum tenuifolium",
   str_detect(species_botanical_name, "^pittosporum rhombifolium") ~ "pittosporum rhombifolia ",
   
   
   str_detect(species_botanical_name, "^platanus × acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hispanica") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^podocarpus gracilior") ~ "afrocarpus gracilior",#name change
   str_detect(species_botanical_name, "^populus$") ~ "populus spp.",
   str_detect(species_botanical_name, "^prunus$") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus amygdalus") ~ "prunus dulcis",
   str_detect(species_botanical_name, "^prunus armenica") ~ "prunus armeniaca",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus ilicifoia") ~ "prunus ilicifolia",
   str_detect(species_botanical_name, "^prunus martimia") ~ "prunus maritima",
   
   
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus spp.") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^psidium$") ~ "psidium spp.",
   str_detect(species_botanical_name, "^pyracantha$") ~ "pyracantha spp.",
   str_detect(species_botanical_name, "^pyrus$") ~ "pyrus spp.",
   str_detect(species_botanical_name, "^quercus$") ~ "quercus spp.",
   str_detect(species_botanical_name, "^quercus frainetto") ~ "quercus frainetto",
   
   str_detect(species_botanical_name, "^rhaphiolepis majestic beauty") ~ "rhaphiolepis indica",
   str_detect(species_botanical_name, "^rhus copallina") ~ "rhus copallinum",
   str_detect(species_botanical_name, "^robinia$") ~ "robinia spp.",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   str_detect(species_botanical_name, "^robinia idahoensis") ~ "robinia ambigua idahoensis",
   str_detect(species_botanical_name, "^robinia ambiqua purple") ~ "robinia pseudoacacia x ambigua",
   str_detect(species_botanical_name, "^rosa$") ~ "rosa spp.",
   
   str_detect(species_botanical_name, "^saponara quillaja") ~ "saponaria quillaja",
   str_detect(species_botanical_name, "^salix$") ~ "salix spp.",
   str_detect(species_botanical_name, "^schinus terbinthefolius") ~ "schinus terebinthifolius",
   str_detect(species_botanical_name, "^solanum rantonnetii") ~ "lycianthes rantonnetii",
   str_detect(species_botanical_name, "^sorbus$") ~ "sorbus spp.",
   str_detect(species_botanical_name, "^syagrus romanzoffianum") ~ "syagrus romanzoffiana",
   str_detect(species_botanical_name, "^syringa$") ~ "syringa spp.",
   str_detect(species_botanical_name, "^syzgium australe") ~ "syzygium australe",
   str_detect(species_botanical_name, "^taxus baccata") ~ "taxus baccata",
   str_detect(species_botanical_name, "^thuga orientalis") ~ "platycladus orientalis",#name change
   str_detect(species_botanical_name, "^thuja lawsoniana") ~ "chamaecyparis lawsoniana",
   str_detect(species_botanical_name, "^thuja occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^tilia tomentosa") ~ "tilia tomentosa",
   str_detect(species_botanical_name, "^trachylospermum jasminoides") ~ "trachelospermum jasminoides",
   str_detect(species_botanical_name, "^tristania conferta") ~ "lophostemon confertus", #name change
   str_detect(species_botanical_name, "^ulmus$") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus ‘frontier’") ~ "ulmus carpinifolia x parvifolia", 
   str_detect(species_botanical_name, "^ulmus japonica wilsoniana") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus parviflora") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus propinqua") ~ "ulmus propinqua",
   str_detect(species_botanical_name, "^ulmus wilsoniana prospector") ~ "ulmus wilsoniana",
   str_detect(species_botanical_name, "^washingtonia romanzoffiana") ~ "syagrus romanzoffiana",
   
   str_detect(species_botanical_name, "^wisteria$") ~ "wisteria spp.",
   str_detect(species_botanical_name, "^yucca$") ~ "yucca spp.",
   str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
   
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer nigra") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tatarian") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer truncatum acer") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^acer truncatum platanoides") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier arborea") ~ "amelanchier arborea",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
   str_detect(species_botanical_name, "^chamaecyparis nootkatensis") ~ "chamaecyparis nootkatensis",
   str_detect(species_botanical_name, "^elm$") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^gingko biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^ginkgo biloba autumn gold") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditsia tricanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^malus apple") ~ "malus spp.",
   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^platanus acerfolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hybrida") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus nigra") ~ "populus nigra",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^rhamnus frangula") ~ "frangula alnus",
   str_detect(species_botanical_name, "^rhus hirta") ~ "rhus typhina",
   str_detect(species_botanical_name, "^salix spp. weeping") ~ "salix babylonica",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus accolade") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus pioneer") ~ "ulmus hollandica",
  
   str_detect(species_botanical_name, "^abelia grandiflora") ~ "linnaea grandiflora",
   str_detect(species_botanical_name, "^acacia$") ~ "acacia spp.",
   str_detect(species_botanical_name, "^albizia$") ~ "albizia spp.",
   
   str_detect(species_botanical_name, "^acacia baileyana") ~ "acacia baileyana",
   str_detect(species_botanical_name, "^acer buergeranium") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer buergeranum") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer campestre") ~ "acer campestre",
   str_detect(species_botanical_name, "^acer fremanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer grandidentatum") ~ "acer grandidentatum",
   str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
   str_detect(species_botanical_name, "^aesculus$") ~ "aesculus spp.",
   str_detect(species_botanical_name, "^aesculus × carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^alnus$") ~ "alnus spp.",
   str_detect(species_botanical_name, "^arbor vitae$") ~ "thuja spp.",
   str_detect(species_botanical_name, "^arbutus ‘marina’") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^arbutus marina") ~ "arbutus unedo",
   
   str_detect(species_botanical_name, "^baccharis$") ~ "baccharis spp.",
   str_detect(species_botanical_name, "^bambusa$") ~ "bambusa spp.",
   str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
   str_detect(species_botanical_name, "^brachea edulis") ~ "brahea edulis",
   str_detect(species_botanical_name, "^buxus$") ~ "buxus spp.",
   str_detect(species_botanical_name, "^bougainvillea$") ~ "bougainvillea spp.",
   
   str_detect(species_botanical_name, "^casurina stricta") ~ "allocasuarina verticillata",
   str_detect(species_botanical_name, "^ceanothus$") ~ "ceanothus spp.",
   str_detect(species_botanical_name, "^cedrus$") ~ "cedrus spp.",
   str_detect(species_botanical_name, "^cedrus atlantica") ~ "cedrus atlantica",
   str_detect(species_botanical_name, "^cedrus deodora") ~ "cedrus deodara",
   str_detect(species_botanical_name, "^celtis$") ~ "celtis spp.",
   str_detect(species_botanical_name, "^celtis chinensis") ~ "celtis sinensis",
   str_detect(species_botanical_name, "^cercis$") ~ "cercis spp.",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^cercis reniformis") ~ "cercis reniformis",
   str_detect(species_botanical_name, "^chamaecyparis$") ~ "chamaecyparis spp.",
   str_detect(species_botanical_name, "^chitalpa tashkentensis") ~ "chitalpa tashkentensis",
   str_detect(species_botanical_name, "^chorisia speciosa") ~ "ceiba speciosa", #formerly known as chorisia
   str_detect(species_botanical_name, "^citrus$") ~ "citrus spp.",
   str_detect(species_botanical_name, "^crataegus laevigata") ~ "crataegus laevigata",
   str_detect(species_botanical_name, "^crateagus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^crataegus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crateagus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crataegus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^cycad$") ~ "cycas spp.",
   
   str_detect(species_botanical_name, "^elaeagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eleagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eriobotrya$") ~ "eriobotrya spp.",
   str_detect(species_botanical_name, "^erythrina$") ~ "erythrina spp.",
   str_detect(species_botanical_name, "^escallonia$") ~ "escallonia spp.",
   str_detect(species_botanical_name, "^escallonia exoniensis") ~ "escallonia exoniensis",
   
   str_detect(species_botanical_name, "^eucalyptus$") ~ "eucalyptus spp.",
   str_detect(species_botanical_name, "^eucalyptus citriodora") ~ "corymbia citriodora", #name switch
   str_detect(species_botanical_name, "^eucalyptus ficifolia") ~ "corymbia ficifolia", #name switch
   str_detect(species_botanical_name, "^eucalyptus parvifolia") ~ "eucalyptus parvula", #name switch
   str_detect(species_botanical_name, "^feijoa sellowiana") ~ "acca sellowiana", #name switch
   str_detect(species_botanical_name, "^ficus$") ~ "ficus spp.", #name switch
   str_detect(species_botanical_name, "^ficus nitida") ~ "ficus microcarpa", #name switch
   str_detect(species_botanical_name, "^fraxinus$") ~ "fraxinus spp.",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^fraxinus angustifolia") ~ "fraxinus angustifolia",
   str_detect(species_botanical_name, "^fraxinus moraine") ~ "fraxinus holotricha",
   str_detect(species_botanical_name, "^fraxinus uhdei") ~ "fraxinus uhdei",
   str_detect(species_botanical_name, "^fraxinus veluntina") ~ "fraxinus velutina",
   str_detect(species_botanical_name, "^fraxinus velutina") ~ "fraxinus velutina",
   
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditisia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^heliconia$") ~ "heliconia spp.",
   str_detect(species_botanical_name, "^hesperocyparis$") ~ "hesperocyparis spp.",
   str_detect(species_botanical_name, "^hibiscus$") ~ "hibiscus spp.",
   str_detect(species_botanical_name, "^ilex$") ~ "ilex spp.",
   str_detect(species_botanical_name, "^ilex aquifolium") ~ "ilex aquifolium",
   str_detect(species_botanical_name, "^juglans$") ~ "juglans spp.",
   str_detect(species_botanical_name, "^juniperus$") ~ "juniperus spp.",
   str_detect(species_botanical_name, "^lagerstroemia$") ~ "lagerstroemia spp.",
   str_detect(species_botanical_name, "^lagerstroemia indica biloxi$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica natchez$") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica faurei") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica muskogee$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica tuscarora$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica fauriei") ~ "lagerstroemia indica x fauriei",
   
   
   str_detect(species_botanical_name, "^laurus nobilis") ~ "laurus nobilis",
   str_detect(species_botanical_name, "^leptospermum$") ~ "leptospermum spp.",
   str_detect(species_botanical_name, "^ligustrum$") ~ "ligustrum spp.",
   str_detect(species_botanical_name, "^ligustrum japonicum") ~ "ligustrum japonicum",
   str_detect(species_botanical_name, "^liquidambar$") ~ "liquidambar spp.",
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^lycianthus rantonnetii") ~ "lycianthes rantonnetii",
   
   str_detect(species_botanical_name, "^magnolia$") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^malus$") ~ "malus spp.",
   str_detect(species_botanical_name, "^maytenus boaria") ~ "maytenus boaria",
   str_detect(species_botanical_name, "^melaleuca$") ~ "melaleuca spp.",
   str_detect(species_botanical_name, "^melia azerdarach") ~ "melia azedarach",
   str_detect(species_botanical_name, "^metrosideros excelsus") ~ "metrosideros excelsa",
   
   str_detect(species_botanical_name, "^michelia champaca") ~ "magnolia champaca", #name change
   str_detect(species_botanical_name, "^michelia doltsopa") ~ "magnolia doltsopa",#name change
   str_detect(species_botanical_name, "^morus$") ~ "morus spp.",#name change
   str_detect(species_botanical_name, "^murraya exotica") ~ "murraya paniculata",#name change
   str_detect(species_botanical_name, "^musashino sawleaf zelkova") ~ "zelkova serrata",#name change
   str_detect(species_botanical_name, "^myoporum laevigatum") ~ "myoporum laetum",#name change
   str_detect(species_botanical_name, "^musa$") ~ "musa spp.",#name change
   
   str_detect(species_botanical_name, "^nandina$") ~ "nandina spp.",#name change
   
   
   str_detect(species_botanical_name, "^phormium$") ~ "phormium spp.",
   str_detect(species_botanical_name, "^picea$") ~ "picea spp.",
   str_detect(species_botanical_name, "^picea glauca") ~ "picea glauca",
   str_detect(species_botanical_name, "^pinus$") ~ "pinus spp.",
   str_detect(species_botanical_name, "^pinus pinea") ~ "pinus pinea",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^pistacia chinensis") ~ "pistacia chinensis",
   
   str_detect(species_botanical_name, "^pittosporum$") ~ "pittosporum spp.",
   str_detect(species_botanical_name, "^pittosporum tawhiwhi") ~ "pittosporum tenuifolium",
   str_detect(species_botanical_name, "^pittosporum rhombifolium") ~ "pittosporum rhombifolia ",
   
   
   str_detect(species_botanical_name, "^platanus × acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hispanica") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^podocarpus gracilior") ~ "afrocarpus gracilior",#name change
   str_detect(species_botanical_name, "^populus$") ~ "populus spp.",
   str_detect(species_botanical_name, "^prunus$") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus amygdalus") ~ "prunus dulcis",
   str_detect(species_botanical_name, "^prunus armenica") ~ "prunus armeniaca",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus ilicifoia") ~ "prunus ilicifolia",
   str_detect(species_botanical_name, "^prunus martimia") ~ "prunus maritima",
   
   
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus spp.") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^psidium$") ~ "psidium spp.",
   str_detect(species_botanical_name, "^pyracantha$") ~ "pyracantha spp.",
   str_detect(species_botanical_name, "^pyrus$") ~ "pyrus spp.",
   str_detect(species_botanical_name, "^quercus$") ~ "quercus spp.",
   str_detect(species_botanical_name, "^quercus frainetto") ~ "quercus frainetto",
   
   str_detect(species_botanical_name, "^rhaphiolepis majestic beauty") ~ "rhaphiolepis indica",
   str_detect(species_botanical_name, "^rhus copallina") ~ "rhus copallinum",
   str_detect(species_botanical_name, "^robinia$") ~ "robinia spp.",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   str_detect(species_botanical_name, "^robinia idahoensis") ~ "robinia ambigua idahoensis",
   str_detect(species_botanical_name, "^robinia ambiqua purple") ~ "robinia pseudoacacia x ambigua",
   str_detect(species_botanical_name, "^rosa$") ~ "rosa spp.",
   
   str_detect(species_botanical_name, "^saponara quillaja") ~ "saponaria quillaja",
   str_detect(species_botanical_name, "^salix$") ~ "salix spp.",
   str_detect(species_botanical_name, "^schinus terbinthefolius") ~ "schinus terebinthifolius",
   str_detect(species_botanical_name, "^solanum rantonnetii") ~ "lycianthes rantonnetii",
   str_detect(species_botanical_name, "^sorbus$") ~ "sorbus spp.",
   str_detect(species_botanical_name, "^syagrus romanzoffianum") ~ "syagrus romanzoffiana",
   str_detect(species_botanical_name, "^syringa$") ~ "syringa spp.",
   str_detect(species_botanical_name, "^syzgium australe") ~ "syzygium australe",
   str_detect(species_botanical_name, "^taxus baccata") ~ "taxus baccata",
   str_detect(species_botanical_name, "^thuga orientalis") ~ "platycladus orientalis",#name change
   str_detect(species_botanical_name, "^thuja lawsoniana") ~ "chamaecyparis lawsoniana",
   str_detect(species_botanical_name, "^thuja occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^tilia tomentosa") ~ "tilia tomentosa",
   str_detect(species_botanical_name, "^trachylospermum jasminoides") ~ "trachelospermum jasminoides",
   str_detect(species_botanical_name, "^tristania conferta") ~ "lophostemon confertus", #name change
   str_detect(species_botanical_name, "^ulmus$") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus ‘frontier’") ~ "ulmus carpinifolia x parvifolia", 
   str_detect(species_botanical_name, "^ulmus japonica wilsoniana") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus parviflora") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus propinqua") ~ "ulmus propinqua",
   str_detect(species_botanical_name, "^ulmus wilsoniana prospector") ~ "ulmus wilsoniana",
   str_detect(species_botanical_name, "^washingtonia romanzoffiana") ~ "syagrus romanzoffiana",
   
   str_detect(species_botanical_name, "^wisteria$") ~ "wisteria spp.",
   str_detect(species_botanical_name, "^yucca$") ~ "yucca spp.",
   str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
   
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer nigra") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tatarian") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer truncatum acer") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^acer truncatum platanoides") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier arborea") ~ "amelanchier arborea",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
   str_detect(species_botanical_name, "^chamaecyparis nootkatensis") ~ "chamaecyparis nootkatensis",
   str_detect(species_botanical_name, "^elm$") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^gingko biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^ginkgo biloba autumn gold") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditsia tricanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^malus apple") ~ "malus spp.",
   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^platanus acerfolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hybrida") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus nigra") ~ "populus nigra",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^rhamnus frangula") ~ "frangula alnus",
   str_detect(species_botanical_name, "^rhus hirta") ~ "rhus typhina",
   str_detect(species_botanical_name, "^salix spp. weeping") ~ "salix babylonica",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus accolade") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus carpinifolia frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus pioneer") ~ "ulmus hollandica",

   str_detect(species_botanical_name, "^ chiranthofremontia lenzii") ~ "chiranthomontodendron lenzii",
   str_detect(species_botanical_name, "^acer autumn blaze") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer ginnela") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer palmatum") ~ "acer palmatum",
   str_detect(species_botanical_name, "^aesculus carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^agonis flexuosa") ~ "agonis flexuosa",
   str_detect(species_botanical_name, "^albizia distachya") ~ "paraserianthes lophantha", #name change, synonym
   str_detect(species_botanical_name, "^angohpora spp.") ~ "angophora spp.",
   str_detect(species_botanical_name, "^arbutus unedo") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^arecastrum romanzoffianum") ~ "syagrus romanzoffiana", #name change, synonym
   str_detect(species_botanical_name, "^arctostaphylos manzanita") ~ "arctostaphylos manzanita",
   
   str_detect(species_botanical_name, "^brahea aramata") ~ "brahea armata", 
   str_detect(species_botanical_name, "^cassia excelsa") ~ "senna spectabilis", 
   str_detect(species_botanical_name, "^caryota maxima") ~ "caryota maxima", 
   str_detect(species_botanical_name, "^ceanothus sps") ~ "ceanothus spp.", 
   str_detect(species_botanical_name, "^chamaecyparis species") ~ "chamaecyparis spp.", 
   str_detect(species_botanical_name, "^chionanthus retusa") ~ "chionanthus retusus", 
   str_detect(species_botanical_name, "^citrus × limon") ~ "citrus limon", 
   str_detect(species_botanical_name, "^citrus × meyeri") ~ "citrus meyeri", 
   str_detect(species_botanical_name, "^cornus nuttallii florida") ~ "cornus nuttallii x florida", 
   str_detect(species_botanical_name, "^cotinus coggygria") ~ "cotinus coggygria", 
   str_detect(species_botanical_name, "^crateagus spp.") ~ "crataegus spp.", 
   str_detect(species_botanical_name, "^ceanothus ray hartman") ~ "ceanothus arboreus x griseus", 
   str_detect(species_botanical_name, "^citrus aurantifolia") ~ "citrus aurantifolia", 
   str_detect(species_botanical_name, "^corynocarpus laevigata") ~ "corynocarpus laevigatus", 
   str_detect(species_botanical_name, "^dodonaea viscosa") ~ "dodonaea viscosa", 
   
   str_detect(species_botanical_name, "^eriobotrya deflexa") ~ "eriobotrya deflexa", 
   str_detect(species_botanical_name, "^eucalyptus lehmanni") ~ "eucalyptus lehmannii", 
   str_detect(species_botanical_name, "^eucalyptus leucoxylon") ~ "eucalyptus leucoxylon", 
   str_detect(species_botanical_name, "^eucalyptus macarthuri") ~ "eucalyptus macarthurii", 
   str_detect(species_botanical_name, "^eucalyptus simmondsi") ~ "eucalyptus globulus", 
   str_detect(species_botanical_name, "^fagus sylvatica") ~ "fagus sylvatica", 
   str_detect(species_botanical_name, "^ficus carica") ~ "ficus carica", 
   str_detect(species_botanical_name, "^ficus laurel") ~ "ficus microcarpa", #name change
   str_detect(species_botanical_name, "^ficus microcarpa") ~ "ficus microcarpa",
   str_detect(species_botanical_name, "^ficus spp.") ~ "ficus spp.",
   str_detect(species_botanical_name, "^fraxinus oxycarpa") ~ "fraxinus oxycarpa",
   str_detect(species_botanical_name, "^ficus retusa") ~ "ficus retusa",
   
   str_detect(species_botanical_name, "^garrya elliptica") ~ "garrya elliptica",
   str_detect(species_botanical_name, "^grevillea red hooks") ~ "grevillea hookeriana",
   
   
   str_detect(species_botanical_name, "^ilex altaclarensis") ~ "ilex altaclerensis",
   str_detect(species_botanical_name, "^juniperus scopulorum") ~ "juniperus scopulorum",
   
   str_detect(species_botanical_name, "^lagerstroemia tuscarora") ~ "lagerstroemia indica", #name change
   str_detect(species_botanical_name, "^leptospermum scoparium") ~ "leptospermum scoparium", #name change
   str_detect(species_botanical_name, "^leucadendron gold strike") ~ "leucadendron strobolinum x laureolum",
   str_detect(species_botanical_name, "^leucodendron argenteum") ~ "leucadendron argenteum",
   str_detect(species_botanical_name, "^lyonothamnus floribundus subsp. asplenifolius") ~ "lyonothamnus floribundus ssp. aspleniifolius",
   
   
   str_detect(species_botanical_name, "^magnolia doltsopa") ~ "magnolia doltsopa",
   str_detect(species_botanical_name, "^magnolia sargentiana") ~ "magnolia sargentiana",
   
   str_detect(species_botanical_name, "^malus gala") ~ "malus domestica",
   str_detect(species_botanical_name, "^malus floribunda") ~ "malus floribunda",
   
   str_detect(species_botanical_name, "^melaleuca styphelliodes") ~ "melaleuca styphelioides",
   str_detect(species_botanical_name, "^metasequoia glyplostroboides") ~ "metasequoia glyptostroboides",
   str_detect(species_botanical_name, "^metrosideros excelsa") ~ "metrosideros excelsa",
   str_detect(species_botanical_name, "^morus alba") ~ "morus alba",
   str_detect(species_botanical_name, "^olea europaea") ~ "olea europaea",
   str_detect(species_botanical_name, "^olea majestic beauty") ~ "olea europaea",
   
   str_detect(species_botanical_name, "^podocarpus gracilor") ~ "afrocarpus gracilior",
   str_detect(species_botanical_name, "^privet$") ~ "ligustrum spp.",
   str_detect(species_botanical_name, "^prunus amanogawa") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus domestica") ~ "prunus domestica",
   str_detect(species_botanical_name, "^prunus persica") ~ "prunus persica",
   str_detect(species_botanical_name, "^prunus sargentii") ~ "prunus sargentii",
   str_detect(species_botanical_name, "^prunus subhirtella") ~ "prunus subhirtella",
   str_detect(species_botanical_name, "^pyracantha santa cruz") ~ "pyracantha koidzumii",
   str_detect(species_botanical_name, "^quercus wislizenii") ~ "quercus wislizeni",
   str_detect(species_botanical_name, "^robinia ambigua") ~ "robinia ambigua idahoensis",
   str_detect(species_botanical_name, "^salix matsudana") ~ "salix matsudana",
   str_detect(species_botanical_name, "^sambucus species") ~ "sambucus spp.",
   str_detect(species_botanical_name, "^schefflera species") ~ "schefflera spp.",
   str_detect(species_botanical_name, "^solanum rantonnetti") ~ "lycianthes rantonnetii",
   str_detect(species_botanical_name, "^tibochina urvilleana") ~ "tibouchina urvilleana",
   str_detect(species_botanical_name, "^ulmus parvifolia") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus prospector") ~ "ulmus davidiana var. japonica",
   str_detect(species_botanical_name, "^viburnum odoratissimum") ~ "viburnum odoratissimum",
   str_detect(species_botanical_name, "^tristaniopsis laurina") ~ "tristaniopsis laurina",
   str_detect(species_botanical_name, "^punica granatum") ~ "punica granatum",
   
   str_detect(species_botanical_name, "^palm \\(unknown genus") ~ "arecaceae spp.",
   str_detect(species_botanical_name, "^patanus racemosa") ~ "platanus racemosa",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
   
   str_detect(species_botanical_name, "^abies$") ~ "abies spp.",
   str_detect(species_botanical_name, "^acer g. flame") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer negundo") ~ "acer negundo",
   str_detect(species_botanical_name, "^acer nigrum") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer pacific sunset") ~ "acer truncatum",
   str_detect(species_botanical_name, "^acer pseudoplatanus") ~ "acer pseudoplatanus",
   str_detect(species_botanical_name, "^acer sacccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tatricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer truncatum") ~ "acer truncatum",
   str_detect(species_botanical_name, "^aesculus arguta") ~ "aesculus glabra",
   str_detect(species_botanical_name, "^aesculus arnoldiana") ~ "aesculus arnoldiana",
   str_detect(species_botanical_name, "^aesculus flava") ~ "aesculus flava",
   str_detect(species_botanical_name, "^aesculus hippocastanum") ~ "aesculus hippocastanum",
   str_detect(species_botanical_name, "^aesculus octandra") ~ "aesculus flava",
   
   str_detect(species_botanical_name, "^alnus glutinosa") ~ "alnus glutinosa",
   str_detect(species_botanical_name, "^alnus incana") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier$") ~ "amelanchier spp.",
   str_detect(species_botanical_name, "^amelanchier autumn brillance") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^amelanchier c. rainbow pillar") ~ "amelanchier canadensis",
   str_detect(species_botanical_name, "^amelanchier canadensis") ~ "amelanchier canadensis",
   str_detect(species_botanical_name, "^amelanchier g. princess") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^amelanchier laevis") ~ "amelanchier laevis",
   
   str_detect(species_botanical_name, "^betula$") ~ "betula spp.",
   str_detect(species_botanical_name, "^betula alba") ~ "betula pendula", #synonym
   str_detect(species_botanical_name, "^betula alleghaniensis") ~ "betula alleghaniensis",
   str_detect(species_botanical_name, "^betula p. parkland pillartm") ~ "betula platyphylla",
   str_detect(species_botanical_name, "^betula papyrifera") ~ "betula papyrifera",
   str_detect(species_botanical_name, "^betula platyphylla") ~ "betula platyphylla",
   str_detect(species_botanical_name, "^betula penci-2") ~ "betula penci-2",
   
   
   str_detect(species_botanical_name, "^caragana$") ~ "caragana spp.",
   str_detect(species_botanical_name, "^caragana arobrescens") ~ "caragana arborescens",
   str_detect(species_botanical_name, "^caragana arborescens") ~ "caragana arborescens",

   str_detect(species_botanical_name, "^carpinus$") ~ "carpinus spp.",
   str_detect(species_botanical_name, "^carpinus caroliniana") ~ "carpinus caroliniana",
   str_detect(species_botanical_name, "^carya$") ~ "carya spp.",
   str_detect(species_botanical_name, "^catalpa$") ~ "catalpa spp.",
   str_detect(species_botanical_name, "^catalpa bignonioides") ~ "catalpa bignonioides",
   str_detect(species_botanical_name, "^catalpa speciosa") ~ "catalpa speciosa",
   str_detect(species_botanical_name, "^celtis occidentalis") ~ "celtis occidentalis",
   str_detect(species_botanical_name, "^cercidiphyllum japonicum") ~ "cercidiphyllum japonicum",
   str_detect(species_botanical_name, "^cercidiphyllum$") ~ "cercidiphyllum spp.",
   str_detect(species_botanical_name, "^cercidiphyllym japonicum") ~ "cercidiphyllum japonicum",
   
   str_detect(species_botanical_name, "^chamaecyparis nootkensis") ~ "chamaecyparis nootkatensis",
   str_detect(species_botanical_name, "^cladastris kentukea") ~ "cladrastis kentukea",
   str_detect(species_botanical_name, "^cladastris lutea") ~ "cladrastis kentukea", #synonym
   str_detect(species_botanical_name, "^cladrastis$") ~ "cladrastis spp.", 
   str_detect(species_botanical_name, "^cornus$") ~ "cornus spp.",
   str_detect(species_botanical_name, "^corylus$") ~ "corylus spp.",
   str_detect(species_botanical_name, "^crataegus crus-galli") ~ "crataegus crus-galli",
   str_detect(species_botanical_name, "^crataegus mordenensis") ~ "crataegus mordenensis",
   str_detect(species_botanical_name, "^crataegus mordensis") ~ "crataegus mordenensis",
   str_detect(species_botanical_name, "^crataegus oxyacantha") ~ "crataegus oxyacantha",
   
   str_detect(species_botanical_name, "^elaeagnus$") ~ "elaeagnus spp.",
   str_detect(species_botanical_name, "^elaeagnus angustifolia") ~ "elaeagnus angustifolia",
   
   str_detect(species_botanical_name, "^fagus$") ~ "fagus spp.",
   str_detect(species_botanical_name, "^fagus grandifolia") ~ "fagus grandifolia",
   str_detect(species_botanical_name, "^fraxinus chinensis") ~ "fraxinus chinensis",
   str_detect(species_botanical_name, "^fraxinus excelsior") ~ "fraxinus excelsior",
   str_detect(species_botanical_name, "^fraxinus nigra") ~ "fraxinus nigra",
   
   
   str_detect(species_botanical_name, "^ginkgo$") ~ "ginkgo spp.",
   str_detect(species_botanical_name, "^gleditsia$") ~ "gleditsia spp.",
   str_detect(species_botanical_name, "^gleditsia t. sungolzam") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus d.") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^gymnocladus$") ~ "gymnocladus spp.",
   str_detect(species_botanical_name, "^juniperus chinensis") ~ "juniperus chinensis",
   str_detect(species_botanical_name, "^juniperus virginiana") ~ "juniperus virginiana",
   str_detect(species_botanical_name, "^juglans ailantifolia") ~ "juglans ailantifolia",
   
   str_detect(species_botanical_name, "^larix$") ~ "larix spp.",
   str_detect(species_botanical_name, "^larix decidua") ~ "larix decidua",
   str_detect(species_botanical_name, "^larix kaempferi") ~ "larix kaempferi",
   str_detect(species_botanical_name, "^liriodendron tulipifera") ~ "liriodendron tulipifera",
   str_detect(species_botanical_name, "^liriodendron$") ~ "liriodendron spp.",
   
   str_detect(species_botanical_name, "^maackia$") ~ "maackia spp.",
   str_detect(species_botanical_name, "^maackia amurensis") ~ "maackia amurensis",
   str_detect(species_botanical_name, "^magnolia fraseri") ~ "magnolia fraseri",
   str_detect(species_botanical_name, "^magnolia little susan") ~ "magnolia liliiflora x stellata",
   str_detect(species_botanical_name, "^magnolia loebneri") ~ "magnolia loebneri",
   str_detect(species_botanical_name, "^magnolia rustica rubra") ~ "magnolia soulangeana",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
   str_detect(species_botanical_name, "^magnolia stellata") ~ "magnolia stellata",
  
   str_detect(species_botanical_name, "^malus adstringens") ~ "malus adstringens",
   str_detect(species_botanical_name, "^malus baccata") ~ "malus baccata",
   str_detect(species_botanical_name, "^malus brandywine") ~ "malus brandywine",
   str_detect(species_botanical_name, "^malus centurion") ~ "malus centurion",
   str_detect(species_botanical_name, "^malus domestica") ~ "malus domestica",
   str_detect(species_botanical_name, "^malus gingergold") ~ "malus domestica", #cultivar of domestica
   str_detect(species_botanical_name, "^malus dreamweaver") ~ "malus dreamweaver",

   str_detect(species_botanical_name, "^malus golden raindrops") ~ "malus transitoria", #cultivar of transitoria
   str_detect(species_botanical_name, "^malus haralson") ~ "malus domestica", #cultivar of domestica
   str_detect(species_botanical_name, "^malus harvest gold") ~ "malus harvest gold",
   str_detect(species_botanical_name, "^malus honeycrisp") ~ "malus domestica", #cultivar of domestica
   str_detect(species_botanical_name, "^malus ioensis") ~ "malus ioensis",
   str_detect(species_botanical_name, "^malus jaune transparente") ~ "malus domestica", #cultivar of domestica
   
   str_detect(species_botanical_name, "^malus jefgreen") ~ "malus jefgreen",
   str_detect(species_botanical_name, "^malus jeflite") ~ "malus jeflite", 
   str_detect(species_botanical_name, "^malus jefspire") ~ "malus jefspire", 
   str_detect(species_botanical_name, "^malus robusta") ~ "malus robusta", 

   str_detect(species_botanical_name, "^malus liset") ~ "malus moerlandsii", #cultivar of moerlandsii
   str_detect(species_botanical_name, "^malus profusion") ~ "malus moerlandsii", #cultivar of moerlandsii
   str_detect(species_botanical_name, "^malus prunifolia") ~ "malus prunifolia", #cultivar of moerlandsii
   str_detect(species_botanical_name, "^malus red jade") ~ "malus scheideckeri", #cultivar of moerlandsii
   
   str_detect(species_botanical_name, "^malus scarlet") ~ "malus brandywine", #cultivar of moerlandsii
   str_detect(species_botanical_name, "^malus sp. september ruby") ~ "malus domestica", #cultivar of domestica
   str_detect(species_botanical_name, "^malus sugar tyme") ~ "malus sutyzam", #cultivar of domestica
   str_detect(species_botanical_name, "^malux thunder bay") ~ "malus thunder bay",
   
   str_detect(species_botanical_name, "^nyssa sylvatica") ~ "nyssa sylvatica",
   str_detect(species_botanical_name, "^phellodendron$") ~ "phellodendron spp.",
   str_detect(species_botanical_name, "^phellodendron amurensis") ~ "phellodendron amurense",
   str_detect(species_botanical_name, "^phellodendron l. longenecker") ~ "phellodendron amurense",
   str_detect(species_botanical_name, "^picea abies") ~ "picea abies",
   str_detect(species_botanical_name, "^picea omorika") ~ "picea omorika",
   str_detect(species_botanical_name, "^picea punges") ~ "picea pungens",

   str_detect(species_botanical_name, "^pinus mugo") ~ "pinus mugo",
   str_detect(species_botanical_name, "^pinus parvifolia") ~ "pinus parviflora",
   str_detect(species_botanical_name, "^pinus strobus") ~ "pinus strobus",
   str_detect(species_botanical_name, "^pinus sylvestris") ~ "pinus sylvestris",
   str_detect(species_botanical_name, "^pinus nigra") ~ "pinus nigra",

   str_detect(species_botanical_name, "^platanus$") ~ "platanus spp.",
   str_detect(species_botanical_name, "^platanus a. morton circle") ~ "platanus acerifolia",
   
   str_detect(species_botanical_name, "^populus 915508") ~ "populus spp.",
   str_detect(species_botanical_name, "^populus alba") ~ "populus alba",
   str_detect(species_botanical_name, "^populus canadensis") ~ "populus canadensis",
   str_detect(species_botanical_name, "^populus canescens") ~ "populus canescens",
   str_detect(species_botanical_name, "^populus deltoides") ~ "populus deltoides",
   str_detect(species_botanical_name, "^populus simonii") ~ "populus simonii",
   str_detect(species_botanical_name, "^populus sp.") ~ "populus spp.",
   str_detect(species_botanical_name, "^populus tremula") ~ "populus tremula",
   str_detect(species_botanical_name, "^populus tremuloides") ~ "populus tremuloides",
   
   
   str_detect(species_botanical_name, "^prunus américain toka") ~ "prunus salicina",
   str_detect(species_botanical_name, "^prunus armeniaca scout") ~ "prunus armeniaca",
   str_detect(species_botanical_name, "^prunus avium") ~ "prunus avium",
   str_detect(species_botanical_name, "^prunus cerasus") ~ "prunus cerasus",
   str_detect(species_botanical_name, "^prunus cerisier") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus sub. syriaca compass") ~ "prunus compass",
   str_detect(species_botanical_name, "^prunus fructicosa xcerasus") ~ "prunus fruticosa x cerasus",
   str_detect(species_botanical_name, "^prunus maakii") ~ "prunus maackii",
   str_detect(species_botanical_name, "^prunus multifruits") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus padus") ~ "prunus padus",
   str_detect(species_botanical_name, "^prunus salicina") ~ "prunus salicina",
   str_detect(species_botanical_name, "^prunus stella") ~ "prunus avium",
   
   str_detect(species_botanical_name, "^pseudostuga$") ~ "pseudotsuga spp.",
   str_detect(species_botanical_name, "^pseudostuga menziesii") ~ "pseudotsuga menziesii",
   str_detect(species_botanical_name, "^pseudotsuga menziesii") ~ "pseudotsuga menziesii",
   str_detect(species_botanical_name, "^pterocarya stepnotera") ~ "pterocarya stenoptera",
   
   str_detect(species_botanical_name, "^pyrus communis") ~ "pyrus communis",
   str_detect(species_botanical_name, "^pyrus multifruits") ~ "pyrus spp.",
   str_detect(species_botanical_name, "^pyrus pyrifolia") ~ "pyrus pyrifolia",
   str_detect(species_botanical_name, "^pyrus ussuriensis") ~ "pyrus ussuriensis",

   str_detect(species_botanical_name, "^quercus atwood") ~ "quercus robur x macrocarpa",
   str_detect(species_botanical_name, "^quercus kindred spirit") ~ "quercus nadler",
   str_detect(species_botanical_name, "^quercus palustris") ~ "quercus palustris",
   
   str_detect(species_botanical_name, "^quercus b. midwest") ~ "quercus bimundorum",
   str_detect(species_botanical_name, "^quercus macdanielii") ~ "quercus macdanielii",
   str_detect(species_botanical_name, "^quercus macrocarpa") ~ "quercus macrocarpa",
   str_detect(species_botanical_name, "^quercus warei") ~ "quercus warei",

   str_detect(species_botanical_name, "^rhamnus$") ~ "rhamnus spp.",
   str_detect(species_botanical_name, "^rhus$") ~ "rhus spp.",
   
   str_detect(species_botanical_name, "^salix alba") ~ "salix alba",
   str_detect(species_botanical_name, "^salix babylonica") ~ "salix babylonica",
   str_detect(species_botanical_name, "^salix chrysocoma") ~ "salix sepulcralis", #synonym
   str_detect(species_botanical_name, "^salix pentendra") ~ "salix pentandra", 
   
   str_detect(species_botanical_name, "^sorbus aucuparia") ~ "sorbus aucuparia", 
   str_detect(species_botanical_name, "^sorbus thuringiaca") ~ "sorbus thuringiaca", 
   str_detect(species_botanical_name, "^sorbus xanthocarpa") ~ "sorbus aucuparia", 
   
   str_detect(species_botanical_name, "^syringa reticulata") ~ "syringa reticulata", 
   
   str_detect(species_botanical_name, "^taxodium distichum") ~ "taxodium distichum", 
   str_detect(species_botanical_name, "^taxus$") ~ "taxus spp.", 
   str_detect(species_botanical_name, "^taxus cuspidata") ~ "taxus cuspidata", 
   str_detect(species_botanical_name, "^thuja$") ~ "thuja spp.",
   str_detect(species_botanical_name, "^thuya occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^tilia$") ~ "tilia spp.",
   str_detect(species_botanical_name, "^tilia a. lincoln") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia europea euchlora") ~ "tilia euchlora",
   str_detect(species_botanical_name, "^tilia europaea wratislaviensis") ~ "tilia europaea",
   
   str_detect(species_botanical_name, "^tilia flavescens") ~ "tilia flavescens",
   str_detect(species_botanical_name, "^tilia mongolica") ~ "tilia mongolica",

   str_detect(species_botanical_name, "^ulmus 13-0053") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^ulmus a. pmm-2") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus cathedral") ~ "ulmus cathedral",
   str_detect(species_botanical_name, "^ulmus davidiana discovery") ~ "ulmus davidiana var. japonica",
   str_detect(species_botanical_name, "^ulmus davidiana grennstone") ~ "ulmus davidiana",
   str_detect(species_botanical_name, "^ulmus glabra") ~ "ulmus glabra",
   str_detect(species_botanical_name, "^ulmus hollandica") ~ "ulmus hollandica",
   str_detect(species_botanical_name, "^ulmus morton") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus patriot") ~ "ulmus patriot",
   str_detect(species_botanical_name, "^ulmus pumila") ~ "ulmus pumila",
   str_detect(species_botanical_name, "^ulmus sapporo") ~ "ulmus davidiana var. japonica",
         
   TRUE ~ species_botanical_name
  ))


montreal_trees_clean <- left_join(montreal_trees_clean, spp_code, by = "species_botanical_name")

montreal_trees_clean <- montreal_trees_clean %>% 
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))


montreal_trees_clean<-montreal_trees_clean[, c(5:8,2,1,4,9,3)]


montreal_trees_clean <- montreal_trees_clean %>%
    filter(long >= -79.00 & long <= -70.00,
    lat >= 40.00 & lat <= 49.00)

#write.csv(montreal_trees_clean, "~/Dropbox/Urban_data/Cleaned/montreal_trees_clean.csv", row.names = FALSE)



```



#NOLA
  Downloaded from: https://data.nola.gov/Parks-Parkways/Tree-Locations/g94y-wr47#next
  Data projected on NAD_1983_StatePlane_Louisiana_South_FIPS_1702_Feet
 dbh in inches
 
```{r}

nola_trees<- read.csv("~/Dropbox/Urban_data/Raw/neworleans_la_usa.csv")

nola_trees$country <- "usa"
nola_trees$state <- "louisiana"
nola_trees$city <- "new orleans"
nola_trees$year <- "2019" #last updated 2019

# Exclude rows with NA values in x or y columns
nola_trees <- nola_trees[complete.cases(nola_trees$long, nola_trees$lat), ]

# Define the coordinate reference system (CRS)
crs <- CRS("+proj=lcc +lat_1=29.3 +lat_2=30.7 +lat_0=28.5 +lon_0=-91.33333333333333 +x_0=1000000 +y_0=0 +datum=NAD83 +units=us-ft +no_defs +ellps=GRS80 +towgs84=0,0,0")

# Create the SpatialPointsDataFrame
points <- SpatialPointsDataFrame(coords = nola_trees[, c("long", "lat")],
                                 data = nola_trees,
                                 proj4string = crs)

# Define the target CRS
target_crs <- CRS("+init=EPSG:4326")

# Transform the points to latitude and longitude
points_wgs84 <- spTransform(points, target_crs)

# Replace X and Y values with latitude and longitude points in the dataset
nola_trees$long <- coordinates(points_wgs84)[, 1]
nola_trees$lat <- coordinates(points_wgs84)[, 2]


nola_trees_clean <- nola_trees %>% 
  dplyr::rename(
                dbh = EXACT_DBH,
                species_botanical_name = BOTANICAL) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year))%>%
  filter(dbh > 0) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>%   
  filter(dbh > 0) %>% 
  filter(!grepl("^unknown|^unidentifiable|^stump|^shrub", species_botanical_name, ignore.case = TRUE)) %>%
  mutate(species_botanical_name = gsub("species$|sp$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

nola_trees_clean$dbh <- nola_trees_clean$dbh * 2.54 ##converting from inches to cm

nola_trees_clean$species_botanical_name[nola_trees_clean$species_botanical_name == ""] <- NA

nola_trees_clean <- nola_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^amelanchier$") ~ "amelanchier spp.",
   str_detect(species_botanical_name, "^acacia farnesiana") ~ "vachellia farnesiana", #synonym
   str_detect(species_botanical_name, "^acer buergeranum") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^bauhinia variegata candida") ~ "bauhinia variegata var. candida",
   
   str_detect(species_botanical_name, "^callistemon red cluster") ~ "callistemon citrinus",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^crataegus crus-galli") ~ "crataegus crus-galli",
   str_detect(species_botanical_name, "^cytisus canariensis") ~ "genista canariensis", #synonym
   str_detect(species_botanical_name, "^handroanthus umbellatus") ~ "tabebuia umbellata", #synonym
   
   str_detect(species_botanical_name, "^ilex attenuata") ~ "ilex attenuata", 
   str_detect(species_botanical_name, "^ilex nellie r. stevens") ~ "ilex aquifolium x cornuta", #hybrid
   str_detect(species_botanical_name, "^ilex vomitoria") ~ "ilex vomitoria", 
   
   str_detect(species_botanical_name, "^koelreuteria elegans") ~ "koelreuteria elegans", 
   str_detect(species_botanical_name, "^lagerstroemia indica") ~ "lagerstroemia indica", 
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua", 
   
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora", 
   str_detect(species_botanical_name, "^magnolia liliiflora") ~ "magnolia liliiflora", 
   str_detect(species_botanical_name, "^morus alba") ~ "morus alba", 
      
   str_detect(species_botanical_name, "^osmanthus fragrans") ~ "osmanthus fragrans", 
   
   str_detect(species_botanical_name, "^palm spp.") ~ "arecaceae spp.", 
   str_detect(species_botanical_name, "^phoenix dactylifera") ~ "phoenix dactylifera", 
   str_detect(species_botanical_name, "^pinus echinat") ~ "pinus echinata", 
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera", 
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata", 
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana", 
   
   str_detect(species_botanical_name, "^quercus warei") ~ "quercus warei", 
   str_detect(species_botanical_name, "^rhaphiolepis majestic beauty") ~ "rhaphiolepis indica", #scientific name
   str_detect(species_botanical_name, "^rhododendron southern indica") ~ "rhododendron indicum", #scientific name
   
   str_detect(species_botanical_name, "^salix matsudana") ~ "salix matsudana",
   str_detect(species_botanical_name, "^sophora secundiflora") ~ "dermatophyllum secundiflorum", #synonym
   str_detect(species_botanical_name, "^syzygium australe") ~ "syzygium australe", 
      
   str_detect(species_botanical_name, "^ulmus glabra") ~ "ulmus glabra", 
   str_detect(species_botanical_name, "^viburnum odoratissimum") ~ "viburnum odoratissimum", 
   str_detect(species_botanical_name, "^washingtonia filifera") ~ "washingtonia filifera", 

         
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^carpinus japonica") ~ "carpinus japonica",
   str_detect(species_botanical_name, "^cercis reniformis") ~ "cercis reniformis",
   
   str_detect(species_botanical_name, "^lagerstroemia$") ~ "lagerstroemia spp.",
   
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   
   TRUE ~ species_botanical_name
  ))

nola_trees_clean <- left_join(nola_trees_clean, spp_code, by = "species_botanical_name")

nola_trees_clean <- nola_trees_clean %>% 
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))


nola_trees_clean<-nola_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(nola_trees_clean, "~/Dropbox/Urban_data/Cleaned/nola_trees_clean.csv", row.names = FALSE)



```



#NYC
Data downloaded from: https://data.cityofnewyork.us/Environment/2015-Street-Tree-Census-Tree-Data/pi5s-9p35

```{r}

#Clean
nyc_trees<- read.csv("~/Dropbox/Urban_data/Raw/nyc_ny_usa.csv")

nyc_trees$country <- "usa"
nyc_trees$state <- "new york"
nyc_trees$city <- "new york city"
nyc_trees$year <- "2015" #last updated in 2015

nyc_trees_clean <- nyc_trees %>% 
  dplyr::rename(long = longitude,
                lat = Latitude,
                dbh = tree_dbh, #in inches
                #species_common_name = spc_common,
                species_botanical_name = spc_latin,
                neighborhood = zip_city) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year))%>%
  filter(dbh > 0) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("species$|sp$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

nyc_trees_clean$dbh <- nyc_trees_clean$dbh * 2.54 ##converting from inches to cm

nyc_trees_clean$species_botanical_name[nyc_trees_clean$species_botanical_name == ""] <- NA

nyc_trees_clean <- nyc_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^amelanchier$") ~ "amelanchier spp.",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^carpinus japonica") ~ "carpinus japonica",
   str_detect(species_botanical_name, "^cercis reniformis") ~ "cercis reniformis",
   str_detect(species_botanical_name, "^catalpa$") ~ "catalpa spp.",
   str_detect(species_botanical_name, "^crataegus") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crataegus crusgalli") ~ "crataegus crus-galli",
   str_detect(species_botanical_name, "^fraxinus$") ~ "fraxinus spp.",
   str_detect(species_botanical_name, "^halesia diptera") ~ "halesia diptera",
   str_detect(species_botanical_name, "^ilex$") ~ "ilex spp.",
   str_detect(species_botanical_name, "^lagerstroemia$") ~ "lagerstroemia spp.",
   str_detect(species_botanical_name, "^magnolia") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^malus$") ~ "malus spp.",
   str_detect(species_botanical_name, "^morus$") ~ "morus spp.",
   str_detect(species_botanical_name, "^picea$") ~ "picea spp.",
   str_detect(species_botanical_name, "^pinus$") ~ "pinus spp.",
   str_detect(species_botanical_name, "^prunus$") ~ "prunus spp.",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   
   TRUE ~ species_botanical_name
  ))

nyc_trees_clean <- left_join(nyc_trees_clean, spp_code, by = "species_botanical_name")

nyc_trees_clean <- nyc_trees_clean %>% 
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))

nyc_trees_clean<-nyc_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(nyc_trees_clean, "~/Dropbox/Urban_data/Cleaned/nyc_trees_clean.csv", row.names = FALSE)


```


#Philadelphia

Data downloaded from: https://opendataphilly.org/datasets/philadelphia-tree-inventory/
  DBH in inches
```{r}

#Clean
philly_trees<- read.csv("~/Dropbox/Urban_data/Raw/philadelphia_pa_usa.csv")

philly_trees$country <- "usa"
philly_trees$state <- "pennsylvania"
philly_trees$city <- "philadelphia"
philly_trees$year <- "2022" #last updated in 2022

philly_trees_clean <- philly_trees %>% 
 # filter(height != "0" & height != "") %>% 
  dplyr::rename(long = X,
                lat = Y,
                dbh = TREE_DBH, #inches
                #species_common_name = common_name,
                species_botanical_name = TREE_NAME) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>%
  filter(dbh > 0) %>% 
  filter(!grepl("^unknown|^vacant|^stump|^shrub", species_botanical_name, ignore.case = TRUE)) %>%
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

philly_trees_clean$dbh <- philly_trees_clean$dbh * 2.54 ##converting from inches to cm

philly_trees_clean$species_botanical_name <- gsub("\\s*-.*", "", philly_trees_clean$species_botanical_name)
philly_trees_clean$species_botanical_name[philly_trees_clean$species_botanical_name == ""] <- NA

philly_trees_clean<-philly_trees_clean %>% 
  mutate(species_botanical_name = gsub("species$|sp$", "spp.", species_botanical_name)) 
  
philly_trees_clean <- philly_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer buergeranum") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer henryii") ~ "acer henryi",
   str_detect(species_botanical_name, "^acer triflorum") ~ "acer triflorum",
   str_detect(species_botanical_name, "^acer pensyvanicum") ~ "acer pensylvanicum",
   str_detect(species_botanical_name, "^alnus species") ~ "alnus spp.",
   str_detect(species_botanical_name, "^cedrella sinensis") ~ "toona sinensis",
   str_detect(species_botanical_name, "^cornus rutban") ~ "cornus florida x kousa",
   str_detect(species_botanical_name, "^crataegus crus") ~ "crataegus crus-galli",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^kalopanax semtemlobus") ~ "kalopanax septemlobus",
   str_detect(species_botanical_name, "^poplar spp.") ~ "populus spp.",
   str_detect(species_botanical_name, "^prunus amanogawa") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus pennsylvanica") ~ "prunus pensylvanica",
   str_detect(species_botanical_name, "^prunus incamp") ~ "prunus incam",
   
   str_detect(species_botanical_name, "^syringia reticulata") ~ "syringa reticulata",
   str_detect(species_botanical_name, "^tetradium daniellii") ~ "tetradium daniellii",
   str_detect(species_botanical_name, "^thuja orientalis") ~ "platycladus orientalis",
   str_detect(species_botanical_name, "^ulmus emerald sunshine") ~ "ulmus davidiana var. japonica",
   str_detect(species_botanical_name, "^ulmus frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^aesculus octandra") ~ "aesculus flava",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
  str_detect(species_botanical_name, "^sophora japonica") ~ "styphnolobium japonicum",
   
   TRUE ~ species_botanical_name
  ))

philly_trees_clean <- left_join(philly_trees_clean, spp_code, by = "species_botanical_name")

philly_trees_clean <- philly_trees_clean %>% 
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))

philly_trees_clean<-philly_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(philly_trees_clean, "~/Dropbox/Urban_data/Cleaned/philly_trees_clean.csv", row.names = FALSE)

```


#Pittsburgh
Data downloaded from: https://data.wprdc.org/dataset/city-trees

```{r}

#Clean
pitt_trees<- read.csv("~/Dropbox/Urban_data/Raw/pittsburgh_pa_usa.csv")

pitt_trees$country <- "usa"
pitt_trees$state <- "pennsylvania"
pitt_trees$city <- "pittsburgh"
pitt_trees$year <- "2020" #last updated in 2020

pitt_trees_clean <- pitt_trees %>% 
 # filter(height != "0" & height != "") %>% 
  dplyr::rename(long = longitude,
                lat = latitude,
                dbh = diameter_base_height, #inches
                #species_common_name = common_name,
                species_botanical_name = scientific_name) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>%
  filter(dbh > 0) %>% 
  filter(!grepl("^unknown|^vacant|^stump", species_botanical_name, ignore.case = TRUE)) %>%
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("species$|sp$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

pitt_trees_clean$dbh <- pitt_trees_clean$dbh * 2.54 ##converting from inches to cm

pitt_trees_clean <- pitt_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",

   str_detect(species_botanical_name, "^magnolia") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^malus communis") ~ "malus domestica",
   str_detect(species_botanical_name, "^malus spp. donald wyman") ~ "malus donald wyman",
   str_detect(species_botanical_name, "^ulmus $") ~ "malus donald wyman",
   str_detect(species_botanical_name, "^tilia petiolaris") ~ "tilia tomentosa", #synonym
   str_detect(species_botanical_name, "^chamaecyparis lawsonia") ~ "chamaecyparis lawsoniana",
   str_detect(species_botanical_name, "^sophora japonica") ~ "styphnolobium japonicum",
   str_detect(species_botanical_name, "^halesia caroliniana") ~ "halesia carolina",
   
   TRUE ~ species_botanical_name
  ))

pitt_trees_clean$species_botanical_name[pitt_trees_clean$species_botanical_name == ""] <- NA

pitt_trees_clean <- left_join(pitt_trees_clean, spp_code, by = "species_botanical_name")

pitt_trees_clean <- pitt_trees_clean %>% 
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))


pitt_trees_clean<-pitt_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(pitt_trees_clean, "~/Dropbox/Urban_data/Cleaned/pitt_trees_clean.csv", row.names = FALSE)

```

#Portland
Data downloaded from: https://www.portland.gov/trees/get-involved/treeinventory 
  projected spatial reference WKID 3857 (Web Mercator).
  dbh is in inches
```{r}

port_street_trees<- read.csv("~/Dropbox/Urban_data/Raw/portland_or_usa_street_tree.csv")
port_street_trees <- port_street_trees %>% 
  select(c(X, Y, DBH, Scientific)) %>% 
  dplyr::rename(species_botanical_name = Scientific)


port_park_trees<- read.csv("~/Dropbox/Urban_data/Raw/portland_or_usa_park_tree.csv")
port_park_trees <- port_park_trees %>% 
  select(c(X, Y, DBH, Genus_species)) %>% 
  dplyr::rename(species_botanical_name = Genus_species)

port_trees <- full_join(port_street_trees,port_park_trees)
  
#write.csv(port_trees, "~/Dropbox/Urban_data/portland_or_usa.csv", row.names = FALSE)

#port_trees<- read.csv("~/Dropbox/Urban_data/portland_or_usa.csv")

port_trees$country <- "usa"
port_trees$state <- "oregon"
port_trees$city <- "portland"
port_trees$year <- "2022" #last updated in 2022

port_trees <- port_trees[complete.cases(port_trees$X, port_trees$Y), ]

# Define the coordinate reference system (CRS)
crs <- CRS("+init=EPSG:3857")

# Create the SpatialPointsDataFrame
points <- SpatialPointsDataFrame(coords = port_trees[, c("X", "Y")],
                                 data = port_trees,
                                 proj4string = crs)

# Define the target CRS
target_crs <- CRS("+init=EPSG:4326")

# Transform the points to latitude and longitude
points_wgs84 <- spTransform(points, target_crs)

# Replace X and Y values with latitude and longitude points in the dataset
port_trees$X <- coordinates(points_wgs84)[, 1]
port_trees$Y <- coordinates(points_wgs84)[, 2]


#Clean
port_trees_clean <- port_trees %>% 
  #filter(species != "Stump" & height != "") %>% 
  dplyr::rename(long = X,
                lat = Y,
                dbh = DBH) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city,year)) %>%
  filter(dbh > 0) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  filter(!grepl("^unknown|^vacant|^stump", species_botanical_name, ignore.case = TRUE)) %>%
  mutate(species_botanical_name = gsub("species$|sp$|sp.$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

port_trees_clean$dbh <- port_trees_clean$dbh * 2.54 ##converting from inches to cm

port_trees_clean$species_botanical_name[port_trees_clean$species_botanical_name == ""] <- NA

port_trees_clean <- port_trees_clean %>%
  mutate(species_botanical_name = case_when(
    
   str_detect(species_botanical_name, "^ chitalpa tashkentensis") ~ "chitalpa tashkentensis",
   str_detect(species_botanical_name, "^ cupressocyparis leylandii") ~ "cupressocyparis leylandii",
   str_detect(species_botanical_name, "^abies grandis") ~ "abies grandis",
   str_detect(species_botanical_name, "^acer grandidentatum") ~ "acer grandidentatum",
   
   str_detect(species_botanical_name, "^acer tataricum ssp. ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^cedrus atlantica") ~ "cedrus atlantica",
   str_detect(species_botanical_name, "^crataegus lavalleei") ~ "crataegus lavallei",
   
   str_detect(species_botanical_name, "^cupressus nootkatensis") ~ "xanthocyparis nootkatensis", #name change, synonym
   str_detect(species_botanical_name, "^daphniphyllum himalaense var. macropodum") ~ "daphniphyllum macropodum", #name change, synonym
   
  str_detect(species_botanical_name, "^gymnocladus dioica") ~ "gymnocladus dioicus",
  str_detect(species_botanical_name, "^magnolia maudiae") ~ "magnolia maudiae",
   
  str_detect(species_botanical_name, "^halesia tetraptera var. monticola") ~ "halesia tetraptera", #shortened name
  str_detect(species_botanical_name, "^machilus thunbergii") ~ "machilus thunbergii", #shortened name
  str_detect(species_botanical_name, "^magnolia martinii") ~ "magnolia martini",
  str_detect(species_botanical_name, "^picea breweriana") ~ "picea breweriana",
  str_detect(species_botanical_name, "^pinus kwangtungensis") ~ "pinus fenzeliana",
  str_detect(species_botanical_name, "^pinus rudis") ~ "pinus hartwegii", #name change, synonym
  str_detect(species_botanical_name, "^prunus \\(") ~ "prunus spp.", 
  str_detect(species_botanical_name, "^quercus dentata") ~ "quercus dentata", 
  
  str_detect(species_botanical_name, "^salix matsudana") ~ "salix matsudana", 
  str_detect(species_botanical_name, "^stewartia pseudocamellia") ~ "stewartia pseudocamellia", 
  str_detect(species_botanical_name, "^styphnolobium japonicum") ~ "styphnolobium japonicum", 
  str_detect(species_botanical_name, "^sophora japonica") ~ "styphnolobium japonicum", 
  str_detect(species_botanical_name, "^thujopsis dolobrata") ~ "thujopsis dolabrata", 
  str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.", 
  str_detect(species_botanical_name, "^ulmus glabra") ~ "ulmus glabra", 
  str_detect(species_botanical_name, "^ulmus japonica wilsoniana") ~ "ulmus japonica x wilsoniana", 
  
  
   TRUE ~ species_botanical_name
  ))



port_trees_clean <- left_join(port_trees_clean,spp_code, by = "species_botanical_name")


port_trees_clean <- port_trees_clean %>% 
  filter(!is.na(species_botanical_name)) %>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))

port_trees_clean<-port_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(port_trees_clean, "~/Dropbox/Urban_data/Cleaned/portland_trees_clean.csv", row.names = FALSE)


```


#Richmond
Data downloaded from: https://github.com/kfinity/rva-tree-inventory

```{r}

#Clean
richmond_trees<- read.csv("~/Dropbox/Urban_data/Raw/richmond_va_usa.csv")

richmond_trees$country <- "usa"
richmond_trees$state <- "virginia"
richmond_trees$city <- "richmond"
richmond_trees$year <- "2015" #collected in 2015

richmond_trees <- richmond_trees[complete.cases(richmond_trees$geo_x, richmond_trees$geo_y), ]

crs <- CRS("+init=EPSG:2284")


# Create the SpatialPointsDataFrame
points <- SpatialPointsDataFrame(coords = richmond_trees[, c("geo_x", "geo_y")],
                                 data = richmond_trees,
                                 proj4string = crs)

# Define the target CRS
target_crs <- CRS("+init=EPSG:4326")

# Transform the points to latitude and longitude
points_wgs84 <- spTransform(points, target_crs)

# Replace X and Y values with latitude and longitude points in the dataset
richmond_trees$geo_x <- coordinates(points_wgs84)[, 1]
richmond_trees$geo_y <- coordinates(points_wgs84)[, 2]

richmond_trees_clean <- richmond_trees %>% 
  #filter(species != "Stump" & height != "") %>% 
  dplyr::rename(long = geo_x,
                lat = geo_y,
                species_botanical_name = species) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city,year)) %>%
  filter(dbh > 0) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  filter(!grepl("^unknown|^vacant|^stump", species_botanical_name, ignore.case = TRUE)) %>%
  mutate(species_botanical_name = gsub("species$|sp$|sp.$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

richmond_trees_clean$dbh <- richmond_trees_clean$dbh * 2.54 ##converting from inches to cm

richmond_trees_clean$species_botanical_name[richmond_trees_clean$species_botanical_name == ""] <- NA

richmond_trees_clean <- richmond_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, " cupressocyparis leylandii") ~ "cupressocyparis leylandii",
   str_detect(species_botanical_name, "^acer tataricum ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^bamboo spp.") ~ "bambusa spp.",
   str_detect(species_botanical_name, "^cactus spp.") ~ "cactaceae spp.",
   str_detect(species_botanical_name, "^cornus $") ~ "cornus spp.",
   str_detect(species_botanical_name, "^crataegus crusgalli") ~ "crataegus crus-galli",
   str_detect(species_botanical_name, "^euonymus alata") ~ "euonymus alatus",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^grass spp.") ~ "poaceae spp.",
   str_detect(species_botanical_name, "^ilex $") ~ "ilex spp.",
   str_detect(species_botanical_name, "^ligustrum sinensis") ~ "ligustrum sinense",
   str_detect(species_botanical_name, "^magnolia $") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^olea europea") ~ "olea europaea",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^quercus $") ~ "quercus spp.",
   str_detect(species_botanical_name, "^quercus nuttalli") ~ "quercus nuttallii",
   str_detect(species_botanical_name, "^salix $") ~ "salix spp.",
   str_detect(species_botanical_name, "^tillia euchlora") ~ "tilia euchlora",
   str_detect(species_botanical_name, "^tsuga candensis") ~ "tsuga canadensis",
   str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
   
   TRUE ~ species_botanical_name
  ))


richmond_trees_clean <- left_join(richmond_trees_clean, spp_code, by = "species_botanical_name")

richmond_trees_clean <- richmond_trees_clean %>%  
  filter(!is.na(species_botanical_name)) %>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))


richmond_trees_clean<-richmond_trees_clean[, c(5:8,2,1,4,9,3)]


#write.csv(richmond_trees_clean, "~/Dropbox/Urban_data/Cleaned/richmond_trees_clean.csv", row.names = FALSE)


```

#San Fran

Data downloaded from: https://bsm.sfdpw.org/urbanforestry/
```{r}

#Clean
sf_trees<- read.csv("~/Dropbox/Urban_data/Raw/sanfrancisco_ca_usa.csv")

sf_trees$country <- "usa"
sf_trees$state <- "california"
sf_trees$city <- "san francisco"
sf_trees$year <- "2023" #last updated in 2023

sf_trees_clean <- sf_trees %>% 
  #filter(DBH != "0" & DBH != "" & Latitude != "") %>% 
  dplyr::rename(long = Longitude,
                lat = Latitude,
                dbh = DBH, # in inches
                species_botanical_name = qSpecies) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("species$|sp$|spp", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) %>% 
filter(!grepl("^unknown|^vacant|^shrub|^potential|^private|^:: tree$| determine$|^tree\\(s\\)", species_botanical_name, ignore.case = TRUE))

sf_trees_clean$species_botanical_name <- sub(" ::.*", "", sf_trees_clean$species_botanical_name) #keeping botanical name and removing common name

sf_trees_clean$dbh <- sf_trees_clean$dbh * 2.54 ##converting from inches to cm



sf_trees_clean <- sf_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^abelia grandiflora") ~ "linnaea grandiflora",
   str_detect(species_botanical_name, "^acacia$") ~ "acacia spp.",
   str_detect(species_botanical_name, "^albizia$") ~ "albizia spp.",
   
   str_detect(species_botanical_name, "^acacia baileyana") ~ "acacia baileyana",
   str_detect(species_botanical_name, "^acer buergeranium") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer buergeranum") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer campestre") ~ "acer campestre",
   str_detect(species_botanical_name, "^acer fremanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer grandidentatum") ~ "acer grandidentatum",
   str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
   str_detect(species_botanical_name, "^aesculus$") ~ "aesculus spp.",
   str_detect(species_botanical_name, "^aesculus × carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^alnus$") ~ "alnus spp.",
   str_detect(species_botanical_name, "^arbor vitae$") ~ "thuja spp.",
   str_detect(species_botanical_name, "^arbutus ‘marina’") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^arbutus marina") ~ "arbutus unedo",
   
   str_detect(species_botanical_name, "^baccharis$") ~ "baccharis spp.",
   str_detect(species_botanical_name, "^bambusa$") ~ "bambusa spp.",
   str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
   str_detect(species_botanical_name, "^brachea edulis") ~ "brahea edulis",
   str_detect(species_botanical_name, "^buxus$") ~ "buxus spp.",
   str_detect(species_botanical_name, "^bougainvillea$") ~ "bougainvillea spp.",
   
   str_detect(species_botanical_name, "^casurina stricta") ~ "allocasuarina verticillata",
   str_detect(species_botanical_name, "^ceanothus$") ~ "ceanothus spp.",
   str_detect(species_botanical_name, "^cedrus$") ~ "cedrus spp.",
   str_detect(species_botanical_name, "^cedrus atlantica") ~ "cedrus atlantica",
   str_detect(species_botanical_name, "^cedrus deodora") ~ "cedrus deodara",
   str_detect(species_botanical_name, "^celtis$") ~ "celtis spp.",
   str_detect(species_botanical_name, "^celtis chinensis") ~ "celtis sinensis",
   str_detect(species_botanical_name, "^cercis$") ~ "cercis spp.",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^cercis reniformis") ~ "cercis reniformis",
   str_detect(species_botanical_name, "^chamaecyparis$") ~ "chamaecyparis spp.",
   str_detect(species_botanical_name, "^chitalpa tashkentensis") ~ "chitalpa tashkentensis",
   str_detect(species_botanical_name, "^chorisia speciosa") ~ "ceiba speciosa", #formerly known as chorisia
   str_detect(species_botanical_name, "^citrus$") ~ "citrus spp.",
   str_detect(species_botanical_name, "^crataegus laevigata") ~ "crataegus laevigata",
   str_detect(species_botanical_name, "^crateagus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^crataegus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crateagus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crataegus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^cycad$") ~ "cycas spp.",
   
   str_detect(species_botanical_name, "^elaeagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eleagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eriobotrya$") ~ "eriobotrya spp.",
   str_detect(species_botanical_name, "^erythrina$") ~ "erythrina spp.",
   str_detect(species_botanical_name, "^escallonia$") ~ "escallonia spp.",
   str_detect(species_botanical_name, "^escallonia exoniensis") ~ "escallonia exoniensis",
   
   str_detect(species_botanical_name, "^eucalyptus$") ~ "eucalyptus spp.",
   str_detect(species_botanical_name, "^eucalyptus citriodora") ~ "corymbia citriodora", #name switch
   str_detect(species_botanical_name, "^eucalyptus ficifolia") ~ "corymbia ficifolia", #name switch
   str_detect(species_botanical_name, "^eucalyptus parvifolia") ~ "eucalyptus parvula", #name switch
   str_detect(species_botanical_name, "^feijoa sellowiana") ~ "acca sellowiana", #name switch
   str_detect(species_botanical_name, "^ficus$") ~ "ficus spp.", #name switch
   str_detect(species_botanical_name, "^ficus nitida") ~ "ficus microcarpa", #name switch
   str_detect(species_botanical_name, "^fraxinus$") ~ "fraxinus spp.",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^fraxinus angustifolia") ~ "fraxinus angustifolia",
   str_detect(species_botanical_name, "^fraxinus moraine") ~ "fraxinus holotricha",
   str_detect(species_botanical_name, "^fraxinus uhdei") ~ "fraxinus uhdei",
   str_detect(species_botanical_name, "^fraxinus veluntina") ~ "fraxinus velutina",
   str_detect(species_botanical_name, "^fraxinus velutina") ~ "fraxinus velutina",
   
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditisia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^heliconia$") ~ "heliconia spp.",
   str_detect(species_botanical_name, "^hesperocyparis$") ~ "hesperocyparis spp.",
   str_detect(species_botanical_name, "^hibiscus$") ~ "hibiscus spp.",
   str_detect(species_botanical_name, "^ilex$") ~ "ilex spp.",
   str_detect(species_botanical_name, "^ilex aquifolium") ~ "ilex aquifolium",
   str_detect(species_botanical_name, "^juglans$") ~ "juglans spp.",
   str_detect(species_botanical_name, "^juniperus$") ~ "juniperus spp.",
   str_detect(species_botanical_name, "^lagerstroemia$") ~ "lagerstroemia spp.",
   str_detect(species_botanical_name, "^lagerstroemia indica biloxi$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica natchez$") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica faurei") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica muskogee$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica tuscarora$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica fauriei") ~ "lagerstroemia indica x fauriei",
   
   
   str_detect(species_botanical_name, "^laurus nobilis") ~ "laurus nobilis",
   str_detect(species_botanical_name, "^leptospermum$") ~ "leptospermum spp.",
   str_detect(species_botanical_name, "^ligustrum$") ~ "ligustrum spp.",
   str_detect(species_botanical_name, "^ligustrum japonicum") ~ "ligustrum japonicum",
   str_detect(species_botanical_name, "^liquidambar$") ~ "liquidambar spp.",
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^lycianthus rantonnetii") ~ "lycianthes rantonnetii",
   
   str_detect(species_botanical_name, "^magnolia$") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^malus$") ~ "malus spp.",
   str_detect(species_botanical_name, "^maytenus boaria") ~ "maytenus boaria",
   str_detect(species_botanical_name, "^melaleuca$") ~ "melaleuca spp.",
   str_detect(species_botanical_name, "^melia azerdarach") ~ "melia azedarach",
   str_detect(species_botanical_name, "^metrosideros excelsus") ~ "metrosideros excelsa",
   
   str_detect(species_botanical_name, "^michelia champaca") ~ "magnolia champaca", #name change
   str_detect(species_botanical_name, "^michelia doltsopa") ~ "magnolia doltsopa",#name change
   str_detect(species_botanical_name, "^morus$") ~ "morus spp.",#name change
   str_detect(species_botanical_name, "^murraya exotica") ~ "murraya paniculata",#name change
   str_detect(species_botanical_name, "^musashino sawleaf zelkova") ~ "zelkova serrata",#name change
   str_detect(species_botanical_name, "^myoporum laevigatum") ~ "myoporum laetum",#name change
   str_detect(species_botanical_name, "^musa$") ~ "musa spp.",#name change
   
   str_detect(species_botanical_name, "^nandina$") ~ "nandina spp.",#name change
   
   
   str_detect(species_botanical_name, "^phormium$") ~ "phormium spp.",
   str_detect(species_botanical_name, "^picea$") ~ "picea spp.",
   str_detect(species_botanical_name, "^picea glauca") ~ "picea glauca",
   str_detect(species_botanical_name, "^pinus$") ~ "pinus spp.",
   str_detect(species_botanical_name, "^pinus pinea") ~ "pinus pinea",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^pistacia chinensis") ~ "pistacia chinensis",
   
   str_detect(species_botanical_name, "^pittosporum$") ~ "pittosporum spp.",
   str_detect(species_botanical_name, "^pittosporum tawhiwhi") ~ "pittosporum tenuifolium",
   str_detect(species_botanical_name, "^pittosporum rhombifolium") ~ "pittosporum rhombifolia ",
   
   
   str_detect(species_botanical_name, "^platanus × acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hispanica") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^podocarpus gracilior") ~ "afrocarpus gracilior",#name change
   str_detect(species_botanical_name, "^populus$") ~ "populus spp.",
   str_detect(species_botanical_name, "^prunus$") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus amygdalus") ~ "prunus dulcis",
   str_detect(species_botanical_name, "^prunus armenica") ~ "prunus armeniaca",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus ilicifoia") ~ "prunus ilicifolia",
   str_detect(species_botanical_name, "^prunus martimia") ~ "prunus maritima",
   
   
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus spp.") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^psidium$") ~ "psidium spp.",
   str_detect(species_botanical_name, "^pyracantha$") ~ "pyracantha spp.",
   str_detect(species_botanical_name, "^pyrus$") ~ "pyrus spp.",
   str_detect(species_botanical_name, "^quercus$") ~ "quercus spp.",
   str_detect(species_botanical_name, "^quercus frainetto") ~ "quercus frainetto",
   
   str_detect(species_botanical_name, "^rhaphiolepis majestic beauty") ~ "rhaphiolepis indica",
   str_detect(species_botanical_name, "^rhus copallina") ~ "rhus copallinum",
   str_detect(species_botanical_name, "^robinia$") ~ "robinia spp.",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   str_detect(species_botanical_name, "^robinia idahoensis") ~ "robinia ambigua idahoensis",
   str_detect(species_botanical_name, "^robinia ambiqua purple") ~ "robinia pseudoacacia x ambigua",
   str_detect(species_botanical_name, "^rosa$") ~ "rosa spp.",
   
   str_detect(species_botanical_name, "^saponara quillaja") ~ "saponaria quillaja",
   str_detect(species_botanical_name, "^salix$") ~ "salix spp.",
   str_detect(species_botanical_name, "^schinus terbinthefolius") ~ "schinus terebinthifolius",
   str_detect(species_botanical_name, "^solanum rantonnetii") ~ "lycianthes rantonnetii",
   str_detect(species_botanical_name, "^sorbus$") ~ "sorbus spp.",
   str_detect(species_botanical_name, "^syagrus romanzoffianum") ~ "syagrus romanzoffiana",
   str_detect(species_botanical_name, "^syringa$") ~ "syringa spp.",
   str_detect(species_botanical_name, "^syzgium australe") ~ "syzygium australe",
   str_detect(species_botanical_name, "^taxus baccata") ~ "taxus baccata",
   str_detect(species_botanical_name, "^thuga orientalis") ~ "platycladus orientalis",#name change
   str_detect(species_botanical_name, "^thuja lawsoniana") ~ "chamaecyparis lawsoniana",
   str_detect(species_botanical_name, "^thuja occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^tilia tomentosa") ~ "tilia tomentosa",
   str_detect(species_botanical_name, "^trachylospermum jasminoides") ~ "trachelospermum jasminoides",
   str_detect(species_botanical_name, "^tristania conferta") ~ "lophostemon confertus", #name change
   str_detect(species_botanical_name, "^ulmus$") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus ‘frontier’") ~ "ulmus carpinifolia x parvifolia", 
   str_detect(species_botanical_name, "^ulmus japonica wilsoniana") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus parviflora") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus propinqua") ~ "ulmus propinqua",
   str_detect(species_botanical_name, "^ulmus wilsoniana prospector") ~ "ulmus wilsoniana",
   str_detect(species_botanical_name, "^washingtonia romanzoffiana") ~ "syagrus romanzoffiana",
   
   str_detect(species_botanical_name, "^wisteria$") ~ "wisteria spp.",
   str_detect(species_botanical_name, "^yucca$") ~ "yucca spp.",
   str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
   
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer nigra") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tatarian") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer truncatum acer") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^acer truncatum platanoides") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier arborea") ~ "amelanchier arborea",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
   str_detect(species_botanical_name, "^chamaecyparis nootkatensis") ~ "chamaecyparis nootkatensis",
   str_detect(species_botanical_name, "^elm$") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^gingko biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^ginkgo biloba autumn gold") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditsia tricanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^malus apple") ~ "malus spp.",
   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^platanus acerfolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hybrida") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus nigra") ~ "populus nigra",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^rhamnus frangula") ~ "frangula alnus",
   str_detect(species_botanical_name, "^rhus hirta") ~ "rhus typhina",
   str_detect(species_botanical_name, "^salix spp. weeping") ~ "salix babylonica",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus accolade") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus pioneer") ~ "ulmus hollandica",
  
   str_detect(species_botanical_name, "^abelia grandiflora") ~ "linnaea grandiflora",
   str_detect(species_botanical_name, "^acacia$") ~ "acacia spp.",
   str_detect(species_botanical_name, "^albizia$") ~ "albizia spp.",
   
   str_detect(species_botanical_name, "^acacia baileyana") ~ "acacia baileyana",
   str_detect(species_botanical_name, "^acer buergeranium") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer buergeranum") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer campestre") ~ "acer campestre",
   str_detect(species_botanical_name, "^acer fremanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer grandidentatum") ~ "acer grandidentatum",
   str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
   str_detect(species_botanical_name, "^aesculus$") ~ "aesculus spp.",
   str_detect(species_botanical_name, "^aesculus × carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^alnus$") ~ "alnus spp.",
   str_detect(species_botanical_name, "^arbor vitae$") ~ "thuja spp.",
   str_detect(species_botanical_name, "^arbutus ‘marina’") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^arbutus marina") ~ "arbutus unedo",
   
   str_detect(species_botanical_name, "^baccharis$") ~ "baccharis spp.",
   str_detect(species_botanical_name, "^bambusa$") ~ "bambusa spp.",
   str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
   str_detect(species_botanical_name, "^brachea edulis") ~ "brahea edulis",
   str_detect(species_botanical_name, "^buxus$") ~ "buxus spp.",
   str_detect(species_botanical_name, "^bougainvillea$") ~ "bougainvillea spp.",
   
   str_detect(species_botanical_name, "^casurina stricta") ~ "allocasuarina verticillata",
   str_detect(species_botanical_name, "^ceanothus$") ~ "ceanothus spp.",
   str_detect(species_botanical_name, "^cedrus$") ~ "cedrus spp.",
   str_detect(species_botanical_name, "^cedrus atlantica") ~ "cedrus atlantica",
   str_detect(species_botanical_name, "^cedrus deodora") ~ "cedrus deodara",
   str_detect(species_botanical_name, "^celtis$") ~ "celtis spp.",
   str_detect(species_botanical_name, "^celtis chinensis") ~ "celtis sinensis",
   str_detect(species_botanical_name, "^cercis$") ~ "cercis spp.",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^cercis reniformis") ~ "cercis reniformis",
   str_detect(species_botanical_name, "^chamaecyparis$") ~ "chamaecyparis spp.",
   str_detect(species_botanical_name, "^chitalpa tashkentensis") ~ "chitalpa tashkentensis",
   str_detect(species_botanical_name, "^chorisia speciosa") ~ "ceiba speciosa", #formerly known as chorisia
   str_detect(species_botanical_name, "^citrus$") ~ "citrus spp.",
   str_detect(species_botanical_name, "^crataegus laevigata") ~ "crataegus laevigata",
   str_detect(species_botanical_name, "^crateagus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^crataegus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crateagus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crataegus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^cycad$") ~ "cycas spp.",
   
   str_detect(species_botanical_name, "^elaeagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eleagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eriobotrya$") ~ "eriobotrya spp.",
   str_detect(species_botanical_name, "^erythrina$") ~ "erythrina spp.",
   str_detect(species_botanical_name, "^escallonia$") ~ "escallonia spp.",
   str_detect(species_botanical_name, "^escallonia exoniensis") ~ "escallonia exoniensis",
   
   str_detect(species_botanical_name, "^eucalyptus$") ~ "eucalyptus spp.",
   str_detect(species_botanical_name, "^eucalyptus citriodora") ~ "corymbia citriodora", #name switch
   str_detect(species_botanical_name, "^eucalyptus ficifolia") ~ "corymbia ficifolia", #name switch
   str_detect(species_botanical_name, "^eucalyptus parvifolia") ~ "eucalyptus parvula", #name switch
   str_detect(species_botanical_name, "^feijoa sellowiana") ~ "acca sellowiana", #name switch
   str_detect(species_botanical_name, "^ficus$") ~ "ficus spp.", #name switch
   str_detect(species_botanical_name, "^ficus nitida") ~ "ficus microcarpa", #name switch
   str_detect(species_botanical_name, "^fraxinus$") ~ "fraxinus spp.",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^fraxinus angustifolia") ~ "fraxinus angustifolia",
   str_detect(species_botanical_name, "^fraxinus moraine") ~ "fraxinus holotricha",
   str_detect(species_botanical_name, "^fraxinus uhdei") ~ "fraxinus uhdei",
   str_detect(species_botanical_name, "^fraxinus veluntina") ~ "fraxinus velutina",
   str_detect(species_botanical_name, "^fraxinus velutina") ~ "fraxinus velutina",
   
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditisia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^heliconia$") ~ "heliconia spp.",
   str_detect(species_botanical_name, "^hesperocyparis$") ~ "hesperocyparis spp.",
   str_detect(species_botanical_name, "^hibiscus$") ~ "hibiscus spp.",
   str_detect(species_botanical_name, "^ilex$") ~ "ilex spp.",
   str_detect(species_botanical_name, "^ilex aquifolium") ~ "ilex aquifolium",
   str_detect(species_botanical_name, "^juglans$") ~ "juglans spp.",
   str_detect(species_botanical_name, "^juniperus$") ~ "juniperus spp.",
   str_detect(species_botanical_name, "^lagerstroemia$") ~ "lagerstroemia spp.",
   str_detect(species_botanical_name, "^lagerstroemia indica biloxi$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica natchez$") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica faurei") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica muskogee$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica tuscarora$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica fauriei") ~ "lagerstroemia indica x fauriei",
   
   
   str_detect(species_botanical_name, "^laurus nobilis") ~ "laurus nobilis",
   str_detect(species_botanical_name, "^leptospermum$") ~ "leptospermum spp.",
   str_detect(species_botanical_name, "^ligustrum$") ~ "ligustrum spp.",
   str_detect(species_botanical_name, "^ligustrum japonicum") ~ "ligustrum japonicum",
   str_detect(species_botanical_name, "^liquidambar$") ~ "liquidambar spp.",
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^lycianthus rantonnetii") ~ "lycianthes rantonnetii",
   
   str_detect(species_botanical_name, "^magnolia$") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^malus$") ~ "malus spp.",
   str_detect(species_botanical_name, "^maytenus boaria") ~ "maytenus boaria",
   str_detect(species_botanical_name, "^melaleuca$") ~ "melaleuca spp.",
   str_detect(species_botanical_name, "^melia azerdarach") ~ "melia azedarach",
   str_detect(species_botanical_name, "^metrosideros excelsus") ~ "metrosideros excelsa",
   
   str_detect(species_botanical_name, "^michelia champaca") ~ "magnolia champaca", #name change
   str_detect(species_botanical_name, "^michelia doltsopa") ~ "magnolia doltsopa",#name change
   str_detect(species_botanical_name, "^morus$") ~ "morus spp.",#name change
   str_detect(species_botanical_name, "^murraya exotica") ~ "murraya paniculata",#name change
   str_detect(species_botanical_name, "^musashino sawleaf zelkova") ~ "zelkova serrata",#name change
   str_detect(species_botanical_name, "^myoporum laevigatum") ~ "myoporum laetum",#name change
   str_detect(species_botanical_name, "^musa$") ~ "musa spp.",#name change
   
   str_detect(species_botanical_name, "^nandina$") ~ "nandina spp.",#name change
   
   
   str_detect(species_botanical_name, "^phormium$") ~ "phormium spp.",
   str_detect(species_botanical_name, "^picea$") ~ "picea spp.",
   str_detect(species_botanical_name, "^picea glauca") ~ "picea glauca",
   str_detect(species_botanical_name, "^pinus$") ~ "pinus spp.",
   str_detect(species_botanical_name, "^pinus pinea") ~ "pinus pinea",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^pistacia chinensis") ~ "pistacia chinensis",
   
   str_detect(species_botanical_name, "^pittosporum$") ~ "pittosporum spp.",
   str_detect(species_botanical_name, "^pittosporum tawhiwhi") ~ "pittosporum tenuifolium",
   str_detect(species_botanical_name, "^pittosporum rhombifolium") ~ "pittosporum rhombifolia ",
   
   
   str_detect(species_botanical_name, "^platanus × acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hispanica") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^podocarpus gracilior") ~ "afrocarpus gracilior",#name change
   str_detect(species_botanical_name, "^populus$") ~ "populus spp.",
   str_detect(species_botanical_name, "^prunus$") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus amygdalus") ~ "prunus dulcis",
   str_detect(species_botanical_name, "^prunus armenica") ~ "prunus armeniaca",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus ilicifoia") ~ "prunus ilicifolia",
   str_detect(species_botanical_name, "^prunus martimia") ~ "prunus maritima",
   
   
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus spp.") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^psidium$") ~ "psidium spp.",
   str_detect(species_botanical_name, "^pyracantha$") ~ "pyracantha spp.",
   str_detect(species_botanical_name, "^pyrus$") ~ "pyrus spp.",
   str_detect(species_botanical_name, "^quercus$") ~ "quercus spp.",
   str_detect(species_botanical_name, "^quercus frainetto") ~ "quercus frainetto",
   
   str_detect(species_botanical_name, "^rhaphiolepis majestic beauty") ~ "rhaphiolepis indica",
   str_detect(species_botanical_name, "^rhus copallina") ~ "rhus copallinum",
   str_detect(species_botanical_name, "^robinia$") ~ "robinia spp.",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   str_detect(species_botanical_name, "^robinia idahoensis") ~ "robinia ambigua idahoensis",
   str_detect(species_botanical_name, "^robinia ambiqua purple") ~ "robinia pseudoacacia x ambigua",
   str_detect(species_botanical_name, "^rosa$") ~ "rosa spp.",
   
   str_detect(species_botanical_name, "^saponara quillaja") ~ "saponaria quillaja",
   str_detect(species_botanical_name, "^salix$") ~ "salix spp.",
   str_detect(species_botanical_name, "^schinus terbinthefolius") ~ "schinus terebinthifolius",
   str_detect(species_botanical_name, "^solanum rantonnetii") ~ "lycianthes rantonnetii",
   str_detect(species_botanical_name, "^sorbus$") ~ "sorbus spp.",
   str_detect(species_botanical_name, "^syagrus romanzoffianum") ~ "syagrus romanzoffiana",
   str_detect(species_botanical_name, "^syringa$") ~ "syringa spp.",
   str_detect(species_botanical_name, "^syzgium australe") ~ "syzygium australe",
   str_detect(species_botanical_name, "^taxus baccata") ~ "taxus baccata",
   str_detect(species_botanical_name, "^thuga orientalis") ~ "platycladus orientalis",#name change
   str_detect(species_botanical_name, "^thuja lawsoniana") ~ "chamaecyparis lawsoniana",
   str_detect(species_botanical_name, "^thuja occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^tilia tomentosa") ~ "tilia tomentosa",
   str_detect(species_botanical_name, "^trachylospermum jasminoides") ~ "trachelospermum jasminoides",
   str_detect(species_botanical_name, "^tristania conferta") ~ "lophostemon confertus", #name change
   str_detect(species_botanical_name, "^ulmus$") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus ‘frontier’") ~ "ulmus carpinifolia x parvifolia", 
   str_detect(species_botanical_name, "^ulmus japonica wilsoniana") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus parviflora") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus propinqua") ~ "ulmus propinqua",
   str_detect(species_botanical_name, "^ulmus wilsoniana prospector") ~ "ulmus wilsoniana",
   str_detect(species_botanical_name, "^washingtonia romanzoffiana") ~ "syagrus romanzoffiana",
   
   str_detect(species_botanical_name, "^wisteria$") ~ "wisteria spp.",
   str_detect(species_botanical_name, "^yucca$") ~ "yucca spp.",
   str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
   
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer nigra") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tatarian") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer truncatum acer") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^acer truncatum platanoides") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier arborea") ~ "amelanchier arborea",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
   str_detect(species_botanical_name, "^chamaecyparis nootkatensis") ~ "chamaecyparis nootkatensis",
   str_detect(species_botanical_name, "^elm$") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^gingko biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^ginkgo biloba autumn gold") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditsia tricanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^malus apple") ~ "malus spp.",
   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^platanus acerfolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hybrida") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus nigra") ~ "populus nigra",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^rhamnus frangula") ~ "frangula alnus",
   str_detect(species_botanical_name, "^rhus hirta") ~ "rhus typhina",
   str_detect(species_botanical_name, "^salix spp. weeping") ~ "salix babylonica",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus accolade") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus carpinifolia frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus pioneer") ~ "ulmus hollandica",

   str_detect(species_botanical_name, "^ chiranthofremontia lenzii") ~ "chiranthofremontia lenzii",
   str_detect(species_botanical_name, "^acer autumn blaze") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer ginnela") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer palmatum") ~ "acer palmatum",
   str_detect(species_botanical_name, "^aesculus carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^agonis flexuosa") ~ "agonis flexuosa",
   str_detect(species_botanical_name, "^albizia distachya") ~ "paraserianthes lophantha", #name change, synonym
   str_detect(species_botanical_name, "^angohpora spp.") ~ "angophora spp.",
   str_detect(species_botanical_name, "^arbutus unedo") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^arecastrum romanzoffianum") ~ "syagrus romanzoffiana", #name change, synonym
   str_detect(species_botanical_name, "^arctostaphylos manzanita") ~ "arctostaphylos manzanita",
   
   str_detect(species_botanical_name, "^brahea aramata") ~ "brahea armata", 
   str_detect(species_botanical_name, "^cassia excelsa") ~ "senna spectabilis", 
   str_detect(species_botanical_name, "^caryota maxima") ~ "caryota maxima", 
   str_detect(species_botanical_name, "^ceanothus sps") ~ "ceanothus spp.", 
   str_detect(species_botanical_name, "^chamaecyparis species") ~ "chamaecyparis spp.", 
   str_detect(species_botanical_name, "^chionanthus retusa") ~ "chionanthus retusus", 
   str_detect(species_botanical_name, "^citrus × limon") ~ "citrus limon", 
   str_detect(species_botanical_name, "^citrus × meyeri") ~ "citrus meyeri", 
   str_detect(species_botanical_name, "^cornus nuttallii florida") ~ "cornus nuttallii x florida", 
   str_detect(species_botanical_name, "^cotinus coggygria") ~ "cotinus coggygria", 
   str_detect(species_botanical_name, "^crateagus spp.") ~ "crataegus spp.", 
   str_detect(species_botanical_name, "^ceanothus ray hartman") ~ "ceanothus arboreus x griseus", 
   str_detect(species_botanical_name, "^citrus aurantifolia") ~ "citrus aurantifolia", 
   str_detect(species_botanical_name, "^corynocarpus laevigata") ~ "corynocarpus laevigatus", 
   str_detect(species_botanical_name, "^dodonaea viscosa") ~ "dodonaea viscosa", 
   
   str_detect(species_botanical_name, "^eriobotrya deflexa") ~ "eriobotrya deflexa", 
   str_detect(species_botanical_name, "^eucalyptus lehmanni") ~ "eucalyptus lehmannii", 
   str_detect(species_botanical_name, "^eucalyptus leucoxylon") ~ "eucalyptus leucoxylon", 
   str_detect(species_botanical_name, "^eucalyptus macarthuri") ~ "eucalyptus macarthurii", 
   str_detect(species_botanical_name, "^eucalyptus simmondsi") ~ "eucalyptus globulus", 
   str_detect(species_botanical_name, "^fagus sylvatica") ~ "fagus sylvatica", 
   str_detect(species_botanical_name, "^ficus carica") ~ "ficus carica", 
   str_detect(species_botanical_name, "^ficus laurel") ~ "ficus microcarpa", #name change
   str_detect(species_botanical_name, "^ficus microcarpa") ~ "ficus microcarpa",
   str_detect(species_botanical_name, "^ficus spp.") ~ "ficus spp.",
   str_detect(species_botanical_name, "^fraxinus oxycarpa") ~ "fraxinus oxycarpa",
   str_detect(species_botanical_name, "^ficus retusa") ~ "ficus retusa",
   
   str_detect(species_botanical_name, "^garrya elliptica") ~ "garrya elliptica",
   str_detect(species_botanical_name, "^grevillea red hooks") ~ "grevillea hookeriana",
   
   
   str_detect(species_botanical_name, "^ilex altaclarensis") ~ "ilex altaclerensis",
   str_detect(species_botanical_name, "^juniperus scopulorum") ~ "juniperus scopulorum",
   
   str_detect(species_botanical_name, "^lagerstroemia tuscarora") ~ "lagerstroemia indica", #name change
   str_detect(species_botanical_name, "^leptospermum scoparium") ~ "leptospermum scoparium", #name change
   str_detect(species_botanical_name, "^leucadendron gold strike") ~ "leucadendron strobolinum x laureolum",
   str_detect(species_botanical_name, "^leucodendron argenteum") ~ "leucadendron argenteum",
   str_detect(species_botanical_name, "^lyonothamnus floribundus subsp. asplenifolius") ~ "lyonothamnus floribundus ssp. aspleniifolius",
   
   
   str_detect(species_botanical_name, "^magnolia doltsopa") ~ "magnolia doltsopa",
   str_detect(species_botanical_name, "^magnolia sargentiana") ~ "magnolia sargentiana",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangiana",
   
   str_detect(species_botanical_name, "^malus gala") ~ "malus domestica",
   str_detect(species_botanical_name, "^malus floribunda") ~ "malus floribunda",
   
   str_detect(species_botanical_name, "^melaleuca styphelliodes") ~ "melaleuca styphelioides",
   str_detect(species_botanical_name, "^metasequoia glyplostroboides") ~ "metasequoia glyptostroboides",
   str_detect(species_botanical_name, "^metrosideros excelsa") ~ "metrosideros excelsa",
   str_detect(species_botanical_name, "^morus alba") ~ "morus alba",
   str_detect(species_botanical_name, "^olea europaea") ~ "olea europaea",
   str_detect(species_botanical_name, "^olea majestic beauty") ~ "olea europaea",
   
   str_detect(species_botanical_name, "^podocarpus gracilor") ~ "afrocarpus gracilior",
   str_detect(species_botanical_name, "^privet$") ~ "ligustrum spp.",
   str_detect(species_botanical_name, "^prunus amanogawa") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus domestica") ~ "prunus domestica",
   str_detect(species_botanical_name, "^prunus persica") ~ "prunus persica",
   str_detect(species_botanical_name, "^prunus sargentii") ~ "prunus sargentii",
   str_detect(species_botanical_name, "^prunus subhirtella") ~ "prunus subhirtella",
   str_detect(species_botanical_name, "^pyracantha santa cruz") ~ "pyracantha koidzumii",
   str_detect(species_botanical_name, "^quercus wislizenii") ~ "quercus wislizeni",
   str_detect(species_botanical_name, "^robinia ambigua") ~ "robinia ambigua idahoensis",
   str_detect(species_botanical_name, "^salix matsudana") ~ "salix matsudana",
   str_detect(species_botanical_name, "^sambucus species") ~ "sambucus spp.",
   str_detect(species_botanical_name, "^schefflera species") ~ "schefflera spp.",
   str_detect(species_botanical_name, "^solanum rantonnetti") ~ "lycianthes rantonnetii",
   str_detect(species_botanical_name, "^tibochina urvilleana") ~ "tibouchina urvilleana",
   str_detect(species_botanical_name, "^ulmus parvifolia") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus prospector") ~ "ulmus davidiana var. japonica",
   str_detect(species_botanical_name, "^viburnum odoratissimum") ~ "viburnum odoratissimum",
   str_detect(species_botanical_name, "^tristaniopsis laurina") ~ "tristaniopsis laurina",
   str_detect(species_botanical_name, "^punica granatum") ~ "punica granatum",
   
   str_detect(species_botanical_name, "^palm \\(unknown genus") ~ "arecaceae spp.",
   str_detect(species_botanical_name, "^patanus racemosa") ~ "platanus racemosa",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
   
   TRUE ~ species_botanical_name
  ))


sf_trees_clean$dbh[sf_trees_clean$dbh == ""] <- NA

sf_trees_clean <- left_join(sf_trees_clean, spp_code, by = "species_botanical_name")

sf_trees_clean <- sf_trees_clean %>% 
  filter(dbh > 0 )%>% 
  filter(!is.na(species_botanical_name))%>%
  filter(!is.na(long)) %>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))

sf_trees_clean<-sf_trees_clean[, c(5:8,2,1,4,9,3)]


#write.csv(sf_trees_clean, "~/Dropbox/Urban_data/Cleaned/sf_trees_clean.csv", row.names = FALSE)


```


#San Jose

Data downloaded from: https://gisdata-csj.opendata.arcgis.com/datasets/7db16e012fe8402db45074cd260c8f4e_510
  Projected on State Plane Coordinate System CA Zone III feet (WKID 2227)

```{r}

#Clean
sanjose_trees<- read.csv("~/Dropbox/Urban_data/Raw/sanjose_ca_usa.csv")

sanjose_trees$country <- "usa"
sanjose_trees$state <- "california"
sanjose_trees$city <- "san jose"
sanjose_trees$year <- "2021" #last updated Feb 8, 2021

# Exclude rows with NA values in x or y columns
sanjose_trees <- sanjose_trees[complete.cases(sanjose_trees$X, sanjose_trees$Y), ]

# Convert x and y columns to numeric
sanjose_trees$X <- as.numeric(as.character(sanjose_trees$X))
sanjose_trees$Y <- as.numeric(as.character(sanjose_trees$Y))

# Define the coordinate reference system (CRS)
crs <- CRS("+init=EPSG:2227")

# Create the SpatialPointsDataFrame
points <- SpatialPointsDataFrame(coords = sanjose_trees[, c("X", "Y")],
                                 data = sanjose_trees,
                                 proj4string = crs)

# Define the target CRS
target_crs <- CRS("+init=EPSG:4326")

# Transform the points to latitude and longitude
points_wgs84 <- spTransform(points, target_crs)

# Replace X and Y values with latitude and longitude points in the dataset
sanjose_trees$X <- coordinates(points_wgs84)[, 1]
sanjose_trees$Y <- coordinates(points_wgs84)[, 2]

sj_trees_clean <- sanjose_trees %>% 
  dplyr::rename(long = X,
                lat = Y,
                dbh = TRUNKDIAM, #in inches
                species_botanical_name = NAMESCIENTIFIC) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>% 
  filter(dbh > 0) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  filter(!grepl("^stump|^vacant|^unknown", species_botanical_name, ignore.case = TRUE)) %>% 
  mutate(species_botanical_name = gsub("species$|sp$|spp", "spp.", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name)) 

sj_trees_clean$dbh <- sj_trees_clean$dbh * 2.54 ##converting from inches to cm

sj_trees_clean$species_botanical_name[sj_trees_clean$species_botanical_name == ""] <- NA


sj_trees_clean <- sj_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^abelia grandiflora") ~ "linnaea grandiflora",
   str_detect(species_botanical_name, "^acacia$") ~ "acacia spp.",
   str_detect(species_botanical_name, "^albizia$") ~ "albizia spp.",
   
   str_detect(species_botanical_name, "^acacia baileyana") ~ "acacia baileyana",
   str_detect(species_botanical_name, "^acer buergeranium") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer buergeranum") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer campestre") ~ "acer campestre",
   str_detect(species_botanical_name, "^acer fremanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer grandidentatum") ~ "acer grandidentatum",
   str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
   str_detect(species_botanical_name, "^aesculus$") ~ "aesculus spp.",
   str_detect(species_botanical_name, "^aesculus × carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^alnus$") ~ "alnus spp.",
   str_detect(species_botanical_name, "^arbor vitae$") ~ "thuja spp.",
   str_detect(species_botanical_name, "^arbutus ‘marina’") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^arbutus marina") ~ "arbutus unedo",
   
   str_detect(species_botanical_name, "^baccharis$") ~ "baccharis spp.",
   str_detect(species_botanical_name, "^bambusa$") ~ "bambusa spp.",
   str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
   str_detect(species_botanical_name, "^brachea edulis") ~ "brahea edulis",
   str_detect(species_botanical_name, "^buxus$") ~ "buxus spp.",
   str_detect(species_botanical_name, "^bougainvillea$") ~ "bougainvillea spp.",
   
   str_detect(species_botanical_name, "^casurina stricta") ~ "allocasuarina verticillata",
   str_detect(species_botanical_name, "^ceanothus$") ~ "ceanothus spp.",
   str_detect(species_botanical_name, "^cedrus$") ~ "cedrus spp.",
   str_detect(species_botanical_name, "^cedrus atlantica") ~ "cedrus atlantica",
   str_detect(species_botanical_name, "^cedrus deodora") ~ "cedrus deodara",
   str_detect(species_botanical_name, "^celtis$") ~ "celtis spp.",
   str_detect(species_botanical_name, "^celtis chinensis") ~ "celtis sinensis",
   str_detect(species_botanical_name, "^cercis$") ~ "cercis spp.",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^cercis reniformis") ~ "cercis reniformis",
   str_detect(species_botanical_name, "^chamaecyparis$") ~ "chamaecyparis spp.",
   str_detect(species_botanical_name, "^chitalpa tashkentensis") ~ "chitalpa tashkentensis",
   str_detect(species_botanical_name, "^chorisia speciosa") ~ "ceiba speciosa", #formerly known as chorisia
   str_detect(species_botanical_name, "^citrus$") ~ "citrus spp.",
   str_detect(species_botanical_name, "^crataegus laevigata") ~ "crataegus laevigata",
   str_detect(species_botanical_name, "^crateagus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^crataegus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crateagus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crataegus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^cycad$") ~ "cycas spp.",
   
   str_detect(species_botanical_name, "^elaeagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eleagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eriobotrya$") ~ "eriobotrya spp.",
   str_detect(species_botanical_name, "^erythrina$") ~ "erythrina spp.",
   str_detect(species_botanical_name, "^escallonia$") ~ "escallonia spp.",
   str_detect(species_botanical_name, "^escallonia exoniensis") ~ "escallonia exoniensis",
   
   str_detect(species_botanical_name, "^eucalyptus$") ~ "eucalyptus spp.",
   str_detect(species_botanical_name, "^eucalyptus citriodora") ~ "corymbia citriodora", #name switch
   str_detect(species_botanical_name, "^eucalyptus ficifolia") ~ "corymbia ficifolia", #name switch
   str_detect(species_botanical_name, "^eucalyptus parvifolia") ~ "eucalyptus parvula", #name switch
   str_detect(species_botanical_name, "^feijoa sellowiana") ~ "acca sellowiana", #name switch
   str_detect(species_botanical_name, "^ficus$") ~ "ficus spp.", #name switch
   str_detect(species_botanical_name, "^ficus nitida") ~ "ficus microcarpa", #name switch
   str_detect(species_botanical_name, "^fraxinus$") ~ "fraxinus spp.",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^fraxinus angustifolia") ~ "fraxinus angustifolia",
   str_detect(species_botanical_name, "^fraxinus moraine") ~ "fraxinus holotricha",
   str_detect(species_botanical_name, "^fraxinus uhdei") ~ "fraxinus uhdei",
   str_detect(species_botanical_name, "^fraxinus veluntina") ~ "fraxinus velutina",
   str_detect(species_botanical_name, "^fraxinus velutina") ~ "fraxinus velutina",
   
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditisia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^heliconia$") ~ "heliconia spp.",
   str_detect(species_botanical_name, "^hesperocyparis$") ~ "hesperocyparis spp.",
   str_detect(species_botanical_name, "^hibiscus$") ~ "hibiscus spp.",
   str_detect(species_botanical_name, "^ilex$") ~ "ilex spp.",
   str_detect(species_botanical_name, "^ilex aquifolium") ~ "ilex aquifolium",
   str_detect(species_botanical_name, "^juglans$") ~ "juglans spp.",
   str_detect(species_botanical_name, "^juniperus$") ~ "juniperus spp.",
   str_detect(species_botanical_name, "^lagerstroemia$") ~ "lagerstroemia spp.",
   str_detect(species_botanical_name, "^lagerstroemia indica biloxi$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica natchez$") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica faurei") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica muskogee$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica tuscarora$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica fauriei") ~ "lagerstroemia indica x fauriei",
  
   
   str_detect(species_botanical_name, "^laurus nobilis") ~ "laurus nobilis",
   str_detect(species_botanical_name, "^leptospermum$") ~ "leptospermum spp.",
   str_detect(species_botanical_name, "^ligustrum$") ~ "ligustrum spp.",
   str_detect(species_botanical_name, "^ligustrum japonicum") ~ "ligustrum japonicum",
   str_detect(species_botanical_name, "^liquidambar$") ~ "liquidambar spp.",
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^lycianthus rantonnetii") ~ "lycianthes rantonnetii",
   
   str_detect(species_botanical_name, "^magnolia$") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^malus$") ~ "malus spp.",
   str_detect(species_botanical_name, "^maytenus boaria") ~ "maytenus boaria",
   str_detect(species_botanical_name, "^melaleuca$") ~ "melaleuca spp.",
   str_detect(species_botanical_name, "^melia azerdarach") ~ "melia azedarach",
   str_detect(species_botanical_name, "^metrosideros excelsus") ~ "metrosideros excelsa",
   
   str_detect(species_botanical_name, "^michelia champaca") ~ "magnolia champaca", #name change
   str_detect(species_botanical_name, "^michelia doltsopa") ~ "magnolia doltsopa",#name change
   str_detect(species_botanical_name, "^morus$") ~ "morus spp.",#name change
   str_detect(species_botanical_name, "^murraya exotica") ~ "murraya paniculata",#name change
   str_detect(species_botanical_name, "^musashino sawleaf zelkova") ~ "zelkova serrata",#name change
   str_detect(species_botanical_name, "^myoporum laevigatum") ~ "myoporum laetum",#name change
   str_detect(species_botanical_name, "^musa$") ~ "musa spp.",#name change
   
   str_detect(species_botanical_name, "^nandina$") ~ "nandina spp.",#name change
   
   
   str_detect(species_botanical_name, "^phormium$") ~ "phormium spp.",
   str_detect(species_botanical_name, "^picea$") ~ "picea spp.",
   str_detect(species_botanical_name, "^picea glauca") ~ "picea glauca",
   str_detect(species_botanical_name, "^pinus$") ~ "pinus spp.",
   str_detect(species_botanical_name, "^pinus pinea") ~ "pinus pinea",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^pistacia chinensis") ~ "pistacia chinensis",
   
   str_detect(species_botanical_name, "^pittosporum$") ~ "pittosporum spp.",
   str_detect(species_botanical_name, "^pittosporum tawhiwhi") ~ "pittosporum tenuifolium",
   str_detect(species_botanical_name, "^pittosporum rhombifolium") ~ "auranticarpa rhombifolia",
   
   
   str_detect(species_botanical_name, "^platanus × acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hispanica") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^podocarpus gracilior") ~ "afrocarpus gracilior",#name change
   str_detect(species_botanical_name, "^populus$") ~ "populus spp.",
   str_detect(species_botanical_name, "^prunus$") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus amygdalus") ~ "prunus dulcis",
   str_detect(species_botanical_name, "^prunus armenica") ~ "prunus armeniaca",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus ilicifoia") ~ "prunus ilicifolia",
   str_detect(species_botanical_name, "^prunus martimia") ~ "prunus maritima",
   
   
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus spp.") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^psidium$") ~ "psidium spp.",
   str_detect(species_botanical_name, "^pyracantha$") ~ "pyracantha spp.",
   str_detect(species_botanical_name, "^pyrus$") ~ "pyrus spp.",
   str_detect(species_botanical_name, "^quercus$") ~ "quercus spp.",
   str_detect(species_botanical_name, "^quercus frainetto") ~ "quercus frainetto",
   
   str_detect(species_botanical_name, "^rhaphiolepis majestic beauty") ~ "rhaphiolepis indica",
   str_detect(species_botanical_name, "^rhus copallina") ~ "rhus copallinum",
   str_detect(species_botanical_name, "^robinia$") ~ "robinia spp.",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   str_detect(species_botanical_name, "^robinia idahoensis") ~ "robinia ambigua idahoensis",
   str_detect(species_botanical_name, "^robinia ambiqua purple") ~ "robinia pseudoacacia x ambigua",
   str_detect(species_botanical_name, "^rosa$") ~ "rosa spp.",

   str_detect(species_botanical_name, "^salix$") ~ "salix spp.",
   str_detect(species_botanical_name, "^schinus terbinthefolius") ~ "schinus terebinthifolius",
   str_detect(species_botanical_name, "^solanum rantonnetii") ~ "lycianthes rantonnetii",
   str_detect(species_botanical_name, "^sorbus$") ~ "sorbus spp.",
   str_detect(species_botanical_name, "^syagrus romanzoffianum") ~ "syagrus romanzoffiana",
   str_detect(species_botanical_name, "^syringa$") ~ "syringa spp.",
   str_detect(species_botanical_name, "^syzgium australe") ~ "syzygium australe",
   str_detect(species_botanical_name, "^taxus baccata") ~ "taxus baccata",
   str_detect(species_botanical_name, "^thuga orientalis") ~ "platycladus orientalis",#name change
   str_detect(species_botanical_name, "^thuja lawsoniana") ~ "chamaecyparis lawsoniana",
   str_detect(species_botanical_name, "^thuja occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^tilia tomentosa") ~ "tilia tomentosa",
   str_detect(species_botanical_name, "^trachylospermum jasminoides") ~ "trachelospermum jasminoides",
   str_detect(species_botanical_name, "^tristania conferta") ~ "lophostemon confertus", #name change
   str_detect(species_botanical_name, "^ulmus$") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus ‘frontier’") ~ "ulmus carpinifolia x parvifolia", 
   str_detect(species_botanical_name, "^ulmus japonica wilsoniana") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus parviflora") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus propinqua") ~ "ulmus propinqua",
   str_detect(species_botanical_name, "^ulmus wilsoniana prospector") ~ "ulmus wilsoniana",
   str_detect(species_botanical_name, "^washingtonia romanzoffiana") ~ "syagrus romanzoffiana",
   
   str_detect(species_botanical_name, "^wisteria$") ~ "wisteria spp.",
   str_detect(species_botanical_name, "^yucca$") ~ "yucca spp.",
   str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
   
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer nigra") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tatarian") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer truncatum acer") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^acer truncatum platanoides") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier arborea") ~ "amelanchier arborea",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
   str_detect(species_botanical_name, "^chamaecyparis nootkatensis") ~ "chamaecyparis nootkatensis",
   str_detect(species_botanical_name, "^elm$") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^gingko biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^ginkgo biloba autumn gold") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditsia tricanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^malus apple") ~ "malus spp.",
   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^platanus acerfolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hybrida") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus nigra") ~ "populus nigra",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^rhamnus frangula") ~ "frangula alnus",
   str_detect(species_botanical_name, "^rhus hirta") ~ "rhus typhina",
   str_detect(species_botanical_name, "^salix spp. weeping") ~ "salix babylonica",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus accolade") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus pioneer") ~ "ulmus hollandica",
   
  str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
  str_detect(species_botanical_name, "^sophora japonica") ~ "styphnolobium japonicum",
  str_detect(species_botanical_name, "^tabebuia chrysotricha") ~ "handroanthus chrysotrichus",
  str_detect(species_botanical_name, "^saponara quillaja") ~ "quillaja saponaria",
  
  
   TRUE ~ species_botanical_name
  ))


sj_trees_clean <- left_join(sj_trees_clean, spp_code, by = "species_botanical_name")

sj_trees_clean <- sj_trees_clean %>% 
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))

sj_trees_clean<-sj_trees_clean[, c(5:8,2,1,4,9,3)]


#write.csv(sj_trees_clean, "~/Dropbox/Urban_data/Cleaned/sanjose_trees_clean.csv", row.names = FALSE)

```


#Santa Monica
  ###dbh in inches
Data downloaded from: https://santamonicaca.treekeepersoftware.com/index.cfm?deviceWidth=2560

```{r}

#Clean
santamonica_trees<- read.csv("~/Dropbox/Urban_data/Raw/santamonica_ca_usa.csv")

santamonica_trees$country <- "usa"
santamonica_trees$state <- "california"
santamonica_trees$city <- "santa monica"
santamonica_trees$year <- "2023" #last updated in 2023

santamonica_trees_clean <- santamonica_trees %>% 
  filter(DBH != "0" & DBH != "" & Latitude != "") %>% 
  dplyr::rename(long = Longitude,
                lat = Latitude,
                dbh = DBH, # in inches
                species_botanical_name = Species) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) 

santamonica_trees_clean$dbh <- santamonica_trees_clean$dbh * 2.54 ##converting from inches to cm

# Extract text between parentheses in the species_botanical_name column
santamonica_trees_clean$species_botanical_name <- gsub(".*\\((.*)\\).*", "\\1", santamonica_trees_clean$species_botanical_name)

santamonica_trees_clean <- santamonica_trees_clean %>% 
  filter(!grepl("^unknown|^unidentified", species_botanical_name, ignore.case = TRUE))


santamonica_trees_clean <- santamonica_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^abies concolor") ~ "abies concolor",
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acacia baileyana") ~ "acacia baileyana",
   str_detect(species_botanical_name, "^acmena smithii") ~ "syzygium smithii",
   str_detect(species_botanical_name, "^afrocarpus elongatus") ~ "podocarpus elongatus",
   
   str_detect(species_botanical_name, "^arbutus 'marina'") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^auranticarpa rhombifolium") ~ "auranticarpa rhombifolia",
   str_detect(species_botanical_name, "^catalpa hybrida") ~ "catalpa erubescens",
   str_detect(species_botanical_name, "^cedrus atlantica") ~ "cedrus atlantica",
   str_detect(species_botanical_name, "^cercis canadensis 'oklahoma'") ~ "cercis reniformis",
   str_detect(species_botanical_name, "^cercis canadensis 'forest pansy'") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^cercis canadensis texensis") ~ "cercis canadensis var. texensis",
   str_detect(species_botanical_name, "^chitalpa tashkentensis") ~ "chitalpa tashkentensis",
   str_detect(species_botanical_name, "^chilopsis linearis") ~ "chilopsis linearis",
   
   str_detect(species_botanical_name, "^cupressocyparis x leylandii") ~ "cupressocyparis leylandii",
   str_detect(species_botanical_name, "^eucalyptus globulus") ~ "eucalyptus globulus",
   str_detect(species_botanical_name, "^eucalyptus leucoxylon") ~ "eucalyptus leucoxylon",
   str_detect(species_botanical_name, "^ficus benjamina") ~ "ficus benjamina",
   str_detect(species_botanical_name, "^ficus microcarpa") ~ "ficus microcarpa",
   str_detect(species_botanical_name, "^fraxinus angustifolia") ~ "fraxinus angustifolia",
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^duranta repens") ~ "duranta erecta", #synonym
   
   str_detect(species_botanical_name, "^hesperocyparis macrocarpa") ~ "cupressus macrocarpa",
   str_detect(species_botanical_name, "^ilex altaclarensis") ~ "ilex altaclerensis",
   str_detect(species_botanical_name, "^juniperus chinensis 'torulosa'") ~ "juniperus chinensis torulosa",
   str_detect(species_botanical_name, "^lagerstroemia indica 'natchez'") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica 'dynamite'") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica 'muskogee'") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica 'pink'") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica 'purple'") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica 'red'") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica 'tuscarora'") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica 'white'") ~ "lagerstroemia indica",
   
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^lophostemon confertus") ~ "lophostemon confertus",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^malus spp.") ~ "malus spp.",
   str_detect(species_botanical_name, "^melaleuca genistifolia") ~ "melaleuca decora", # name change, synonym
   str_detect(species_botanical_name, "^melaleuca viminalis") ~ "callistemon viminalis", # name change, synonym
   str_detect(species_botanical_name, "^metrosideros excelsus") ~ "metrosideros excelsa",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
   
   str_detect(species_botanical_name, "^nolina recurvata") ~ "beaucarnea recurvata", # name change, synonym
   str_detect(species_botanical_name, "^olea europaea") ~ "olea europaea",
   str_detect(species_botanical_name, "^palm spp.") ~ "arecaceae spp.",
   str_detect(species_botanical_name, "^parkinsonia x 'desert museum'") ~ "parkinsonia desert museum",
   
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^platanus x hispanica") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   
   str_detect(species_botanical_name, "prunus ilicifolia ssp lyonii") ~ "prunus lyonii",
   str_detect(species_botanical_name, "pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "quercus wislizenii") ~ "quercus wislizeni",
   str_detect(species_botanical_name, "rhus laurina") ~ "malosma laurina",
   str_detect(species_botanical_name, "robinia ambigua 'idahoensis'") ~ "robinia ambigua idahoensis",
   str_detect(species_botanical_name, "syagrus romanzoffianum") ~ "syagrus romanzoffiana",
   
   str_detect(species_botanical_name, "taxodium huegelii") ~ "taxodium mucronatum",
   str_detect(species_botanical_name, "ulmus parvifolia") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "ulmus propinqua") ~ "ulmus propinqua",
   
   TRUE ~ species_botanical_name
  ))

santamonica_trees_clean <- left_join(santamonica_trees_clean, spp_code, by = "species_botanical_name")

santamonica_trees_clean <- santamonica_trees_clean %>% 
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))

santamonica_trees_clean<-santamonica_trees_clean[, c(5:8,2,1,4,9,3)]


#write.csv(santamonica_trees_clean, "~/Dropbox/Urban_data/Cleaned/santamonica_trees_clean.csv", row.names = FALSE)


```

#Seattle
Data downloaded from: https://data-seattlecitygis.opendata.arcgis.com/datasets/0b8c124ace214943ab0379623937eccb_6/explore

```{r}

#Clean
seattle_trees<- read.csv("~/Dropbox/Urban_data/Raw/seattle_wa_usa.csv")

seattle_trees$country <- "usa"
seattle_trees$state <- "washington"
seattle_trees$city <- "seattle"
seattle_trees$year <- "2022" #last updated in 2022

seattle_trees_clean <- seattle_trees %>% 
  filter(DIAM != "0") %>% 
  dplyr::rename(long = SHAPE_LNG,
                lat = SHAPE_LAT,
                dbh = DIAM, # check if in inches
                #species_common_name = COMMON_NAME,
                species_botanical_name = SCIENTIFIC_NAME) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year)) %>%        
  filter(!grepl("^unknown|^vacant|^shrub|^planting", species_botanical_name, ignore.case = TRUE)) %>%
  filter(dbh > 0) %>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("species$|sp$|spp$|sp.$", "spp.", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("'", "", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("`", "", species_botanical_name))  


seattle_trees_clean$dbh <- seattle_trees_clean$dbh * 2.54 ##converting from inches to cm

seattle_trees_clean$species_botanical_name[seattle_trees_clean$species_botanical_name == ""] <- NA


seattle_trees_clean <- seattle_trees_clean %>%
  mutate(species_botanical_name = case_when(
    
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer campestre") ~ "acer campestre",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
   str_detect(species_botanical_name, "^acer nigra") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer palmatum `sango") ~ "acer palmatum",
   str_detect(species_botanical_name, "^acer palmatum bihou") ~ "acer palmatum",
   str_detect(species_botanical_name, "^acer palmatum osakazuki") ~ "acer palmatum",
   str_detect(species_botanical_name, "^acer palmatum tobiosho") ~ "acer palmatum",
   str_detect(species_botanical_name, "^acer palmatum sango") ~ "acer palmatum",
   str_detect(species_botanical_name, "^acer palmatum var. dissectum") ~ "acer palmatum var. dissectum",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer pseudoplatanus") ~ "acer pseudoplatanus",
   str_detect(species_botanical_name, "^acer rufinerve") ~ "acer rufinerve",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tatarian") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer truncatum") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^aesculus carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^aesculus hippocastanum") ~ "aesculus hippocastanum",
   str_detect(species_botanical_name, "^alnus glutinosa") ~ "alnus glutinosa",
   str_detect(species_botanical_name, "^amelanchier laevis") ~ "amelanchier laevis",
   str_detect(species_botanical_name, "^aralia elata") ~ "aralia elata",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier arborea") ~ "amelanchier arborea",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^betula utilis var. jacquemonti") ~ "betula utilis var. jacquemontii",
   str_detect(species_botanical_name, "^camelia spp.") ~ "camellia spp.",
   str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
   str_detect(species_botanical_name, "^carpinus caroliniana") ~ "carpinus caroliniana",
   str_detect(species_botanical_name, "^carpinus japonicus") ~ "carpinus japonica",
   str_detect(species_botanical_name, "^catalpa speciosa") ~ "carpinus japonica",
   str_detect(species_botanical_name, "^ceanothus spp..") ~ "ceanothus spp.",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^chamaecyparis nootkatensis") ~ "chamaecyparis nootkatensis",
   str_detect(species_botanical_name, "^chamaecyparis lawsoniana") ~ "chamaecyparis lawsoniana",
   str_detect(species_botanical_name, "^chamaecyparis pisifera") ~ "chamaecyparis pisifera",
   str_detect(species_botanical_name, "^chionanthus retusus") ~ "chionanthus retusus",
   str_detect(species_botanical_name, "^cornus \\(kousa nutt") ~ "cornus kousa",
   str_detect(species_botanical_name, "^cornus controversa") ~ "cornus controversa",
   str_detect(species_botanical_name, "^cornus florida f rubra") ~ "cornus florida f. rubra",
   str_detect(species_botanical_name, "^cornus kousa beni fuji") ~ "cornus kousa",
   str_detect(species_botanical_name, "^cornus kousa big apple") ~ "cornus kousa",
   str_detect(species_botanical_name, "^cornus kousa champions gold") ~ "cornus kousa",
   str_detect(species_botanical_name, "^cornus kousa milky way") ~ "cornus kousa",
   str_detect(species_botanical_name, "^cornus kousa nutt starlight") ~ "cornus kousa",
   str_detect(species_botanical_name, "^cornus kousa satomi") ~ "cornus kousa",
   str_detect(species_botanical_name, "^cornus nuttallii florida") ~ "cornus nuttallii x florida",
   str_detect(species_botanical_name, "^cornus rutban") ~ "cornus florida x kousa",
   str_detect(species_botanical_name, "^cornus rutgerensis") ~ "cornus rutgersensis",
   str_detect(species_botanical_name, "^corylus avellana") ~ "corylus avellana",
   str_detect(species_botanical_name, "^corylus cornuta ssp.") ~ "corylus cornuta var. californica",
   str_detect(species_botanical_name, "^crataegus \\`autumn") ~ "crataegus autumn glory",
   str_detect(species_botanical_name, "^crataegus crus-galli") ~ "crataegus crus-galli",
   str_detect(species_botanical_name, "^crataegus laevigata") ~ "crataegus laevigata",
   str_detect(species_botanical_name, "^crataegus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^crataegus monogyna") ~ "crataegus monogyna",
   str_detect(species_botanical_name, "^crataegus viridis") ~ "crataegus viridis",
   str_detect(species_botanical_name, "^cunninghamia lanceolata") ~ "cunninghamia lanceolata",
   str_detect(species_botanical_name, "^cupresses macrocarpa") ~ "cupressus macrocarpa",
   str_detect(species_botanical_name, "^ cupressocyparis leylandii") ~ "cupressocyparis leylandii",
   str_detect(species_botanical_name, "^\\+ laburnocytidus adamii$") ~ "laburnocytisus adamii",
   str_detect(species_botanical_name, "^davidia involucrata") ~ "davidia involucrata",
   str_detect(species_botanical_name, "^eunonymus fortunei") ~ "euonymus fortunei",
   str_detect(species_botanical_name, "^eunonymus japonica") ~ "euonymus japonicus",
   str_detect(species_botanical_name, "^euonymus japonica") ~ "euonymus japonicus",
   str_detect(species_botanical_name, "^fagus sylvatica") ~ "fagus sylvatica",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^fraxinus angustifolia") ~ "fraxinus angustifolia",
   str_detect(species_botanical_name, "^fraxinus excelsior") ~ "fraxinus excelsior",
   str_detect(species_botanical_name, "^fraxinus velutina") ~ "fraxinus velutina",
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^halesia carolina") ~ "halesia carolina",
   str_detect(species_botanical_name, "^hamamelis intermedia") ~ "hamamelis intermedia",
   str_detect(species_botanical_name, "^hibiscus syriacus") ~ "hibiscus syriacus",
   str_detect(species_botanical_name, "^hydrangea spp.") ~ "hydrangea spp.",
   str_detect(species_botanical_name, "^juniperus chinensis") ~ "juniperus chinensis",
   str_detect(species_botanical_name, "^koelrueteria paniculata") ~ "koelreuteria paniculata",
   str_detect(species_botanical_name, "^lagerstroemia biloxi") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia tuscarora") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^larix kaempferi") ~ "larix kaempferi",
   str_detect(species_botanical_name, "^lilac spp.") ~ "syringa spp.",
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^liriodendron tulipifera") ~ "liriodendron tulipifera",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^magnolia hypoleuca") ~ "magnolia obovata",
   str_detect(species_botanical_name, "^magnolia kobus var. loebneri") ~ "magnolia loebneri",
   str_detect(species_botanical_name, "^magnolia kobus var. stellata") ~ "magnolia stellata",
   str_detect(species_botanical_name, "^magnolia loebneri") ~ "magnolia loebneri",
   str_detect(species_botanical_name, "^magnolia kobus var. loebneri") ~ "magnolia loebneri",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",
   
   str_detect(species_botanical_name, "^magnolia virginiana") ~ "magnolia virginiana",
   str_detect(species_botanical_name, "^malus brandywine") ~ "malus brandywine",
   str_detect(species_botanical_name, "^malus professor") ~ "malus zumi",
   str_detect(species_botanical_name, "^malus moerlandsii") ~ "malus moerlandsii",
   str_detect(species_botanical_name, "^malus wintergold") ~ "malus winter gold",
   str_detect(species_botanical_name, "^malus zumi") ~ "malus zumi",
   str_detect(species_botanical_name, "^malus red jewel") ~ "malus red jewel",
   str_detect(species_botanical_name, "^malus royal raindrops") ~ "malus jfs-kw5",
   str_detect(species_botanical_name, "^malus sugar tyme") ~ "malus sutyzam",
   str_detect(species_botanical_name, "^malus transitoria") ~ "malus transitoria",
   str_detect(species_botanical_name, "^nyssa sylvatica") ~ "nyssa sylvatica",
   str_detect(species_botanical_name, "^osmanthus delavay") ~ "osmanthus delavayi",
   str_detect(species_botanical_name, "^palm spp.") ~ "arecaceae spp.",
   str_detect(species_botanical_name, "^parrotia persia") ~ "parrotia persica",
   str_detect(species_botanical_name, "^parrotia persica") ~ "parrotia persica",
   str_detect(species_botanical_name, "^pinus leucodermis") ~ "pinus heldreichii",

   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^platanus acerfolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hybrida") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus morton circle") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^philadelpus spp.") ~ "philadelphus spp.",
   str_detect(species_botanical_name, "^physocarpus opulifolius") ~ "physocarpus opulifolius",
   str_detect(species_botanical_name, "^populus alba") ~ "populus alba",
   str_detect(species_botanical_name, "^populus balsamifera") ~ "populus balsamifera",
   str_detect(species_botanical_name, "^populus canadensis") ~ "populus canadensis",
   str_detect(species_botanical_name, "^populus tremula") ~ "populus tremula",
   str_detect(species_botanical_name, "^populus nigra") ~ "populus nigra",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^prunus amanogawa") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus cascade snow") ~ "prunus yedoensis x serrulata",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus dream") ~ "prunus incam",
   str_detect(species_botanical_name, "^prunus hokusai") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus kwanzan") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus laurocerasus") ~ "prunus laurocerasus",
   str_detect(species_botanical_name, "^prunus newport") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus okame") ~ "prunus incam",
   str_detect(species_botanical_name, "^prunus sargentii") ~ "prunus sargentii",
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus shiro") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus shogetsu") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus snow fountain") ~ "prunus yedoensis x subhirtella",
   str_detect(species_botanical_name, "^prunus snow goose") ~ "prunus speciosa x incisa",
   
   str_detect(species_botanical_name, "^prunus spire") ~ "prunus incisa x sargentii",
   str_detect(species_botanical_name, "^prunus subhirtella") ~ "prunus subhirtella",
   str_detect(species_botanical_name, "^prunus yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^pyrus jack") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^pyrus ncpx1") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^pyrus salicifolia") ~ "pyrus salicifolia", 
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "prunus calleryana",
   str_detect(species_botanical_name, "^pyrus yedoensis") ~ "prunus yedoensis",
   
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^quercus bicolor") ~ "quercus bicolor",
   str_detect(species_botanical_name, "^quercus frainetto") ~ "quercus frainetto",
   str_detect(species_botanical_name, "^quercus hypoluecoides") ~ "quercus hypoleucoides",
   str_detect(species_botanical_name, "^quercus macrocarpa") ~ "quercus macrocarpa",
   str_detect(species_botanical_name, "^quercus myrsinaefolia") ~ "quercus myrsinifolia",
   str_detect(species_botanical_name, "^quercus paulstris") ~ "quercus palustris",
   str_detect(species_botanical_name, "^quercus palustris") ~ "quercus palustris",
   
   str_detect(species_botanical_name, "^rhamnus frangula") ~ "frangula alnus",
   str_detect(species_botanical_name, "^rhus hirta") ~ "rhus typhina",
   str_detect(species_botanical_name, "^rhus typhina") ~ "rhus typhina",
   str_detect(species_botanical_name, "^rhodendron spp.") ~ "rhododendron spp.",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   
   str_detect(species_botanical_name, "^salix integra") ~ "salix integra",
   str_detect(species_botanical_name, "^salix lucida spp.") ~ "salix lucida ssp. lasiandra ",
   str_detect(species_botanical_name, "^salix spp. weeping") ~ "salix babylonica",
   str_detect(species_botanical_name, "^salix matsudana") ~ "salix matsudana",
   str_detect(species_botanical_name, "^salix sepulcralis") ~ "salix sepulcralis",
   str_detect(species_botanical_name, "^sciadopitys virticillata") ~ "sciadopitys verticillata",
   str_detect(species_botanical_name, "^sorbus americana") ~ "sorbus americana",
   str_detect(species_botanical_name, "^sorbus aucuparia") ~ "sorbus aucuparia",
   str_detect(species_botanical_name, "^sorbus thuringiaca") ~ "sorbus thuringiaca",
   str_detect(species_botanical_name, "^sorbus wilfrid") ~ "sorbus aria x vestita",
   
   str_detect(species_botanical_name, "^sophora japonica") ~ "styphnolobium japonicum",
   str_detect(species_botanical_name, "^sophora americana") ~ "sophora americana",
   str_detect(species_botanical_name, "^sophora aucuparia") ~ "sophora aucuparia",
   str_detect(species_botanical_name, "^stewartia pseudocamellia") ~ "stewartia pseudocamellia",
   str_detect(species_botanical_name, "^styrax japonicus") ~ "styrax japonicus",
   str_detect(species_botanical_name, "^syringa reticulata") ~ "syringa reticulata",
   
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^thuja occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^thuja plicata") ~ "thuja plicata",
   str_detect(species_botanical_name, "^thujopsia dolabrata") ~ "thujopsis dolabrata",
   str_detect(species_botanical_name, "^tilia euchlora") ~ "tilia euchlora",
   str_detect(species_botanical_name, "^tilia flavescens") ~ "tilia flavescens",
   str_detect(species_botanical_name, "^tilia tomentosa") ~ "tilia tomentosa",
   
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus accolade") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus japonica wilsoniana") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus pioneer") ~ "ulmus hollandica",
   str_detect(species_botanical_name, "^ulmus glabra") ~ "ulmus glabra",
   str_detect(species_botanical_name, "^ulmus morton glossy") ~ "ulmus triumph",
   str_detect(species_botanical_name, "^ulmus parvifolia") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus propinqua") ~ "ulmus davidiana var. japonica",
   str_detect(species_botanical_name, "^ulmus wilsoniana") ~ "ulmus wilsoniana",
   
   str_detect(species_botanical_name, "^viburnum plicatum var") ~ "viburnum plicatum var. tomentosum",
   str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
   
   
   TRUE ~ species_botanical_name
  ))

seattle_trees_clean <- left_join(seattle_trees_clean, spp_code, by = "species_botanical_name")

seattle_trees_clean <- seattle_trees_clean %>% 
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))


seattle_trees_clean<-seattle_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(seattle_trees_clean, "~/Dropbox/Urban_data/Cleaned/seattle_trees_clean.csv", row.names = FALSE)


```


#Sioux Falls
Data downloaded from: https://hub.arcgis.com/datasets/cityofsfgis::trees/explore

```{r}

#Clean
sioux_trees<- read.csv("~/Dropbox/Urban_data/Raw/siouxfalls_sd_usa.csv")

sioux_trees$country <- "usa"
sioux_trees$state <- "south dakota"
sioux_trees$city <- "sioux falls"
sioux_trees$year <- "2020" #last updated in 2020

sioux_trees_clean <- sioux_trees %>% 
  filter(SiteType == "Tree" & Lon != "" & SiteType != "^Removal") %>% 
  dplyr::rename(long = Lon,
                lat = Lat,
                dbh = Diameter, # check if in inches
                #species_common_name = FullName,
                species_botanical_name = Species) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year))%>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  filter(!grepl("^999", species_botanical_name, ignore.case = TRUE)) %>%
  filter(lat > 0) %>%
  mutate(species_botanical_name = sub("spp$|species$|sp$", "spp.", species_botanical_name))%>%
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("'", " ", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("u\\.", "ulmus", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("q\\.", "quercus", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("a\\.", "aesculus", species_botanical_name)) 

sioux_trees_clean$dbh <- sioux_trees_clean$dbh * 2.54 ##converting from inches to cm

sioux_trees_clean$species_botanical_name[sioux_trees_clean$species_botanical_name == ""] <- NA

sioux_trees_clean <- sioux_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^abies concolor") ~ "abies concolor",
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer freemanni") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
   str_detect(species_botanical_name, "^acer negundo") ~ "acer negundo",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharium") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^aesculus arnoldiana") ~ "aesculus arnoldiana",
   str_detect(species_botanical_name, "^aesculus  homestead") ~ "aesculus homestead",
   str_detect(species_botanical_name, "^americana") ~ "prunus americana",
   
   str_detect(species_botanical_name, "^cartaegus ambigua") ~ "crataegus ambigua",
   str_detect(species_botanical_name, "^celtis occidentalis") ~ "celtis occidentalis",
   str_detect(species_botanical_name, "^cladrastis kentuckea") ~ "cladrastis kentukea",
   str_detect(species_botanical_name, "^continus coggygria") ~ "cotinus coggygria",
   str_detect(species_botanical_name, "^crataegus crus-galli") ~ "crataegus crus-galli",
   
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gingko biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^juniperus scopulorum") ~ "juniperus scopulorum",
   str_detect(species_botanical_name, "^juniperus virginiana") ~ "juniperus virginiana",
   
   str_detect(species_botanical_name, "^magnolia") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^malus communis") ~ "malus domestica",
   str_detect(species_botanical_name, "^malus adams") ~ "malus adams",
   str_detect(species_botanical_name, "^malus branzam") ~ "malus brandywine",
   str_detect(species_botanical_name, "^malus centzam") ~ "malus centurion",
   str_detect(species_botanical_name, "^malus donald") ~ "malus donald wyman",
   str_detect(species_botanical_name, "^malus indian magic") ~ "malus indian magic",
   str_detect(species_botanical_name, "^malus indian summer") ~ "malus indian summer",
   str_detect(species_botanical_name, "^malus fruit") ~ "malus spp.",
   str_detect(species_botanical_name, "^malus starlite") ~ "malus jeflite",
   str_detect(species_botanical_name, "^malus harvest gold") ~ "malus harvest gold",
   str_detect(species_botanical_name, "^malus jfs-kw5") ~ "malus jfs-kw5",
   str_detect(species_botanical_name, "^malus pink spire") ~ "malus pink spires",
   str_detect(species_botanical_name, "^malus prairie fire") ~ "malus prairifire",
   str_detect(species_botanical_name, "^malus purple prince") ~ "malus purple prince",
   str_detect(species_botanical_name, "^malus red prairie spy") ~ "malus red prairie spy",
   str_detect(species_botanical_name, "^malus sargentii") ~ "malus sargentii",
   str_detect(species_botanical_name, "^malus snowdrift") ~ "malus snowdrift",
   str_detect(species_botanical_name, "^malus spring bride") ~ "malus spring bride",
   str_detect(species_botanical_name, "^malus spring snow") ~ "malus spring snow",
   str_detect(species_botanical_name, "^malus sutyzam") ~ "malus sutyzam",
   str_detect(species_botanical_name, "^morus alba") ~ "morus alba",
   
   str_detect(species_botanical_name, "^phellodendron amurense") ~ "phellodendron amurense",
   str_detect(species_botanical_name, "^pinus pungens") ~ "pinus pungens",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus canadensis") ~ "populus canadensis",
   str_detect(species_botanical_name, "^populus deltoides") ~ "populus deltoides",
   str_detect(species_botanical_name, "^populus hybrid") ~ "populus spp.",
   
   str_detect(species_botanical_name, "^prunus cerasus") ~ "prunus cerasus",
   str_detect(species_botanical_name, "^prunus maacki") ~ "prunus maackii",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus ussuriensis") ~ "pyrus ussuriensis",
   
   str_detect(species_botanical_name, "^quercus ellipsoides") ~ "quercus ellipsoidalis",
   str_detect(species_botanical_name, "^quercus robur macrocarpa") ~ "quercus macdanielii",
   str_detect(species_botanical_name, "^quercus warei") ~ "quercus warei",
   
   str_detect(species_botanical_name, "^rhus hirta") ~ "rhus typhina",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   str_detect(species_botanical_name, "^rhamns cathartica") ~ "rhamnus cathartica",
   
   
   str_detect(species_botanical_name, "^salix matsudana") ~ "salix matsudana",
   str_detect(species_botanical_name, "^salix alba") ~ "salix alba",
   str_detect(species_botanical_name, "^sorbus quercifolia") ~ "sorbus hybrida", ##both known as oak leaf mountain ash
   str_detect(species_botanical_name, "^sorbus alba") ~ "salix alba",
   str_detect(species_botanical_name, "^sylvvestris  mongolian") ~ "pinus sylvestris",
   str_detect(species_botanical_name, "^thuja occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^titia american") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia tomentosa") ~ "tilia tomentosa",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   
   str_detect(species_botanical_name, "^ulmus  cathedral") ~ "ulmus parvifolia x pumila",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus american valley forge") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus davidiana var japonica") ~ "ulmus davidiana var. japonica",
   str_detect(species_botanical_name, "^ulmus frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus jap pumila") ~ "ulmus japonica x pumila",
   str_detect(species_botanical_name, "^ulmus pumila jap") ~ "ulmus japonica x pumila",
   str_detect(species_botanical_name, "^ulmus jap wil") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^wilsoniana  prospector") ~ "ulmus wilsoniana",
   
   TRUE ~ species_botanical_name
  ))

sioux_trees_clean <- left_join(sioux_trees_clean, spp_code, by = "species_botanical_name")

sioux_trees_clean <- sioux_trees_clean %>% 
  filter(!is.na(species_botanical_name))%>% 
  filter(!is.na(species_common_name)) %>%
  filter(!is.na(dbh)) %>% 
  select(-c(hort_code))


sioux_trees_clean<-sioux_trees_clean[, c(5:8,2,1,4,9,3)]

#write.csv(sioux_trees_clean, "~/Dropbox/Urban_data/Cleaned/sioux_trees_clean.csv", row.names = FALSE)

```

#Toronto 
Data downloaded from
https://open.toronto.ca/dataset/street-tree-data/

Projected on WGS84

```{r}

#Clean
toronto_trees<- read.csv("~/Dropbox/Urban_data/Raw/toronto_on_ca.csv")

toronto_trees$country <- "ca"
toronto_trees$state <- "ontario"
toronto_trees$city <- "toronto"
toronto_trees$year <- "2023" #data updated on Jun 4 2023

toronto_trees <- toronto_trees %>%
  mutate(longitude = str_extract(geometry, "-?\\d+\\.\\d+"),
         latitude = str_extract(geometry, "(?<=,\\s)-?\\d+\\.\\d+"))

# Convert the extracted coordinates to numeric
toronto_trees$longitude <- as.numeric(toronto_trees$longitude)
toronto_trees$latitude <- as.numeric(toronto_trees$latitude)


toronto_trees_clean <- toronto_trees %>% 
  dplyr::rename(long = longitude,
                lat = latitude,
                dbh = DBH_TRUNK, # check if in inches
                #species_common_name = FullName,
                species_botanical_name = BOTANICAL_NAME) %>% 
  select(c(lat, long, dbh, species_botanical_name, country, state, city, year))%>% 
  mutate(species_botanical_name = tolower(species_botanical_name)) %>% 
  filter(!grepl("^none", species_botanical_name, ignore.case = TRUE)) %>%
  mutate(species_botanical_name = sub("spp$|species$|sp$", "spp.", species_botanical_name))%>%
  mutate(species_botanical_name = gsub("\\bx\\b", "", species_botanical_name)) %>% 
  mutate(species_botanical_name = gsub("\\s+", " ", species_botanical_name))%>% 
  mutate(species_botanical_name = gsub("'", " ", species_botanical_name)) %>% 
  filter(dbh>0)


toronto_trees_clean <- toronto_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^abies$") ~ "abies spp.",
   str_detect(species_botanical_name, "^abies balsamaea") ~ "abies balsamea",
   str_detect(species_botanical_name, "^acer nigrum") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer truncatum") ~ "acer truncatum",
   str_detect(species_botanical_name, "^aesculus carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^aesculus hippocastanum") ~ "aesculus hippocastanum",
   str_detect(species_botanical_name, "^alix × sepulcralis") ~ "salix sepulcralis",
   str_detect(species_botanical_name, "^allianthus altissima") ~ "ailanthus altissima",
   str_detect(species_botanical_name, "^amelanchier canadensis") ~ "amelanchier canadensis",
   str_detect(species_botanical_name, "^betula$") ~ "betula spp.",
   str_detect(species_botanical_name, "^betula utilis  jacquemonti") ~ "betula utilis var. jacquemontii",
   str_detect(species_botanical_name, "^caragana arboresense") ~ "caragana arborescens",
   str_detect(species_botanical_name, "^carya$") ~ "carya spp.",
   str_detect(species_botanical_name, "^catalpa bignonioides") ~ "catalpa bignonioides",
   str_detect(species_botanical_name, "^cornus$") ~ "cornus spp.",
   str_detect(species_botanical_name, "^corylus$") ~ "corylus spp.",
   str_detect(species_botanical_name, "^crataegus viridis") ~ "crataegus viridis",
   str_detect(species_botanical_name, "^euonymus altus") ~ "euonymus alatus",
   str_detect(species_botanical_name, "^fagus$") ~ "fagus spp.",
   str_detect(species_botanical_name, "^fagus sylvatica") ~ "fagus sylvatica",
   str_detect(species_botanical_name, "^fraxinus nigra") ~ "fraxinus nigra",
   str_detect(species_botanical_name, "^juglans cinereax") ~ "juglans cinerea",
   str_detect(species_botanical_name, "^laburnum watereri") ~ "laburnum watereri",
   str_detect(species_botanical_name, "^liriodendron tulipifera") ~ "liriodendron tulipifera",
   str_detect(species_botanical_name, "^morus alba") ~ "morus alba",
   
   str_detect(species_botanical_name, "^picea omorica") ~ "picea omorika",
   str_detect(species_botanical_name, "^populus alba") ~ "populus alba",
   str_detect(species_botanical_name, "^populus canadensis") ~ "populus canadensis",
   str_detect(species_botanical_name, "^prunus   \\(") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus  \\(") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus cistena") ~ "prunus cistena",
   str_detect(species_botanical_name, "^prunus subhirtella") ~ "prunus subhirtella",
   str_detect(species_botanical_name, "^salix matsudana") ~ "salix matsudana",
   str_detect(species_botanical_name, "^salix sepulcralis") ~ "salix sepulcralis",
   str_detect(species_botanical_name, "^sophora japonica") ~ "styphnolobium japonicum",
   str_detect(species_botanical_name, "^sorbus thuringiaca") ~ "sorbus thuringiaca",
   str_detect(species_botanical_name, "^taxus$") ~ "taxus spp.",
   str_detect(species_botanical_name, "^thuja$") ~ "thuja spp.",
   str_detect(species_botanical_name, "^tilia$") ~ "tilia spp.",
   str_detect(species_botanical_name, "^tilia euchlora") ~ "tilia euchlora",
   str_detect(species_botanical_name, "^ulmus  hollandica ") ~ "ulmus hollandica",
   str_detect(species_botanical_name, "^ulmus ?") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^ulmus davidiana  japonica") ~ "ulmus davidiana var. japonica",
   str_detect(species_botanical_name, "^ulmus glabra") ~ "ulmus glabra",
   str_detect(species_botanical_name, "^ulmus minor") ~ "ulmus minor",
   str_detect(species_botanical_name, "^ulmus pumila \\(pumila") ~ "ulmus homestead",
   str_detect(species_botanical_name, "^xanthocyparis nootkatensis") ~ "xanthocyparis nootkatensis",
   str_detect(species_botanical_name, "^zelkova$") ~ "zelkova spp.",
   
   str_detect(species_botanical_name, "^abelia grandiflora") ~ "linnaea grandiflora",
   str_detect(species_botanical_name, "^acacia$") ~ "acacia spp.",
   str_detect(species_botanical_name, "^albizia$") ~ "albizia spp.",
   
   str_detect(species_botanical_name, "^acacia baileyana") ~ "acacia baileyana",
   str_detect(species_botanical_name, "^acer buergeranium") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer buergeranum") ~ "acer buergerianum",
   str_detect(species_botanical_name, "^acer campestre") ~ "acer campestre",
   str_detect(species_botanical_name, "^acer fremanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer grandidentatum") ~ "acer grandidentatum",
   str_detect(species_botanical_name, "^acer miyabei") ~ "acer miyabei",
   str_detect(species_botanical_name, "^aesculus$") ~ "aesculus spp.",
   str_detect(species_botanical_name, "^aesculus × carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^alnus$") ~ "alnus spp.",
   str_detect(species_botanical_name, "^arbor vitae$") ~ "thuja spp.",
   str_detect(species_botanical_name, "^arbutus ‘marina’") ~ "arbutus unedo",
   str_detect(species_botanical_name, "^arbutus marina") ~ "arbutus unedo",
   
   str_detect(species_botanical_name, "^baccharis$") ~ "baccharis spp.",
   str_detect(species_botanical_name, "^bambusa$") ~ "bambusa spp.",
   str_detect(species_botanical_name, "^betula nigra") ~ "betula nigra",
   str_detect(species_botanical_name, "^brachea edulis") ~ "brahea edulis",
   str_detect(species_botanical_name, "^buxus$") ~ "buxus spp.",
   str_detect(species_botanical_name, "^bougainvillea$") ~ "bougainvillea spp.",
   
   str_detect(species_botanical_name, "^casurina stricta") ~ "allocasuarina verticillata",
   str_detect(species_botanical_name, "^ceanothus$") ~ "ceanothus spp.",
   str_detect(species_botanical_name, "^cedrus$") ~ "cedrus spp.",
   str_detect(species_botanical_name, "^cedrus atlantica") ~ "cedrus atlantica",
   str_detect(species_botanical_name, "^cedrus deodora") ~ "cedrus deodara",
   str_detect(species_botanical_name, "^celtis$") ~ "celtis spp.",
   str_detect(species_botanical_name, "^celtis chinensis") ~ "celtis sinensis",
   str_detect(species_botanical_name, "^cercis$") ~ "cercis spp.",
   str_detect(species_botanical_name, "^cercis canadensis") ~ "cercis canadensis",
   str_detect(species_botanical_name, "^cercis reniformis") ~ "cercis reniformis",
   str_detect(species_botanical_name, "^chamaecyparis$") ~ "chamaecyparis spp.",
   str_detect(species_botanical_name, "^chitalpa tashkentensis") ~ "chitalpa tashkentensis",
   str_detect(species_botanical_name, "^chorisia speciosa") ~ "ceiba speciosa", #formerly known as chorisia
   str_detect(species_botanical_name, "^citrus$") ~ "citrus spp.",
   str_detect(species_botanical_name, "^crataegus laevigata") ~ "crataegus laevigata",
   str_detect(species_botanical_name, "^crateagus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^crataegus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crateagus$") ~ "crataegus spp.",
   str_detect(species_botanical_name, "^crataegus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^cycad$") ~ "cycas spp.",
   
   str_detect(species_botanical_name, "^elaeagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eleagnus pungens") ~ "elaeagnus pungens",
   str_detect(species_botanical_name, "^eriobotrya$") ~ "eriobotrya spp.",
   str_detect(species_botanical_name, "^erythrina$") ~ "erythrina spp.",
   str_detect(species_botanical_name, "^escallonia$") ~ "escallonia spp.",
   str_detect(species_botanical_name, "^escallonia exoniensis") ~ "escallonia exoniensis",
   
   str_detect(species_botanical_name, "^eucalyptus$") ~ "eucalyptus spp.",
   str_detect(species_botanical_name, "^eucalyptus citriodora") ~ "corymbia citriodora", #name switch
   str_detect(species_botanical_name, "^eucalyptus ficifolia") ~ "corymbia ficifolia", #name switch
   str_detect(species_botanical_name, "^eucalyptus parvifolia") ~ "eucalyptus parvula", #name switch
   str_detect(species_botanical_name, "^feijoa sellowiana") ~ "acca sellowiana", #name switch
   str_detect(species_botanical_name, "^ficus$") ~ "ficus spp.", #name switch
   str_detect(species_botanical_name, "^ficus nitida") ~ "ficus microcarpa", #name switch
   str_detect(species_botanical_name, "^fraxinus$") ~ "fraxinus spp.",
   str_detect(species_botanical_name, "^fraxinus americana") ~ "fraxinus americana",
   str_detect(species_botanical_name, "^fraxinus angustifolia") ~ "fraxinus angustifolia",
   str_detect(species_botanical_name, "^fraxinus moraine") ~ "fraxinus holotricha",
   str_detect(species_botanical_name, "^fraxinus uhdei") ~ "fraxinus uhdei",
   str_detect(species_botanical_name, "^fraxinus veluntina") ~ "fraxinus velutina",
   str_detect(species_botanical_name, "^fraxinus velutina") ~ "fraxinus velutina",
   
   str_detect(species_botanical_name, "^ginkgo biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditisia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^heliconia$") ~ "heliconia spp.",
   str_detect(species_botanical_name, "^hesperocyparis$") ~ "hesperocyparis spp.",
   str_detect(species_botanical_name, "^hibiscus$") ~ "hibiscus spp.",
   str_detect(species_botanical_name, "^ilex$") ~ "ilex spp.",
   str_detect(species_botanical_name, "^ilex aquifolium") ~ "ilex aquifolium",
   str_detect(species_botanical_name, "^juglans$") ~ "juglans spp.",
   str_detect(species_botanical_name, "^juniperus$") ~ "juniperus spp.",
   str_detect(species_botanical_name, "^lagerstroemia$") ~ "lagerstroemia spp.",
   str_detect(species_botanical_name, "^lagerstroemia indica biloxi$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica natchez$") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica faurei") ~ "lagerstroemia indica x fauriei",
   str_detect(species_botanical_name, "^lagerstroemia indica muskogee$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica tuscarora$") ~ "lagerstroemia indica",
   str_detect(species_botanical_name, "^lagerstroemia indica fauriei") ~ "lagerstroemia indica x fauriei",
  
   
   str_detect(species_botanical_name, "^laurus nobilis") ~ "laurus nobilis",
   str_detect(species_botanical_name, "^leptospermum$") ~ "leptospermum spp.",
   str_detect(species_botanical_name, "^ligustrum$") ~ "ligustrum spp.",
   str_detect(species_botanical_name, "^ligustrum japonicum") ~ "ligustrum japonicum",
   str_detect(species_botanical_name, "^liquidambar$") ~ "liquidambar spp.",
   str_detect(species_botanical_name, "^liquidambar styraciflua") ~ "liquidambar styraciflua",
   str_detect(species_botanical_name, "^lycianthus rantonnetii") ~ "lycianthes rantonnetii",
   
   str_detect(species_botanical_name, "^magnolia$") ~ "magnolia spp.",
   str_detect(species_botanical_name, "^magnolia grandiflora") ~ "magnolia grandiflora",
   str_detect(species_botanical_name, "^malus$") ~ "malus spp.",
   str_detect(species_botanical_name, "^maytenus boaria") ~ "maytenus boaria",
   str_detect(species_botanical_name, "^melaleuca$") ~ "melaleuca spp.",
   str_detect(species_botanical_name, "^melia azerdarach") ~ "melia azedarach",
   str_detect(species_botanical_name, "^metrosideros excelsus") ~ "metrosideros excelsa",
   
   str_detect(species_botanical_name, "^michelia champaca") ~ "magnolia champaca", #name change
   str_detect(species_botanical_name, "^michelia doltsopa") ~ "magnolia doltsopa",#name change
   str_detect(species_botanical_name, "^morus$") ~ "morus spp.",#name change
   str_detect(species_botanical_name, "^murraya exotica") ~ "murraya paniculata",#name change
   str_detect(species_botanical_name, "^musashino sawleaf zelkova") ~ "zelkova serrata",#name change
   str_detect(species_botanical_name, "^myoporum laevigatum") ~ "myoporum laetum",#name change
   str_detect(species_botanical_name, "^musa$") ~ "musa spp.",#name change
   
   str_detect(species_botanical_name, "^nandina$") ~ "nandina spp.",#name change
   
   
   str_detect(species_botanical_name, "^phormium$") ~ "phormium spp.",
   str_detect(species_botanical_name, "^picea$") ~ "picea spp.",
   str_detect(species_botanical_name, "^picea glauca") ~ "picea glauca",
   str_detect(species_botanical_name, "^pinus$") ~ "pinus spp.",
   str_detect(species_botanical_name, "^pinus pinea") ~ "pinus pinea",
   str_detect(species_botanical_name, "^pinus thunbergiana") ~ "pinus thunbergii",
   str_detect(species_botanical_name, "^pistacia chinensis") ~ "pistacia chinensis",
   
   str_detect(species_botanical_name, "^pittosporum$") ~ "pittosporum spp.",
   str_detect(species_botanical_name, "^pittosporum tawhiwhi") ~ "pittosporum tenuifolium",
   str_detect(species_botanical_name, "^pittosporum rhombifolium") ~ "pittosporum rhombifolia ",
   
   
   str_detect(species_botanical_name, "^platanus × acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hispanica") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^podocarpus gracilior") ~ "afrocarpus gracilior",#name change
   str_detect(species_botanical_name, "^populus$") ~ "populus spp.",
   str_detect(species_botanical_name, "^prunus$") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus amygdalus") ~ "prunus dulcis",
   str_detect(species_botanical_name, "^prunus armenica") ~ "prunus armeniaca",
   str_detect(species_botanical_name, "^prunus cerasifera") ~ "prunus cerasifera",
   str_detect(species_botanical_name, "^prunus ilicifoia") ~ "prunus ilicifolia",
   str_detect(species_botanical_name, "^prunus martimia") ~ "prunus maritima",
   
   
   str_detect(species_botanical_name, "^prunus serrulata") ~ "prunus serrulata",
   str_detect(species_botanical_name, "^prunus spp.") ~ "prunus spp.",
   str_detect(species_botanical_name, "^prunus yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^psidium$") ~ "psidium spp.",
   str_detect(species_botanical_name, "^pyracantha$") ~ "pyracantha spp.",
   str_detect(species_botanical_name, "^pyrus$") ~ "pyrus spp.",
   str_detect(species_botanical_name, "^quercus$") ~ "quercus spp.",
   str_detect(species_botanical_name, "^quercus frainetto") ~ "quercus frainetto",
   
   str_detect(species_botanical_name, "^rhaphiolepis majestic beauty") ~ "rhaphiolepis indica",
   str_detect(species_botanical_name, "^rhus copallina") ~ "rhus copallinum",
   str_detect(species_botanical_name, "^robinia$") ~ "robinia spp.",
   str_detect(species_botanical_name, "^robinia pseudoacacia") ~ "robinia pseudoacacia",
   str_detect(species_botanical_name, "^robinia idahoensis") ~ "robinia ambigua idahoensis",
   str_detect(species_botanical_name, "^robinia ambiqua purple") ~ "robinia pseudoacacia x ambigua",
   str_detect(species_botanical_name, "^rosa$") ~ "rosa spp.",
   
   str_detect(species_botanical_name, "^saponara quillaja") ~ "saponaria quillaja",
   str_detect(species_botanical_name, "^salix$") ~ "salix spp.",
   str_detect(species_botanical_name, "^schinus terbinthefolius") ~ "schinus terebinthifolius",
   str_detect(species_botanical_name, "^solanum rantonnetii") ~ "lycianthes rantonnetii",
   str_detect(species_botanical_name, "^sorbus$") ~ "sorbus spp.",
   str_detect(species_botanical_name, "^syagrus romanzoffianum") ~ "syagrus romanzoffiana",
   str_detect(species_botanical_name, "^syringa$") ~ "syringa spp.",
   str_detect(species_botanical_name, "^syzgium australe") ~ "syzygium australe",
   str_detect(species_botanical_name, "^taxus baccata") ~ "taxus baccata",
   str_detect(species_botanical_name, "^thuga orientalis") ~ "platycladus orientalis",#name change
   str_detect(species_botanical_name, "^thuja lawsoniana") ~ "chamaecyparis lawsoniana",
   str_detect(species_botanical_name, "^thuja occidentalis") ~ "thuja occidentalis",
   str_detect(species_botanical_name, "^tilia tomentosa") ~ "tilia tomentosa",
   str_detect(species_botanical_name, "^trachylospermum jasminoides") ~ "trachelospermum jasminoides",
   str_detect(species_botanical_name, "^tristania conferta") ~ "lophostemon confertus", #name change
   str_detect(species_botanical_name, "^ulmus$") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus $") ~ "ulmus spp.", #name change
   str_detect(species_botanical_name, "^ulmus ‘frontier’") ~ "ulmus carpinifolia x parvifolia", 
   str_detect(species_botanical_name, "^ulmus japonica wilsoniana") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus parviflora") ~ "ulmus parvifolia",
   str_detect(species_botanical_name, "^ulmus propinqua") ~ "ulmus propinqua",
   str_detect(species_botanical_name, "^ulmus wilsoniana prospector") ~ "ulmus wilsoniana",
   str_detect(species_botanical_name, "^washingtonia romanzoffiana") ~ "syagrus romanzoffiana",
   
   str_detect(species_botanical_name, "^wisteria$") ~ "wisteria spp.",
   str_detect(species_botanical_name, "^yucca$") ~ "yucca spp.",
   str_detect(species_botanical_name, "^zelkova serrata") ~ "zelkova serrata",
   
   str_detect(species_botanical_name, "^acer$") ~ "acer spp.",
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer nigra") ~ "acer nigrum",
   str_detect(species_botanical_name, "^acer ginnala") ~ "acer ginnala",
   str_detect(species_botanical_name, "^acer platanoides") ~ "acer platanoides",
   str_detect(species_botanical_name, "^acer rubrum") ~ "acer rubrum",
   str_detect(species_botanical_name, "^acer saccharinum") ~ "acer saccharinum",
   str_detect(species_botanical_name, "^acer saccharum") ~ "acer saccharum",
   str_detect(species_botanical_name, "^acer tatarian") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer tataricum") ~ "acer tataricum",
   str_detect(species_botanical_name, "^acer truncatum acer") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^acer truncatum platanoides") ~ "acer truncatum x platanoides",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier arborea") ~ "amelanchier arborea",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula pendula") ~ "betula pendula",
   str_detect(species_botanical_name, "^carpinus betulus") ~ "carpinus betulus",
   str_detect(species_botanical_name, "^chamaecyparis nootkatensis") ~ "chamaecyparis nootkatensis",
   str_detect(species_botanical_name, "^elm$") ~ "ulmus spp.",
   str_detect(species_botanical_name, "^fraxinus pennsylvanica") ~ "fraxinus pennsylvanica",
   str_detect(species_botanical_name, "^gingko biloba") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^ginkgo biloba autumn gold") ~ "ginkgo biloba",
   str_detect(species_botanical_name, "^gleditsia tricanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gleditsia triacanthos") ~ "gleditsia triacanthos",
   str_detect(species_botanical_name, "^gymnocladus dioicus") ~ "gymnocladus dioicus",
   str_detect(species_botanical_name, "^malus apple") ~ "malus spp.",
   str_detect(species_botanical_name, "^picea pungens") ~ "picea pungens",
   str_detect(species_botanical_name, "^platanus acerfolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^platanus hybrida") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus nigra") ~ "populus nigra",
   str_detect(species_botanical_name, "^prunus virginiana") ~ "prunus virginiana",
   str_detect(species_botanical_name, "^pyrus calleryana") ~ "pyrus calleryana",
   str_detect(species_botanical_name, "^quercus robur") ~ "quercus robur",
   str_detect(species_botanical_name, "^rhamnus frangula") ~ "frangula alnus",
   str_detect(species_botanical_name, "^rhus hirta") ~ "rhus typhina",
   str_detect(species_botanical_name, "^salix spp. weeping") ~ "salix babylonica",
   str_detect(species_botanical_name, "^tilia americana") ~ "tilia americana",
   str_detect(species_botanical_name, "^tilia cordata") ~ "tilia cordata",
   str_detect(species_botanical_name, "^ulmus americana") ~ "ulmus americana",
   str_detect(species_botanical_name, "^ulmus accolade") ~ "ulmus japonica x wilsoniana",
   str_detect(species_botanical_name, "^ulmus frontier") ~ "ulmus carpinifolia x parvifolia",
   str_detect(species_botanical_name, "^ulmus pioneer") ~ "ulmus hollandica",
   str_detect(species_botanical_name, "^magnolia soulangiana") ~ "magnolia soulangeana",

   
   TRUE ~ species_botanical_name
  ))

toronto_trees_clean$species_botanical_name[toronto_trees_clean$species_botanical_name == ""] <- NA

toronto_trees_clean<- left_join(toronto_trees_clean, spp_code, by = "species_botanical_name") 

toronto_trees_clean <- toronto_trees_clean %>% 
  filter(!is.na(species_botanical_name)) %>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code))


toronto_trees_clean<-toronto_trees_clean[, c(5:8,2,1,4,9,3)]


#write.csv(toronto_trees_clean, "~/Dropbox/Urban_data/Cleaned/toronto_trees_clean.csv", row.names = FALSE)


```


#Surrey
Data downloaded from: https://data.surrey.ca/dataset/park-specimen-trees

```{r}

#Clean
surrey_trees<- read.csv("~/Dropbox/Urban_data/Raw/surrey_britishcolumbia_ca.csv")

surrey_trees$country <- "ca"
surrey_trees$state <- "british columbia"
surrey_trees$city <- "surrey"
surrey_trees$year <- "2023" #last updated in 2022

surrey_trees_clean <- surrey_trees %>% 
  filter(TREE_DIAMETER_CM != "0" & TREE_DIAMETER_CM != "" ) %>% 
  dplyr::rename(long = Longitude,
                lat = Latitude,
                dbh = TREE_DIAMETER_CM, # check if in inches
                genus = TREE_GENUS,
                species = TREE_SPECIES) %>% 
                #height = HEIGHT_M) %>% 
  select(c(lat, long, dbh, genus, species, country, state, city, year)) %>% 
  mutate(species = gsub("\\bx\\b", "", species)) %>% 
  mutate(species = gsub("\\s+", " ", species))%>% 
  mutate(genus = tolower(genus))%>% 
  mutate(species = tolower(species))

surrey_trees_clean$species[surrey_trees_clean$species == ""] <- NA
surrey_trees_clean <- surrey_trees_clean %>% 
 mutate(species = ifelse(is.na(species), "spp.", species))
surrey_trees_clean$species_botanical_name <- paste(surrey_trees_clean$genus, surrey_trees_clean$species,
                                                   sep = " ")

surrey_trees_clean <- surrey_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^aesculus  carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^malus yunnanensis") ~ "acer platanoides",
   str_detect(species_botanical_name, "^platanus  acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^prunus  yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^styrax japonica") ~ "styrax japonicus",
   str_detect(species_botanical_name, "^tilia  euchlora") ~ "tilia euchlora",
   
   TRUE ~ species_botanical_name
  ))

surrey_trees_clean<- left_join(surrey_trees_clean, spp_code, by = "species_botanical_name") 

surrey_trees_clean <- surrey_trees_clean %>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(genus, species, hort_code))

surrey_trees_clean<-surrey_trees_clean[, c(4:7,2,1,8,9,3)]


#write.csv(surrey_trees_clean, "~/Dropbox/Urban_data/Cleaned/surrey_trees_clean.csv", row.names = FALSE)

```

#Vancouver

Data downloaded from:
https://opendata.vancouver.ca/explore/dataset/street-trees/information/?disjunctive.species_name&disjunctive.common_name&disjunctive.on_street&disjunctive.neighbourhood_name


```{r}

#Clean
vancouver_trees<- read.csv("~/Dropbox/Urban_data/Raw/vancouver_britishcolumbia_ca.csv")

vancouver_trees$country <- "ca"
vancouver_trees$state <- "british columbia"
vancouver_trees$city <- "vancouver"
vancouver_trees$year <- "2023" #last updated in 2023

vancouver_trees_clean <- vancouver_trees %>%  
  filter(Geom != "0" & Geom != "" ) %>% 
  separate(geo_point_2d, into = c("lat", "long"), sep = ",\\s*") %>% 
  dplyr::rename(
                dbh = DIAMETER, ##in inches
                genus = GENUS_NAME,
                species = SPECIES_NAME) %>% 
  select(c(lat, long, dbh, genus, species, country, state, city, year)) %>% 
  mutate(genus = tolower(genus))%>% 
  mutate(species = tolower(species)) %>% 
  filter(!grepl("^stump", genus))%>% 
  mutate(species = sub("spp$|species$", "spp.", species))%>%
  mutate(species = gsub("\\bx\\b", "", species)) %>% 
  mutate(species = gsub("\\bx$", "", species)) %>%
  mutate(species = gsub("\\s+", " ", species))

vancouver_trees_clean$dbh <- vancouver_trees_clean$dbh * 2.54 ##converting from inches to cm

vancouver_trees_clean$species[vancouver_trees_clean$species == ""] <- NA
vancouver_trees_clean$species[vancouver_trees_clean$species == "xx"] <- NA
vancouver_trees_clean <- vancouver_trees_clean %>% 
 mutate(species = ifelse(is.na(species), "spp.", species))

vancouver_trees_clean$species_botanical_name <- paste(vancouver_trees_clean$genus, vancouver_trees_clean$species, sep = " ")
#vancouver_trees_clean <- vancouver_trees_clean %>% 
#mutate(species_botanical_name = sub(" x$", "", species_botanical_name))


vancouver_trees_clean <- vancouver_trees_clean %>%
  mutate(species_botanical_name = case_when(
   str_detect(species_botanical_name, "^acer freemanii") ~ "acer freemanii",
   str_detect(species_botanical_name, "^acer pennsylvanicum") ~ "acer pensylvanicum",
   
   str_detect(species_botanical_name, "^aesculus arnoldiana") ~ "aesculus arnoldiana",
   str_detect(species_botanical_name, "^aesculus carnea") ~ "aesculus carnea",
   str_detect(species_botanical_name, "^alnus rugosa") ~ "alnus incana",
   str_detect(species_botanical_name, "^amelanchier alba") ~ "amelanchier arborea",
   str_detect(species_botanical_name, "^amelanchier grandiflora") ~ "amelanchier grandiflora",
   str_detect(species_botanical_name, "^betula alba-sinensis") ~ "betula albosinensis",
   str_detect(species_botanical_name, "^clerodendron trichotomum") ~ "clerodendrum trichotomum",
   str_detect(species_botanical_name, "^catalpa hybrida") ~ "catalpa erubescens",
   str_detect(species_botanical_name, "^cornus officianalis") ~ "cornus officinalis",
   str_detect(species_botanical_name, "^corylus columa") ~ "corylus colurna",
   str_detect(species_botanical_name, "^crataegus lavallei") ~ "crataegus lavallei",
   str_detect(species_botanical_name, "^crataegus mordensis") ~ "crataegus mordenensis",
   str_detect(species_botanical_name, "^cupressocyparis   x leylandii") ~ "cupressocyparis leylandii",
   str_detect(species_botanical_name, "^euonymus europea") ~ "euonymus europaeus",
   str_detect(species_botanical_name, "^juglans ailanthifolia") ~ "juglans ailantifolia",
   str_detect(species_botanical_name, "^laburnum watereri") ~ "laburnum watereri",
   str_detect(species_botanical_name, "^magnolia kewensis") ~ "magnolia kewensis",
   str_detect(species_botanical_name, "^magnolia loebneri") ~ "magnolia loebneri",
   str_detect(species_botanical_name, "^magnolia micromalus") ~ "magnolia micromalus",
   str_detect(species_botanical_name, "^magnolia soulangeana") ~ "magnolia soulangeana",
   str_detect(species_botanical_name, "^magnolia veitchii") ~ "magnolia veitchii",
   str_detect(species_botanical_name, "^malus micromalus") ~ "malus micromalus",
   str_detect(species_botanical_name, "^michelia platypetala") ~ "magnolia cavaleriei var. platypetala",
   str_detect(species_botanical_name, "^nothofagus antartica") ~ "nothofagus antarctica",
   str_detect(species_botanical_name, "^phellodendon amurense") ~ "phellodendron amurense",
   str_detect(species_botanical_name, "^pinus griffithii") ~ "pinus wallichiana",
   str_detect(species_botanical_name, "^platanus acerifolia") ~ "platanus acerifolia",
   str_detect(species_botanical_name, "^populus canescens") ~ "populus canescens",
   str_detect(species_botanical_name, "^prunus  hillieri") ~ "prunus incisa x sargentii",
   str_detect(species_botanical_name, "^prunus  yedoensis") ~ "prunus yedoensis",
   str_detect(species_botanical_name, "^prunus pennsylvanica") ~ "prunus pensylvanica",
   str_detect(species_botanical_name, "^pterostyrax hispida") ~ "pterostyrax hispidus",
   str_detect(species_botanical_name, "^quercus  bimundorum") ~ "quercus bimundorum",
   str_detect(species_botanical_name, "^quercus  macdanielii") ~ "quercus macdanielii",
   str_detect(species_botanical_name, "^quercus  warei") ~ "quercus warei",
   str_detect(species_botanical_name, "^quercus robur alba") ~ "quercus robur x alba",
   str_detect(species_botanical_name, "^sequoia semprevirens") ~ "sequoia sempervirens",
   str_detect(species_botanical_name, "^sorbus hybrida") ~ "sorbus hybrida",
   str_detect(species_botanical_name, "^sorbus thuringiaca") ~ "sorbus thuringiaca",
   str_detect(species_botanical_name, "^sorbus tianshanica") ~ "sorbus tianschanica",
   str_detect(species_botanical_name, "^styrax japonica") ~ "styrax japonicus",
   str_detect(species_botanical_name, "^sophora japonica") ~ "styphnolobium japonicum",
   str_detect(species_botanical_name, "^thuja orientalis") ~ "platycladus orientalis",
   str_detect(species_botanical_name, "^tilia euchlora") ~ "tilia euchlora",
   str_detect(species_botanical_name, "^tilia europaea") ~ "tilia europaea",
   str_detect(species_botanical_name, "^ulmus hollandica") ~ "ulmus hollandica",
   
   TRUE ~ species_botanical_name
  ))

vancouver_trees_clean<- left_join(vancouver_trees_clean, spp_code, by = "species_botanical_name") 

vancouver_trees_clean <- vancouver_trees_clean %>% 
  filter(!is.na(species_common_name)) %>% 
  select(-c(hort_code,genus,species))

vancouver_trees_clean<-vancouver_trees_clean[, c(4:7,2,1,8,9,3)]

#write.csv(vancouver_trees_clean, "~/Dropbox/Urban_data/Cleaned/vancouver_trees_clean.csv", row.names = FALSE)

```

#North America

```{r}
# Set the directory path
directory_path <- "~/Dropbox/Urban_data/Cleaned/"

# Get a list of all the CSV files in the directory
csv_files <- list.files(directory_path, pattern = "\\.csv$", full.names = TRUE)

# Initialize an empty list to store the data tables
data_tables <- list()

# Read and merge all CSV files using data.table
for (file in csv_files) {
  data <- fread(file)
  data_tables <- c(data_tables, list(data))  # Fix: Wrap 'data' in 'list' function
}

# Merge all the data tables into a single data table
merged_data <- rbindlist(data_tables)

# Print the merged data table
#print(merged_data)

#write.csv(merged_data, "~/Dropbox/Urban_data/Merged/merged_data_aug152023.csv", row.names = FALSE)


```

